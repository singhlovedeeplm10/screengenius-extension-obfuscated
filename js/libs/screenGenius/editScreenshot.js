class editScreenshotSG{constructor(){this.actionSave="";this.cropPoints=0;this.highlightStartPos="";this.prevHighlightStartPos="";this.highlightLastPoint="";this.selectedShapeAnno="";this.selectedShape="";this.shapeOutline="3";this.shapeOutlineColor="#203f99";this.isDevicesAvailable=true;this.start={};this.end={};this.isSelecting=false;this.winH=0;this.wScrolled=0;this.docHeight=0;this.imagesposY=0;this.lastScreenshotH=0;this.fullScreenShotCan="";this.fullScreenShotContext="";this.rect={};this.rectB={};this.rectH={};this.rectS={};this.rectR={};this.ctx="";this.ctxB="";this.ctxH="";this.ctxS="";this.ctxO="";this.ctxP="";this.imageObjB=null;this.imageObjS=null;this.imageObjO=null;this.imageObjOoriginal=null;this.imageObjPadding=null;this.imageObjH=null;this.canBGMain=null;this.canBGBlur=null;this.canvasMain=null;this.drag="";this.dragRecord="";this.delta="";this.screenPriorToBlur="";this.screenPriorToHighlight="";this.screenPriorToShape="";this.screenPriorToUpload="";this.screenPriorToLibrary="";this.screenPriorToOthers="";this.screensHistoryData=[];this.screensHistoryStep=0;let screenShotType="Visible Part";this.originalImage="";this.isChanged=false;this.previouscolor="";this.selectedPaddingColor="#ff0";this.selectedPaddingOutline=0;this.selectedBorderColor="#ff0000";this.selectedBorderOutline=0;this.rotateAngle=0;this.recoupLeft=0;this.recoupTop=0;this.isWhiteSpace=true;this.whiteSpaceAround=200;this.rotateScreeshotAngle=0;this.fillUsed=false;this.isFillDragable=false;this.fitUsed=false;this.isPrevFillCropDone=false;this.svgItems=[];this.svgCordinates=[];this.freeHandCordinates=[];this.brushBlockCount=0;this.fontSizeStack=[];this.lastLine=false;this.lastArrow=false;this.shapeAnnoColor="#203f99";this.shapeAnnoOutline="2";this.undoStack=[];this.redoStack=[];this.quixRotateClicked=0;this.downloadScreenWidth=null;this.downloadScreenHeight=null;this.downloadScreenWidthZero=null;this.downloadScreenHeightZero=null;this.downloadScreenImg=null;this.ctxD="";this.fillCanvas="";this.downloadScreenImgZero=null;this.downloadScreenImg0=null;this.downloadScreenImg1=null;this.downloadScreenImgflip=null;this.flipRotate=false;this.gradientDownloadColor="";this.needUploadScreanshotToServer=true;this.whereAnnoDrawArray=[];this.deletedItems=[];this.deleteIcon=chrome.runtime.getURL("/images/delete-blck-bg.png");this.resizeIcon=chrome.runtime.getURL("/images/resize-blck-bg.png");this.cropIcon=chrome.runtime.getURL("/images/quix-croptool-icon.png");this.closeIcon=chrome.runtime.getURL("/images/quix-close-icon.png");this.shapesIcon=chrome.runtime.getURL("/images/quix-shapes-icon.png");this.lastTransform="";this.blurElementsCount=0;this.firstScreenShot=null;this.firstScreenShotAddedWaterMark=null;this.waterMarkAnnotations={}}addEventListeners=type=>{jQuery(document).unbind("keyup");jQuery(document).on("keyup",e=>{let evt=window.event||e;if(evt.keyCode==90&&evt.ctrlKey){this.isPreviousAnnDone(()=>{this.removeIconActiveState(".annotate-ul .sideBar-li");jQuery("#annotations-popup-outer").hide();this.performUndoRedo("undo")})}else if(evt.keyCode==89&&evt.ctrlKey){this.isPreviousAnnDone(()=>{this.removeIconActiveState(".annotate-ul .sideBar-li");jQuery("#annotations-popup-outer").hide();this.performUndoRedo("redo")})}else if(evt.keyCode==27){jQuery("#canvas_background").remove();canvas_background=null;isCanvasBackground=0;jQuery("#close-captureScreen").unbind("click");jQuery("#close-captureScreen").remove();this.enableScrolling();jQuery("#annotations-popup-outer").hide()}else if(evt.keyCode==189&&evt.shiftKey){this.quixyZoomOut()}else if(evt.keyCode==187&&evt.shiftKey){this.quixyZoomIn()}else if(evt.keyCode==48&&evt.shiftKey){this.quixyZoomIn(1)}});jQuery(".quix-flip-download").unbind("click");jQuery(".quix-flip-download").on("click",()=>{let obj=this;this.needUploadScreanshotToServer=true;this.removeCropDownloadAnnotation();this.removePaddingBorderAnnotationToolbar();this.canvasMainDownload=document.getElementById("download-screen-canvas");this.ctxD2=this.canvasMainDownload.getContext("2d");this.ctxD2.imageSmoothingEnabled=false;this.ctxD2.imageSmoothingQuality="high";this.imageObjD=new Image;this.imageObjD.onload=()=>{this.ctxD2.drawImage(this.imageObjD,0,0);this.screenPriorToOthers=this.canvasMainDownload.toDataURL("image/jpeg",1);this.applyOthersFlip()};this.imageObjD.src=this.canvasMainDownload.toDataURL("image/jpeg",1)});jQuery(".quix-rotate-download").unbind("click");jQuery(".quix-rotate-download").on("click",()=>{try{let obj=this;jQuery(".quix-rotate-download").css("pointer-events","none");this.needUploadScreanshotToServer=true;this.removeCropDownloadAnnotation();this.removePaddingBorderAnnotationToolbar();this.quixRotateClicked++;obj.rotateimg();const canvas=document.getElementById("download-screen-canvas");let context=canvas.getContext("2d");let cw=canvas.width;let ch=canvas.height;let myImageData=new Image;myImageData.src=canvas.toDataURL();const loadImageHandler=async()=>{canvas.width=ch;canvas.height=cw;cw=canvas.width;ch=canvas.height;context.imageSmoothingEnabled=false;context.imageSmoothingQuality="high";context.save();context.translate(cw,ch/cw);context.rotate(Math.PI/2);await context.drawImage(myImageData,0,0);context.restore();this.downloadScreenImg.src=await canvas.toDataURL("image/jpeg");myImageData=null;if(this.quixRotateClicked%2!==0){canvas.style.height=this.downloadScreenWidth;canvas.style.width=this.downloadScreenHeight;this.flipRotate=true;this.rotateOdd=true}else{canvas.style.width=this.downloadScreenWidth;canvas.style.height=this.downloadScreenHeight;this.flipRotate=true;this.rotateOdd=false}jQuery(".quix-rotate-download").css("pointer-events","all")};myImageData.onload=loadImageHandler}catch(error){jQuery(".quix-rotate-download").css("pointer-events","all");console.log("err",error.message)}});jQuery(".quix-border-padding-download").unbind("click");jQuery(".quix-border-padding-download").on("click",()=>{this.removeCropDownloadAnnotation();this.ctxD.drawImage(this.downloadScreenImg,0,0,this.downloadScreenImg.width,this.downloadScreenImg.height);let cropDisplayValue=jQuery(".screenshot-wrapper-middle-copyright #quix-crop-annotation-fields-download").css("display");let BorderPaddingDisplayValue=jQuery(".screenshot-wrapper-middle-copyright #quix-padding-annotation-fields-download").css("display");const paddingGradientPopup=document.querySelector("#quix-padding-annotation-fields-download #paddingGColor-input");if(paddingGradientPopup){paddingGradientPopup.style.display="none"}if(BorderPaddingDisplayValue==="flex"){jQuery(".screenshot-wrapper-middle-copyright #quix-padding-annotation-fields-download").css("display","none")}else{jQuery(".screenshot-wrapper-middle-copyright #quix-padding-annotation-fields-download").css("display","flex")}if(cropDisplayValue==="flex"){jQuery(".screenshot-wrapper-middle-copyright #quix-crop-annotation-fields-download").css("display","none");jQuery(".screenshot-wrapper-middle-copyright #quix-padding-annotation-fields-download #paddingGColor-input").css("display","none")}});jQuery(".quix-crop-download").unbind("click");jQuery(".quix-crop-download").on("click",()=>{this.removeCropDownloadAnnotation();let cropDisplayValue=jQuery(".screenshot-wrapper-middle-copyright #quix-crop-annotation-fields-download").css("display");let BorderPaddingDisplayValue=jQuery(".screenshot-wrapper-middle-copyright #quix-padding-annotation-fields-download").css("display");if(cropDisplayValue==="flex"){jQuery(".screenshot-wrapper-middle-copyright #quix-crop-annotation-fields-download").css("display","none")}else{jQuery(".screenshot-wrapper-middle-copyright #quix-crop-annotation-fields-download").css("display","flex")}if(BorderPaddingDisplayValue==="flex"){jQuery(".screenshot-wrapper-middle-copyright #quix-padding-annotation-fields-download").css("display","none");jQuery(".screenshot-wrapper-middle-copyright #quix-padding-annotation-fields-download #paddingGColor-input").css("display","none")}this.eventHandlerCropDownload()});jQuery(".quix-blur").unbind("click");jQuery(".quix-blur").on("click",()=>{jQuery(".annotation-buttons").hide();let obj=this;obj.applySvgAndUpdate(type="blur");this.showRightSidebar("blur");jQuery(".blur #blur-strength").unbind("input");jQuery(".blur #blur-strength").on("input",()=>{this.applyBlurDimensions()})});jQuery(".quix-highlight").unbind("click");jQuery(".quix-highlight").on("click",()=>{let obj=this;let hType=jQuery(".highlight-type select").val();this.iconMouseClick(obj,".annotate-ul .sideBar-li");this.selectedShape="";let canvas=document.getElementById("captured-screen");this.screenPriorToHighlight=canvas.toDataURL("image/jpeg",1);let color;if(jQuery("#annotations-popup-outer")!==undefined){this.showRightSidebar("highlight");setTimeout(()=>{jQuery(".highlight .save-annotation button").unbind("click");jQuery(".highlight .save-annotation button").on("click",()=>{jQuery(".highlight .save-annotation button").unbind("click")})},100)}jQuery(".highlight-pallette span").unbind("click");jQuery(".highlight-pallette span").on("click",elem=>{let hType=jQuery(".highlight-type select").val();color=jQuery(elem.currentTarget).attr("data-color");jQuery("#highlight-bg-color-picker").css("background-color","#"+color);jQuery("#highlight-bg-input").val(color);const color1=jQuery("#highlight-bg-color-picker").css("background-color");this.adjustBlockAutomatically(hType,color1)});if(this.brushBlockCount==0){this.applySvgAndUpdate(hType,color)}jQuery(".highlight-type select").unbind("change");jQuery(".highlight-type select").on("change",()=>{hType=jQuery(".highlight-type select").val();if(hType=="Brush"){jQuery(".highlight-size").show();const ss=jQuery(".highlight-size").val();this.applySvgAndUpdate(hType,color)}else{jQuery(".highlight-size").hide();this.applySvgAndUpdate(hType,color)}})});jQuery(".shapes-popup-inner .shape-svg-row").unbind("click");jQuery(".shapes-popup-inner .shape-svg-row").on("click",elem=>{jQuery(".shape-parent-icon").attr("src",`${this.shapesIcon}`);jQuery("#library-color-picker").spectrum({move:tinycolor=>{let color=tinycolor.toRgbString();jQuery("#library-color-picker").css("background-color","#"+color);jQuery("#library-fill").val(color);this.applyLibraryBlockDimensions()},show:tinycolor=>{this.isChanged=false;this.previouscolor=tinycolor},hide:tinycolor=>{if(!this.isChanged&&this.previouscolor){let color=tinycolor.toRgbString();jQuery("#library-color-picker").css("background-color","#"+color);jQuery("#library-fill").val(color);this.applyLibraryBlockDimensions()}},change:tinycolor=>{this.isChanged=true},color:"#000000",showAlpha:true,showButtons:true,showInput:true,allowEmpty:true,preferredFormat:"rgb"});this.applyShapesSmileys(elem,"shape")});jQuery(".library-popup-inner .library-row").unbind("click");jQuery(".library-popup-inner .library-row").on("click",elem=>{jQuery("#annotations-popup-outer").css("display","none");this.applyShapesSmileys(elem,"smiley")});jQuery(".shapes-popup-inner .shape-row").unbind("click");jQuery(".shapes-popup-inner .shape-row").on("click",elem=>{let _this=this;let obj=jQuery(elem.currentTarget).parents(".sideBar-li")[0];this.showRightSidebar("shapes");if(document.querySelector(".mainSVG .outer-svg-fo.active")){document.querySelector(".mainSVG .outer-svg-fo").classList.remove("active")}jQuery(".shapes-popup-outer").hide();this.eventHandlerShapes(elem)});jQuery(".screenshot-annotations #imgUpload").unbind("click");jQuery(".screenshot-annotations #imgUpload").on("click",event=>{jQuery("#annotations-popup-outer").css("display","none")});jQuery("#imgUpload").unbind("change");jQuery("#imgUpload").on("change",event=>{const input=document.querySelector("#imgUpload");const file=event.target.files[0];if(file&&file.type=="image/jpeg"||file.type=="image/png"||file.type=="image/jpg"){this.uploadAnnotationRequest(file);input.value=""}else{helpers.failureMessagePopup("Invalid Format","Please make sure you're importing a PNG, JPG, or JPEG file.");input.value="";return}});jQuery(".quix-text").unbind("click");jQuery(".quix-text").on("click",()=>{let obj=this;this.applySvgAndUpdate("text");this.showRightSidebar("text");this.eventHandlerTextArea()})};eventHandlerShapes=elem=>{let _this=this;if(jQuery(elem.currentTarget).hasClass("shape-reactangle")){this.selectedShape="reactangle"}else if(jQuery(elem.currentTarget).hasClass("shape-oval")){this.selectedShape="oval"}else if(jQuery(elem.currentTarget).hasClass("shape-line")){this.selectedShape="line"}else if(jQuery(elem.currentTarget).hasClass("shape-arrow")){this.selectedShape="arrow"}this.selectedShapeAnno=this.selectedShape;this.applySvgAndUpdate(this.selectedShapeAnno);jQuery(".shapes .annotation-outline-shape #font-outline-size-shape").unbind("input");jQuery(".shapes .annotation-outline-shape #font-outline-size-shape").on("input",e=>{let value=jQuery(e.currentTarget).val();if(_this.lastLine==true){if(document.querySelector(".mainSVG .outer-svg-fo.active")){document.querySelector(".mainSVG .outer-svg-fo").classList.remove("active")}const lines=document.querySelector(".mainSVG").querySelectorAll("line");const linesArray=Array.from(lines);const lastLine=linesArray[linesArray.length-1];lastLine.setAttribute("stroke-width",value);_this.shapeAnnoOutline=value;jQuery(e.currentTarget).attr("value",value);this.adjustShapesAutomatically(value,"")}if(_this.lastArrow==true){if(document.querySelector(".mainSVG .outer-svg-fo.active")){document.querySelector(".mainSVG .outer-svg-fo").classList.remove("active")}const lines=document.querySelectorAll(".mainSVG line");const arrows=document.querySelectorAll(".mainSVG polyline");const linesArray=Array.from(lines);const arrowsArray=Array.from(arrows);const lastLine=linesArray[linesArray.length-1];const lastArrow=arrowsArray[arrowsArray.length-1];lastLine.setAttribute("stroke-width",value);lastArrow.setAttribute("stroke-width",value);this.shapeAnnoOutline=value;jQuery(e.currentTarget).attr("value",value);this.adjustShapesAutomatically(value,"")}jQuery(e.currentTarget).attr("value",value);this.adjustShapesAutomatically(value,"")});jQuery(".shapes .annotation-outline-shape #outline-color-picker-shape").spectrum({move:tinycolor=>{let color=tinycolor.toRgbString();jQuery("#outline-color-picker-shape").css("background-color","#"+color);jQuery("#font-outline-shape").val(color);this.shapeOutlineColor=color;if(this.lastLine==true){const lines=document.querySelector(".mainSVG").querySelectorAll("line");const linesArray=Array.from(lines);const lastLine=linesArray[linesArray.length-1];lastLine.setAttribute("stroke",color);this.shapeAnnoColor=color;this.adjustShapesAutomatically("",color)}if(this.lastArrow==true){const lines=document.querySelectorAll(".mainSVG line");const arrows=document.querySelectorAll(".mainSVG polyline");const linesArray=Array.from(lines);const arrowsArray=Array.from(arrows);const lastLine=linesArray[linesArray.length-1];const lastArrow=arrowsArray[arrowsArray.length-1];lastLine.setAttribute("stroke",color);lastArrow.setAttribute("stroke",color);this.shapeAnnoColor=color;this.adjustShapesAutomatically("",color)}this.adjustShapesAutomatically("",color)},show:tinycolor=>{this.isChanged=false;this.previouscolor=tinycolor},hide:tinycolor=>{if(!this.isChanged&&this.previouscolor){let color=tinycolor.toRgbString();jQuery("#outline-color-picker-shape").css("background-color","#"+color);jQuery("#font-outline-shape").val(color);this.shapeOutlineColor=color;this.adjustShapesAutomatically("",color)}},change:tinycolor=>{this.isChanged=true},color:"#203f99",showAlpha:true,showButtons:true,showInput:true,allowEmpty:true,preferredFormat:"rgb"});jQuery(".shapes .annotation-outline-shape #outline-color-picker-shape").unbind("change");jQuery(".shapes .annotation-outline-shape #outline-color-picker-shape").on("change",e=>{let value=jQuery(e.currentTarget).css("background-color");if(this.lastLine==true){const lines=document.querySelector(".mainSVG").querySelectorAll("line");const linesArray=Array.from(lines);const lastLine=linesArray[linesArray.length-1];lastLine.setAttribute("stroke",value);this.shapeAnnoColor=value;this.adjustShapesAutomatically("",value)}if(this.lastArrow==true){const lines=document.querySelectorAll(".mainSVG line");const arrows=document.querySelectorAll(".mainSVG polyline");const linesArray=Array.from(lines);const arrowsArray=Array.from(arrows);const lastLine=linesArray[linesArray.length-1];const lastArrow=arrowsArray[arrowsArray.length-1];lastLine.setAttribute("stroke",value);lastArrow.setAttribute("stroke",value);this.shapeAnnoColor=value;this.adjustShapesAutomatically("",value)}})};eventHandlerTextArea=()=>{jQuery(".text .annotation-outline.text #font-outline-size").unbind("input");jQuery(".text .annotation-outline.text #font-outline-size").on("input",()=>{this.applyTextDimensions()});jQuery(".text #font-size").unbind("input");jQuery(".text #font-size").on("input",()=>{this.applyTextDimensions();this.adjustTextAreaAutomatically()});jQuery(".text #font-family").unbind("change");jQuery(".text #font-family").on("change",()=>{this.applyTextDimensions()});jQuery(".text #font-alignment").unbind("change");jQuery(".text #font-alignment").on("change",()=>{this.applyTextDimensions()});jQuery(".text #font-style").unbind("change");jQuery(".text #font-style").on("change",()=>{this.applyTextDimensions()});jQuery(".text #font-outline-fill").unbind("change");jQuery(".text #font-outline-fill").on("change",()=>{this.applyTextDimensions()});jQuery(".text input[name=text_alignment]").unbind("change");jQuery(".text input[name=text_alignment]").on("change",()=>{this.applyTextDimensions()});jQuery(".text .input-radio-custom-style input").unbind("change");jQuery(".text .input-radio-custom-style input").on("change",()=>{this.applyTextDimensions()});jQuery(".text #text-color-picker").spectrum({move:tinycolor=>{let color=tinycolor.toRgbString();jQuery(".text #text-color-picker").css("background-color","#"+color);jQuery(".text #font-color").val(color);this.applyTextDimensions()},show:tinycolor=>{this.isChanged=false;this.previouscolor=tinycolor},hide:tinycolor=>{if(!this.isChanged&&this.previouscolor){let color=tinycolor.toRgbString();jQuery(".text #text-color-picker").css("background-color","#"+color);jQuery(".text #font-color").val(color);this.applyTextDimensions()}},change:tinycolor=>{this.isChanged=true},color:"rgb(255, 0, 0)",showAlpha:true,showButtons:true,showInput:true,allowEmpty:true,preferredFormat:"rgb"});jQuery(".text #fill-color-picker").spectrum({move:tinycolor=>{let color=tinycolor.toRgbString();jQuery(".text #fill-color-picker").css("background-color","#"+color);jQuery(".text #font-fill").val(color);this.applyTextDimensions()},show:tinycolor=>{this.isChanged=false;this.previouscolor=tinycolor},hide:tinycolor=>{if(!this.isChanged&&this.previouscolor){let color=tinycolor.toRgbString();jQuery(".text #font-fill").val(color);this.applyTextDimensions()}},change:tinycolor=>{this.isChanged=true},color:"rgba(221, 221, 210, 0.827)",showAlpha:true,showButtons:true,showInput:true,allowEmpty:true,preferredFormat:"rgb"});jQuery(".text .annotation-outline.text #outline-color-picker").spectrum({move:tinycolor=>{let color=tinycolor.toRgbString();jQuery(".text #outline-color-picker").css("background-color","#"+color);jQuery(".text #font-outline").val(color);this.applyTextDimensions()},show:tinycolor=>{this.isChanged=false;this.previouscolor=tinycolor},hide:tinycolor=>{if(!this.isChanged&&this.previouscolor){let color=tinycolor.toRgbString();jQuery(".text #outline-color-picker").css("background-color","#"+color);jQuery(".text #font-outline").val(color);this.applyTextDimensions()}},change:tinycolor=>{this.isChanged=true},color:"rgb(31, 54, 202)",showAlpha:true,showButtons:true,showInput:true,allowEmpty:true,preferredFormat:"rgb"})};eventHandlerCropDownload=()=>{jQuery(".screenshot-wrapper-middle-copyright .annotation-customcrop").unbind("click");jQuery(".screenshot-wrapper-middle-copyright .annotation-customcrop").on("click",()=>{$(".screenshot-wrapper-middle-copyright .active").removeClass("active");$(".screenshot-wrapper-middle-copyright .annotation-row .annotation-col.crop-option").css({border:"2px solid transparent","box-shadow":"0px 0px 0px"});if(!this.downloadScreenImg){this.downloadScreenImg=this.downloadScreenImg0}let canvas=document.getElementById("download-screen-canvas");this.ctxD=canvas.getContext("2d");canvas.width=this.downloadScreenImg.width;canvas.height=this.downloadScreenImg.height;this.ctxD.drawImage(this.downloadScreenImg,0,0,this.downloadScreenImg.width,this.downloadScreenImg.height);let dataUri=canvas.toDataURL("image/jpeg",1);jQuery(".screenshot-wrapper-middle-copyright .annotation-customcrop").css("border-color","white");this.get_coords_crop_download(this.downloadScreenImg)});jQuery(".screenshot-wrapper-middle-copyright .annotation-customcropStyle").unbind("change");jQuery(".screenshot-wrapper-middle-copyright .annotation-customcropStyle").on("change",e=>{jQuery(".screenshot-wrapper-middle-copyright .annotation-customcrop").css("border-color","#6b6868");if(this.fillCanvas){this.fillCanvas.removeEventListener("mousedown",this.fillMouseDown)}document.querySelector("#crop-style").value=e.target.value;const item=$(".screenshot-wrapper-middle-copyright .active").attr("data-item");if(item){this.applyOthersCropDownload(item)}});jQuery(".screenshot-wrapper-middle-copyright .annotation-fbcrop").unbind("click");jQuery(".screenshot-wrapper-middle-copyright .annotation-fbcrop").on("click",elem=>{$(".screenshot-wrapper-middle-copyright .active").removeClass("active");elem.currentTarget.classList.add("active");this.applyOthersCropDownload(1)});jQuery(".screenshot-wrapper-middle-copyright .annotation-twittercrop").unbind("click");jQuery(".screenshot-wrapper-middle-copyright .annotation-twittercrop").on("click",elem=>{$(".screenshot-wrapper-middle-copyright .active").removeClass("active");elem.currentTarget.classList.add("active");this.applyOthersCropDownload(2)});jQuery(".screenshot-wrapper-middle-copyright .annotation-linkedIncrop").unbind("click");jQuery(".screenshot-wrapper-middle-copyright .annotation-linkedIncrop").on("click",elem=>{$(".screenshot-wrapper-middle-copyright .active").removeClass("active");elem.currentTarget.classList.add("active");this.applyOthersCropDownload(3)});jQuery(".screenshot-wrapper-middle-copyright .annotation-Instacrop").unbind("click");jQuery(".screenshot-wrapper-middle-copyright .annotation-Instacrop").on("click",elem=>{$(".screenshot-wrapper-middle-copyright .active").removeClass("active");elem.currentTarget.classList.add("active");this.applyOthersCropDownload(7)});jQuery(".screenshot-wrapper-middle-copyright .annotation-ratio1").unbind("click");jQuery(".screenshot-wrapper-middle-copyright .annotation-ratio1").on("click",elem=>{$(".screenshot-wrapper-middle-copyright .active").removeClass("active");elem.currentTarget.classList.add("active");this.applyOthersCropDownload(4)});jQuery(".screenshot-wrapper-middle-copyright .annotation-ratio2").unbind("click");jQuery(".screenshot-wrapper-middle-copyright .annotation-ratio2").on("click",elem=>{$(".screenshot-wrapper-middle-copyright .active").removeClass("active");elem.currentTarget.classList.add("active");this.applyOthersCropDownload(5)});jQuery(".screenshot-wrapper-middle-copyright .annotation-ratio3").unbind("click");jQuery(".screenshot-wrapper-middle-copyright .annotation-ratio3").on("click",elem=>{$(".screenshot-wrapper-middle-copyright .active").removeClass("active");elem.currentTarget.classList.add("active");this.applyOthersCropDownload(6)});jQuery("#quix-crop-annotation-fields-download .annotation-cancel").unbind("click");jQuery("#quix-crop-annotation-fields-download .annotation-cancel").on("click",()=>{this.cancelCropAnnotation()});jQuery("#quix-crop-annotation-fields-download .annotation-save").unbind("click");jQuery("#quix-crop-annotation-fields-download .annotation-save").on("click",()=>{this.saveCropAnnotation()})};saveCropAnnotation=()=>{this.flipRotate=false;this.quixRotateClicked=0;jQuery(".screenshot-wrapper-middle-copyright .annotation-customcrop").css("border-color","#6b6868");$(".screenshot-wrapper-middle-copyright .active").removeClass("active");$(".screenshot-wrapper-middle-copyright .annotation-row .annotation-col.crop-option").css({border:"2px solid transparent","box-shadow":"0px 0px 0px"});if(this.fillCanvas){this.fillCanvas.removeEventListener("mousedown",this.fillMouseDown)}if(jQuery("#screenshot-area-left #canvas_background").length>0){const canvas=document.querySelector("#download-screen-canvas");this.ctxD.clearRect(0,0,this.downloadScreenImg.width,this.downloadScreenImg.height);canvas.width=this.rect.w;canvas.height=this.rect.h;canvas.style.width=this.rect.w+"px";canvas.style.height=this.rect.h+"px";this.downloadScreenHeight=this.rect.h+"px";this.downloadScreenWidth=this.rect.w+"px";this.ctxD.globalAlpha=1;this.ctxD.drawImage(this.downloadScreenImg,this.rect.startX,this.rect.startY,this.rect.w,this.rect.h,0,0,this.rect.w,this.rect.h);jQuery("#screenshot-area-left #canvas_background").remove();if(jQuery("#screenshot-area-left #quix-screen-capture-outer")){jQuery("#screenshot-area-left #quix-screen-capture-outer").remove()}}else if(this.fillApply==1){const canvas=document.querySelector("#download-screen-canvas");this.ctxD.clearRect(0,0,this.downloadScreenImg.width,this.downloadScreenImg.height);canvas.width=this.fillCanvasWidth;canvas.height=this.fillCanvasHeight;canvas.style.width=this.fillCanvasWidth+"px";canvas.style.height=this.fillCanvasHeight+"px";this.downloadScreenHeight=this.fillCanvasHeight+"px";this.downloadScreenWidth=this.fillCanvasWidth+"px";this.ctxD.globalAlpha=1;this.ctxD.drawImage(this.downloadScreenImg,this.relativeFillX,this.relativeFillY,this.fillCanvasWidth,this.fillCanvasHeight,0,0,this.fillCanvasWidth,this.fillCanvasHeight);this.fillApply=0}this.needUploadScreanshotToServer=true;jQuery("#quix-crop-annotation-fields-download").css("display","none");this.saveOthersSettingsAutoDownload("crop")};cancelCropAnnotation=()=>{jQuery(".screenshot-wrapper-middle-copyright .annotation-customcrop").css("border-color","#6b6868");$(".screenshot-wrapper-middle-copyright .active").removeClass("active");$(".screenshot-wrapper-middle-copyright .annotation-row .annotation-col.crop-option").css({border:"2px solid transparent","box-shadow":"0px 0px 0px"});if(this.fillCanvas){this.fillCanvas.removeEventListener("mousedown",this.fillMouseDown)}if(jQuery("#canvas_background")){jQuery("#canvas_background").remove()}if(jQuery("#quix-screen-capture-outer")){jQuery("#quix-screen-capture-outer").remove()}this.ctxD.clearRect(0,0,this.downloadScreenImg.width,this.downloadScreenImg.height);this.ctxD.globalAlpha=1;this.ctxD.drawImage(this.downloadScreenImg,0,0,this.downloadScreenImg.width,this.downloadScreenImg.height);jQuery("#quix-crop-annotation-fields-download").css("display","none")};get_coords_crop_download=async dataUri=>{setTimeout(()=>{jQuery(".canvas_background-ovrly").remove();jQuery("#quix-screen-capture-outer").remove();canvas_background=document.createElement("canvas");canvas_background.classList.add("canvas_background-ovrly");canvas_background.id="canvas_background";canvas_background.style.width=jQuery("#download-screen-canvas").width();canvas_background.style.height=jQuery("#download-screen-canvas").height();canvas_background.width=jQuery("#download-screen-canvas").width();canvas_background.height=jQuery("#download-screen-canvas").height();let canOff=jQuery("#download-screen-canvas").offset();canvas_background.style.position="absolute";if(extPrefix==="OCR_"){canvas_background.style.left=document.querySelector("#download-screen-canvas").offsetLeft+"px"}else{canvas_background.style.left=canOff.left+"px"}canvas_background.style.zIndex="99999";canvas_background.style.cursor="crosshair";document.getElementById("screenshot-area-left").appendChild(canvas_background);this.ctx=canvas_background.getContext("2d");this.ctx.fillStyle="rgba(0, 0, 0, .7)";this.ctx.fillRect(0,0,jQuery("#download-screen-canvas").width(),jQuery("#download-screen-canvas").height());this.init("crop");this.rect.startX=parseFloat(this.rect.startX);this.rect.startY=parseFloat(this.rect.startY);this.rect.w=parseFloat(this.rect.w);this.rect.h=parseFloat(this.rect.h);document.getElementById("canvas_background").addEventListener("click",()=>{let xxCord=this.rect.startX+this.rect.w-55;let yyCord=this.rect.startY+this.rect.h+window.scrollY-26;let screenCaptureControls='<div id="quix-screen-capture-outer" style="left:'+xxCord+"px;top:"+yyCord+'px;"><img id="quix-screen-capture-close" src="'+this.closeIcon+'"><img style="margin-left: 5px;" id="quix-screen-capture-crop" src="'+this.cropIcon+'"></div>';jQuery("#screenshot-area-left").append(screenCaptureControls);jQuery("#quix-screen-capture-outer").css({position:"absolute","z-index":"99999",background:"#000",padding:"5px 5px 2px 5px","border-radius":"7px"});jQuery("#quix-screen-capture-outer img").css({width:"25px","object-fit":"cover",cursor:"pointer"});jQuery("#quix-screen-capture-close").unbind("click");jQuery("#quix-screen-capture-close").on("click",()=>{this.cancelCropAnnotation()});jQuery("#quix-screen-capture-crop").unbind("click");jQuery("#quix-screen-capture-crop").on("click",()=>{this.saveCropAnnotation()})})},500)};init=type=>{canvas_background=document.getElementById("canvas_background");if(type=="crop"&&canvas_background!==null){canvas_background.addEventListener("mousedown",this.mouseDownCrop,false);canvas_background.addEventListener("mouseup",this.mouseUpCrop,false);canvas_background.addEventListener("mousemove",this.mouseMoveCrop,false)}};disableScrolling=()=>{let x=window.scrollX;let y=window.scrollY;window.onscroll=()=>{window.scrollTo(x,y)}};enableScrolling=()=>{window.onscroll=()=>{}};mouseDownCrop=e=>{let canBG=jQuery("#canvas_background").offset();this.rect.startX=e.pageX-parseFloat(canBG.left);this.rect.startY=e.pageY-parseFloat(canBG.top);this.drag=true;jQuery("#quix-screen-capture-outer").remove()};mouseUpCrop=()=>{this.drag=false};mouseMoveCrop=e=>{if(this.drag){this.cropPoints=1;let canBG=jQuery("#canvas_background").offset();this.rect.w=e.pageX-canBG.left-this.rect.startX;this.rect.h=e.pageY-canBG.top-this.rect.startY;this.draw("crop");this.scrollWhileCropping(e,"crop")}};draw=type=>{let winWid=window.innerWidth;let winHei=window.innerHeight;if(type=="crop"){winWid=jQuery("#download-screen-canvas").width();winHei=jQuery("#download-screen-canvas").height();this.cropDimensionsWrite(parseInt(this.rect.startX),parseInt(this.rect.startY),this.rect.w,this.rect.h)}if(this.rect.startX<this.rect.startX+this.rect.w&&this.rect.startY<this.rect.startY+this.rect.h){this.ctx.fillStyle="rgba(0, 0, 0, .7)";this.ctx.clearRect(0,0,winWid,winHei);this.ctx.strokeStyle="#203f99";this.ctx.lineWidth=3;this.ctx.fillRect(0,0,winWid,this.rect.startY);this.ctx.fillRect(0,this.rect.startY,this.rect.startX,winHei-this.rect.startY);this.ctx.fillRect(this.rect.startX,this.rect.startY+this.rect.h,winWid-this.rect.startX,winHei-this.rect.startY-this.rect.h);this.ctx.fillRect(this.rect.startX+this.rect.w,this.rect.startY,winWid-this.rect.startX-this.rect.w,this.rect.h);this.ctx.strokeRect(this.rect.startX,this.rect.startY,this.rect.w,this.rect.h);this.ctx.stroke()}};cropDimensionsWrite=(x,y,w,h)=>{if(x>=0){jQuery("#x-val").val(parseInt(x))}if(y>=0){jQuery("#y-val").val(parseInt(y))}if(w>=0){jQuery("#width-val").val(parseInt(w))}if(h>=0){jQuery("#height-val").val(parseInt(h))}};applyCropDimensions=()=>{let x=jQuery("#x-val").val();let y=jQuery("#y-val").val();let w=jQuery("#width-val").val();let h=jQuery("#height-val").val();this.rect.startX=parseInt(x);this.rect.startY=parseInt(y);this.rect.w=parseInt(w);this.rect.h=parseInt(h);this.draw("crop")};applyTextDimensions=()=>{let x=jQuery("#x-val").val();let y=jQuery("#y-val").val();let w=jQuery("#width-val").val();let h=jQuery("#height-val").val();let fontSize=jQuery("#font-size").val();let lineHeight=fontSize;let fontFamily=jQuery(".text #font-family").val();let fontColor=jQuery(".text #font-color").val();let fontFill=jQuery(".text #fill-color-picker").css("backgroundColor");if(fontFill=="rgba(221, 221, 210, 0.827)"){fontFill="rgba(254, 254, 254, 0)"}let fontOutline=jQuery(".text #outline-color-picker").css("backgroundColor");let fontOutlineSize=jQuery(".text #font-outline-size").val();let i=0;let fontStyle="";jQuery(".text .input-radio-custom-style input").each((index,elem)=>{i++;if(i==1){if($(elem).is(":checked")){jQuery(".outer-svg-fo.text.active #textarea").css({"font-style":"Italic"})}else{jQuery(".outer-svg-fo.text.active #textarea").css({"font-style":"unset"})}}else if(i==2){if($(elem).is(":checked")){jQuery(".outer-svg-fo.text.active #textarea").css({"font-weight":"bold"})}else{jQuery(".outer-svg-fo.text.active #textarea").css({"font-weight":"normal"})}}else if(i==3){if($(elem).is(":checked")){jQuery(".outer-svg-fo.text.active #textarea").css({"text-decoration":"underline"})}else{jQuery(".outer-svg-fo.text.active #textarea").css({"text-decoration":"unset"})}}});let fontAlignment=jQuery(".text input[name=text_alignment]:checked").val();if(fontAlignment=="start"){fontAlignment="left"}else if(fontAlignment=="end"){fontAlignment="right"}let fontFillborder=fontOutlineSize+"px solid "+fontOutline;fontFillborder=fontFillborder;jQuery(".outer-svg-fo.text.active #textarea").css({"font-size":fontSize+"px","line-height":parseInt(fontSize)+1+"px","font-family":fontFamily,"text-align":fontAlignment,color:fontColor,background:fontFill,border:fontFillborder})};adjustTextAreaAutomatically=()=>{if(jQuery(".outer-svg-fo.active.text").length>0){let screenWidth=document.querySelector("#captured-screen").style.width.split("px")[0];screenWidth=parseInt(screenWidth)-100;let screenHeight=document.querySelector("#captured-screen").style.height.split("px")[0];screenHeight=parseInt(screenHeight)-100;let fontSize=parseInt(jQuery("#font-size").val());const textContent=jQuery(".outer-svg-fo.text.active #textarea").text();const closestForeignObject=jQuery(".outer-svg-fo.text.active #textarea").closest("foreignObject");if(textContent.length>0){let textScrollH=jQuery(".outer-svg-fo.text.active #textarea").prop("scrollHeight");let w=parseInt(jQuery(".outer-svg-fo.active.text").find("foreignObject").attr("width"));let h=parseInt(jQuery(".outer-svg-fo.active.text").find("foreignObject").attr("height"));var diffBet=textScrollH-h;if(textScrollH!==undefined&&textScrollH>0&&diffBet>0){var incW=parseInt(w)+parseInt(textScrollH/3);if(incW>screenWidth){incW=screenWidth}closestForeignObject.width(incW+"px");closestForeignObject.attr("width",incW+"px");var tScrollH=jQuery(".outer-svg-fo.text.active #textarea").prop("scrollHeight");if(tScrollH!==undefined&&tScrollH>0){var incH=parseInt(tScrollH+parseInt(fontSize));if(incH>screenHeight){incH=screenHeight}if(closestForeignObject.length>0){closestForeignObject.height(incH+"px");closestForeignObject.attr("height",incH+"px")}}}}else{const minHeight="100px";const minWidth="100px";closestForeignObject.width(minWidth);closestForeignObject.attr("width",minWidth);closestForeignObject.height(minHeight);closestForeignObject.attr("height",minHeight)}}};autoadjustScreenshotDownload=(wid,hei)=>{let nW=wid;let nH=hei;jQuery("#download-screen-canvas").css({width:nW+"px",height:nH+"px"});jQuery("#download-screen-canvas-blur").attr({width:nW,height:nH});jQuery("#download-screen-canvas-blur").css({width:nW+"px",height:nH+"px"});let windW;if(extPrefix=="OCR_"){windW=jQuery("#screenshot-wrapper-bottom").width()-275}else{windW=jQuery("#screenshot-wrapper-bottom").width()-30}let CW=nW/windW;let percent=Math.floor(100/CW/10)*10;let stati=100-percent;zoomValuePercent=100;if(stati<0){stati=0}this.quixyZoomOut(stati)};autoadjustScreenshot=(wid,hei)=>{let nW=wid;let nH=hei;jQuery("#captured-screen").css({width:nW+"px",height:nH+"px"});jQuery("#captured-screen-blur").attr({width:nW,height:nH});jQuery("#captured-screen-blur").css({width:nW+"px",height:nH+"px"});let CW,percent,stati;let windW=jQuery("#screenshot-wrapper-bottom").width()-30;if(extPrefix=="OCR_"){CW=nW/windW;percent=Math.floor(100/CW/30)*30;stati=100-percent}else{CW=nW/windW;percent=Math.floor(100/CW/10)*10;stati=100-percent}zoomValuePercent=100;if(stati<0){stati=0}this.quixyZoomOut(stati)};distanceBetween=(point1,point2)=>{return Math.sqrt(Math.pow(point2.x-point1.x,2)+Math.pow(point2.y-point1.y,2))};angleBetween=(point1,point2)=>{return Math.atan2(point2.x-point1.x,point2.y-point1.y)};iconMouseOver=obj=>{if(!jQuery(obj).hasClass("active")){let path1=jQuery(obj).find(".sideBar-li-inner img").attr("data-src-active");let path2=jQuery(obj).find(".sideBar-li-inner img").attr("data-bg-active")}};iconMouseOut=obj=>{if(!jQuery(obj).hasClass("active")){let path1=jQuery(obj).find(".sideBar-li-inner img").attr("data-src-inactive");let path2=jQuery(obj).find(".sideBar-li-inner img").attr("data-bg-inactive")}};iconMouseClick=(obj,parent)=>{let allItems=jQuery(parent);for(let i=0;i<allItems.length;i++){let path1=jQuery(allItems[i]).find(".sideBar-li-inner img").attr("data-src-inactive");let path2=jQuery(allItems[i]).find(".sideBar-li-inner img").attr("data-bg-inactive");jQuery(allItems[i]).removeClass("active")}jQuery(obj).addClass("active");let path1=jQuery(obj).find(".sideBar-li-inner img").attr("data-src-active");let path2=jQuery(obj).find(".sideBar-li-inner img").attr("data-bg-active");jQuery(obj).addClass("active")};iconMouseToggle=(obj,parent)=>{if(jQuery(obj).hasClass("active")){let path1=jQuery(obj).find(".sideBar-li-inner img").attr("data-src-inactive");jQuery(obj).removeClass("active")}else{let path1=jQuery(obj).find(".sideBar-li-inner img").attr("data-src-active");jQuery(obj).addClass("active")}};updateCanvasByAnno=(canvas,callback)=>{let source;let mainSVG=document.querySelector(".mainSVG");let tempWid;let tempheight;if(mainSVG){tempWid=mainSVG.getAttribute("width");tempheight=mainSVG.getAttribute("height");mainSVG.setAttribute("width",canvas.width);mainSVG.setAttribute("height",canvas.height)}let imgData;if(this.isWhiteSpace){if(source===undefined||source==""){source=canvas.toDataURL("image/jpeg",1);if(mainSVG){let serializer=new XMLSerializer;let svgString=serializer.serializeToString(mainSVG);imgData=`data:image/svg+xml,${encodeURIComponent(svgString)}`}}let image=new Image;image.onload=async()=>{this.checkWhereAnnoDrawn(image,async res=>{let can=document.createElement("canvas");if(this.fillUsed==false&&this.fitUsed==false&&this.isPrevFillCropDone==false){can.height=image.height;can.width=image.width;let context=can.getContext("2d");context.imageSmoothingEnabled=false;context.drawImage(canvas,0,0,image.width,image.height,0,0,image.width,image.height);if(mainSVG){context.drawImage(image,0,0,tempWid,tempheight,0,0,image.width,image.height)}let _this=this;function calculateNewTransform(oldWidth,oldHeight,oldX,oldY,newWidth,newHeight){const scaleX=newWidth/oldWidth;const scaleY=newHeight/oldHeight;const newX=oldX*scaleX;const newY=oldY*scaleY;return{newX:newX,newY:newY,scaleX:scaleX,scaleY:scaleY}}async function processBlurElements(){let blurElements=jQuery(".outer-svg-fo.blur");if(blurElements.length>0){_this.blurElementsCount=blurElements.length;blurElements.each(function(index,blurElement){let foreignElem=jQuery(blurElement).find("foreignObject");let blurVal=jQuery(blurElement).find("svg").css("backdrop-filter");blurVal=_this.extractBlurValue(blurVal);let transformVal=jQuery(foreignElem).css("transform");let translateVal=_this.extractTranslateFromMatrix(transformVal);const{newX,newY,scaleX,scaleY}=calculateNewTransform(tempWid,tempheight,translateVal.x,translateVal.y,can.width,can.height);let x=newX;let y=newY;let w=parseInt(jQuery(foreignElem).css("width"),10);let h=parseInt(jQuery(foreignElem).css("height"),10);let newWidthBlur=w*scaleX;let newHeightBlur=h*scaleY;w=newWidthBlur;h=newHeightBlur;let tempCanvas=document.createElement("canvas");tempCanvas.width=w;tempCanvas.height=h;let tempContext=tempCanvas.getContext("2d");tempContext.clearRect(0,0,w,h);tempContext.drawImage(can,x,y,w,h,0,0,w,h);let blurStrength=blurVal*2;tempContext.filter=`blur(${blurStrength}px)`;tempContext.drawImage(tempCanvas,0,0);context.clearRect(x,y,w,h);context.drawImage(tempCanvas,0,0,w-1,h-1,x,y,w,h)});return true}}await processBlurElements()}let src=can.toDataURL("image/jpeg",1);if(helpers.watermark&&canvas.id=="padding-screen"){}else{callback(src,res)}if(mainSVG){mainSVG.setAttribute("width",tempWid);mainSVG.setAttribute("height",tempheight)}})};if(mainSVG){image.src=imgData}else{image.src=source}}else{if(helpers.watermark){}else{callback(src)}}};applyWatermark=type=>{let _this=this;let mainCanvas=document.getElementById("captured-screen");let mainCtx=mainCanvas.getContext("2d");let img=document.createElement("img");img.src=this.firstScreenShot;img.onload=()=>{mainCtx.clearRect(0,0,mainCanvas.width,mainCanvas.height);mainCtx.globalAlpha=1;mainCtx.drawImage(img,0,0,mainCanvas.width,mainCanvas.height);let watermarkSettings;if(type=="custom"){watermarkSettings=helpers.watermarkSettings[0]}else{watermarkSettings=helpers.accountWaterMarkSettings}if(watermarkSettings){let waterMarkText=watermarkSettings.text_screenshot?watermarkSettings.text_screenshot:"";let waterMarkPos=watermarkSettings.position_screenshot?watermarkSettings.position_screenshot:'{"position":"C","x":20,"y":20}';let waterMarkImg=watermarkSettings.image_screenshot?watermarkSettings.image_screenshot:"";let waterMarkTransprency=watermarkSettings.screenshot_transparency?watermarkSettings.screenshot_transparency:.3;if(waterMarkText){waterMarkText=waterMarkText}let cw,ch;cw=mainCanvas.width;ch=mainCanvas.height;if(waterMarkImg!=""){let watermarkImage=new Image;watermarkImage.src=waterMarkImg;watermarkImage.onload=function(){let aspectR=watermarkImage.width/watermarkImage.height;let imageWidth=150;let imageHeight=parseInt(imageWidth/aspectR);let imageWmPos=calculateWatermarkPos(waterMarkPos,cw,ch,imageWidth,imageHeight,"image");mainCtx.globalAlpha=waterMarkTransprency;mainCtx.drawImage(watermarkImage,imageWmPos.x,imageWmPos.y,imageWidth,imageHeight);_this.firstScreenShotAddedWaterMark=mainCanvas.toDataURL()}}else if(waterMarkText!=""){mainCtx.font=waterMarkText.fontSize+"px verdana";let textWidth=mainCtx.measureText(waterMarkText).width;let textHeight=parseInt(waterMarkText.fontSize);let wmPos=calculateWatermarkPos(waterMarkPos,cw,ch,textWidth,textHeight,"text");mainCtx.globalAlpha=waterMarkTransprency;mainCtx.fillStyle=waterMarkText.fontColor;mainCtx.fillText(waterMarkText.text,wmPos.x,wmPos.y);_this.firstScreenShotAddedWaterMark=mainCanvas.toDataURL()}else{}}};function calculateWatermarkPos(waterMarkPos,cw,ch,itemWidth,itemHeight,type){waterMarkPos=waterMarkPos;let wmloc=waterMarkPos.position?waterMarkPos.position:"C";let wmlocX=waterMarkPos.x?parseInt(waterMarkPos.x):20;let wmlocY=waterMarkPos.y?parseInt(waterMarkPos.y):20;let x;let y;if(wmloc=="LT"){x=wmlocX;y=wmlocY;if(type=="text"){y+=itemHeight}}else if(wmloc=="LB"){x=wmlocX;y=ch-(itemHeight+wmlocY)}else if(wmloc=="RT"){x=cw-(itemWidth+wmlocX);y=wmlocY;if(type=="text"){y+=itemHeight}}else if(wmloc=="RB"){x=cw-(itemWidth+wmlocX);y=ch-(itemHeight+wmlocY)}else{x=(cw-itemWidth)/2;y=(ch-itemHeight)/2}_this.waterMarkAnnotations={x:x,y:y,w:itemWidth,h:itemHeight,type:"watermark"};return{x:x,y:y}}};calWhiteArea=async value=>{return new Promise((resolve,reject)=>{switch(value){case 20:value=40;break;case 30:value=60;break;case 40:value=80;break;case 50:value=100;break;case 60:value=120;break;case 70:value=140;break;case 80:value=160;break;case 90:value=180;break;case 100:value=200;break;case 110:value=220;break;case 120:value=240;break;case 130:value=260;break;case 140:value=280;break;case 150:value=300;break;case 160:value=320;break;case 170:value=340;break;case 180:value=360;break;case 190:value=380;break;case 200:value=400;break;default:resolve(value)}resolve(value)})};updateCoordinates=async(obj,value)=>{return new Promise((resolve,reject)=>{switch(value){case 20:obj.x+=180;obj.y+=180;break;case 30:obj.x+=140;obj.y+=140;break;case 40:obj.x+=120;obj.y+=120;break;case 50:obj.x+=100;obj.y+=100;break;case 60:obj.x+=80;obj.y+=80;break;case 70:obj.x+=60;obj.y+=60;break;case 80:obj.x+=40;obj.y+=40;break;case 90:obj.x+=20;obj.y+=20;break;case 100:obj.x+=0;obj.y+=0;break;case 110:obj.x-=20;obj.y-=20;break;case 120:obj.x-=40;obj.y-=40;break;case 130:obj.x-=60;obj.y-=60;break;case 140:obj.x-=80;obj.y-=80;break;case 150:obj.x-=100;obj.y-=100;break;case 160:obj.x-=120;obj.y-=120;break;case 170:obj.x-=140;obj.y-=140;break;case 180:obj.x-=160;obj.y-=160;break;case 190:obj.x-=180;obj.y-=180;break;case 200:obj.x-=200;obj.y-=200;break;default:resolve(obj)}resolve(obj)})};SVGcheckWhereAnnoDrawn=async(image,callback)=>{let x=0;let y=0;let w=150;let h=150;if(this.svgCordinates.length>0){for(let i=0;i<=this.svgCordinates.length-1;i++){let object={};if(!this.svgCordinates[i].element){const wid=parseInt(this.svgCordinates[i].querySelector("foreignObject").getAttribute("width"));const hei=parseInt(this.svgCordinates[i].querySelector("foreignObject").getAttribute("height"));const array=this.svgCordinates[i]?.querySelector("foreignObject")?.style.transform;if(array){const transformString=array;const translateStart=transformString.indexOf("translate(");const translateEnd=transformString.indexOf(")",translateStart);if(translateStart!==-1&&translateEnd!==-1){const translateValues=transformString.substring(translateStart+"translate(".length,translateEnd).split(",");if(translateValues.length===2){const translateX=translateValues[0].trim();const translateY=translateValues[1].trim();x=parseInt(translateX.split("px")[0]);y=parseInt(translateY.split("px")[0]);x=x;y=y}else{}}}if(wid&&hei){w=wid;h=hei}else if(wid){w=wid;h=wid}else if(hei){w=hei;h=hei}else{w=100;h=100}object={x:x,y:y,w:w,h:h}}else if(this.svgCordinates[i].arrow){const x1=this.svgCordinates[i].x.x1;const x2=this.svgCordinates[i].x.x2;const y1=this.svgCordinates[i].y.y1;const y2=this.svgCordinates[i].y.y2;if(x1<x2){x=x1}else{x=x2}if(y1<y2){y=y1}else{y=y2}w=Math.abs(x2-x1);h=Math.abs(y2-y1);object={x:x,y:y,w:w,h:h}}else if(this.svgCordinates[i].action=="line"){const x1=this.svgCordinates[i].x1;const x2=this.svgCordinates[i].x2;const y1=this.svgCordinates[i].y1;const y2=this.svgCordinates[i].y2;if(x1<x2){x=x1}else{x=x2}if(y1<y2){y=y1}else{y=y2}w=Math.abs(x2-x1);h=Math.abs(y2-y1);object={x:x,y:y,w:w,h:h}}cooridnatesDrawnAt.push(object)}}if(this.freeHandCordinates.length>0){let _this=this;let lines=document.querySelectorAll(".mainSVG .freeHand");for(const path of lines){const boundingBox=_this.getPathBoundingBox(path);x=boundingBox.minX;y=boundingBox.minY;w=boundingBox.width;h=boundingBox.height;let object={x:x,y:y,w:w,h:h};cooridnatesDrawnAt.push(object)}}return true};checkWhereAnnoDrawn=async(image,callback)=>{let _this=this;await this.SVGcheckWhereAnnoDrawn(image);if(this.waterMarkAnnotations){cooridnatesDrawnAt.push(this.waterMarkAnnotations)}let topDraw=0;let bottomDraw=0;let leftDraw=0;let rightDraw=0;for(let i=0;i<cooridnatesDrawnAt.length;i++){let value=parseInt(document.querySelector(".screenshot-actions .zoom-quix-status").innerHTML);value=await this.calWhiteArea(value);let object=cooridnatesDrawnAt[i];let x=parseInt(object.x);let y=parseInt(object.y);let w=parseInt(object.w);let h=parseInt(object.h);let SShape=object.selectedShape;const width1=parseInt(document.querySelector("#captured-screen").style.width);const height1=parseInt(document.querySelector("#captured-screen").style.height);let rightSide,bottomSide;if(object.type!=="watermark"){rightSide=width1-value;bottomSide=height1-value}else{rightSide=image.width-this.whiteSpaceAround;bottomSide=image.height-this.whiteSpaceAround;value=this.whiteSpaceAround}if(SShape=="arrow"||SShape=="line"){if(w<0){x=x+w;w=Math.abs(w)}if(h<0){y=y+h;h=Math.abs(h)}}if(x<value){leftDraw=1}if(y<value){topDraw=1}if(x+w>rightSide){rightDraw=1}if(y+h>bottomSide){bottomDraw=1}}this.whereAnnoDrawArray.push({bottomDraw:bottomDraw,topDraw:topDraw,leftDraw:leftDraw,rightDraw:rightDraw});const data=this.whereAnnoDrawArray.map(data=>data);if(data.length>=2){const lastData=data[data.length-1];const secondLastData=data[data.length-2];const isChanged=JSON.stringify(lastData)!==JSON.stringify(secondLastData);if(isChanged){checkAnnoPositionChanged=true}else{checkAnnoPositionChanged=false}}else{checkAnnoPositionChanged=false}callback({bottomDraw:bottomDraw,topDraw:topDraw,leftDraw:leftDraw,rightDraw:rightDraw});cooridnatesDrawnAt.length=0};getPathBoundingBox(path){let pathData=path.getAttribute("d");let coordinates=pathData.match(/-?\d+(\.\d+)?/g).map(parseFloat);let minX=Infinity,minY=Infinity,maxX=-Infinity,maxY=-Infinity;for(let i=0;i<coordinates.length;i+=2){let x=coordinates[i];let y=coordinates[i+1];minX=Math.min(minX,x);minY=Math.min(minY,y);maxX=Math.max(maxX,x);maxY=Math.max(maxY,y)}let width=maxX-minX;let height=maxY-minY;return{minX:minX,minY:minY,width:width,height:height}}addCoordinatestoLoop=type=>{let x=jQuery("#x-val").val();let y=jQuery("#y-val").val();let w=jQuery("#width-val").val();let h=jQuery("#height-val").val();if(type!==undefined){cooridnatesDrawnAt.push({selectedShape:"",x:parseInt(x/zoomValuePercentRatio),y:parseInt(y/zoomValuePercentRatio),w:w,h:h})}else{cooridnatesDrawnAt.push({selectedShape:this.selectedShape,x:x,y:y,w:w,h:h})}chrome.runtime.sendMessage({type:"updateCordinates",cooridnatesDrawnAt:cooridnatesDrawnAt})};applyBlurDimensions=()=>{let blurStrength=jQuery("#blur-strength").val();blurStrength=blurStrength+"px";jQuery(".outer-svg-fo.active.blur svg").css({"backdrop-filter":"blur("+blurStrength+")"})};applyOthersFlip=()=>{let upCanvas=document.getElementById("download-screen-canvas");this.ctxD2=upCanvas.getContext("2d");this.ctxD2.clearRect(0,0,upCanvas.width,upCanvas.height);this.ctxD2.imageSmoothingEnabled=false;this.ctxD2.imageSmoothingQuality="high";this.ctxD2.drawImage(this.imageObjD,0,0);this.ctxD2.scale(-1,1);this.ctxD2.drawImage(upCanvas,-upCanvas.width,0);this.ctxD2.scale(-1,1);this.saveOthersSettingsAutoDownload("flip");this.flipCanvasImage()};flipCanvasImage=()=>{this.flipRotate=true;let upCanvas=document.getElementById("download-screen-canvas");let ctx=upCanvas.getContext("2d");ctx.clearRect(0,0,upCanvas.width,upCanvas.height);ctx.imageSmoothingEnabled=false;ctx.imageSmoothingQuality="high";ctx.drawImage(this.downloadScreenImgflip,0,0);ctx.scale(-1,1);ctx.drawImage(this.downloadScreenImgflip,-upCanvas.width,0);ctx.scale(-1,1);let flippedImageSrc=upCanvas.toDataURL();let flippedImage=new Image;flippedImage.onload=()=>{this.downloadScreenImgflip=flippedImage};flippedImage.src=flippedImageSrc};rotateimg=()=>{let obj=this;this.flipRotate=true;const canvas=document.createElement("canvas");let upCanvas=document.getElementById("download-screen-canvas");canvas.width=upCanvas.width;canvas.height=upCanvas.height;let ctx=canvas.getContext("2d");ctx.drawImage(this.downloadScreenImgflip,0,0);let cw=canvas.width;let ch=canvas.height;let myImageData=new Image;myImageData.src=canvas.toDataURL();const one=async()=>{canvas.width=ch;canvas.height=cw;cw=canvas.width;ch=canvas.height;ctx.imageSmoothingEnabled=false;ctx.imageSmoothingQuality="high";ctx.save();ctx.translate(cw,ch/cw);ctx.rotate(Math.PI/2);ctx.drawImage(myImageData,0,0);ctx.restore();this.downloadScreenImgflip.src=canvas.toDataURL("image/jpeg");myImageData=null;if(this.quixRotateClicked%2!==0){canvas.style.height=obj.downloadScreenWidth;canvas.style.width=obj.downloadScreenHeight}else{canvas.style.width=obj.downloadScreenWidth;canvas.style.height=obj.downloadScreenHeight}};myImageData.onload=one};removeCropDownloadAnnotation=()=>{jQuery(".screenshot-wrapper-middle-copyright .annotation-customcrop").css("border-color","#6b6868");$(".screenshot-wrapper-middle-copyright .active").removeClass("active");$(".screenshot-wrapper-middle-copyright .annotation-row .annotation-col.crop-option").css({border:"2px solid transparent","box-shadow":"0px 0px 0px"});if(this.fillCanvas){this.fillCanvas.removeEventListener("mousedown",this.fillMouseDown);this.ctxD.clearRect(0,0,this.downloadScreenImg.width,this.downloadScreenImg.height);this.ctxD.globalAlpha=1;this.ctxD.drawImage(this.downloadScreenImg,0,0,this.downloadScreenImg.width,this.downloadScreenImg.height)}if(jQuery("#canvas_background")){jQuery("#canvas_background").remove();this.ctxD.clearRect(0,0,this.downloadScreenImg.width,this.downloadScreenImg.height);this.ctxD.globalAlpha=1;this.ctxD.drawImage(this.downloadScreenImg,0,0,this.downloadScreenImg.width,this.downloadScreenImg.height)}if(jQuery("#screenshot-area-left #quix-screen-capture-outer")){jQuery("#screenshot-area-left #quix-screen-capture-outer").remove()}};removePaddingBorderAnnotationToolbar=type=>{let _this=this;jQuery(".screenshot-wrapper-middle-copyright .annotation-customcrop").css("border-color","#6b6868");$(".screenshot-wrapper-middle-copyright .active").removeClass("active");$(".screenshot-wrapper-middle-copyright .annotation-row .annotation-col.crop-option").css({border:"2px solid transparent","box-shadow":"0px 0px 0px"});const paddingAnnoToolBar=document.querySelector("#quix-padding-annotation-fields-download");const cropAnnoToolBar=document.querySelector("#quix-crop-annotation-fields-download");const paddingGradientPopup=document.querySelector("#quix-padding-annotation-fields-download #paddingGColor-input");if(cropAnnoToolBar){cropAnnoToolBar.style.display="none"}if(paddingGradientPopup){paddingGradientPopup.style.display="none"}if(paddingAnnoToolBar){paddingAnnoToolBar.style.display="none";if(type=="reset"){document.querySelector("#borderRadius-input").value=0;document.querySelector("#borderSize-val").value=0;document.querySelector("#paddingSize-val").value=0;document.querySelector("#borderColor-picker").style.backgroundColor="#ff0000";document.querySelector("#paddingColor-picker").style.backgroundColor="#ff0";document.querySelector("#paddingColor-input").value="#ff0";document.querySelector("#borderColor-input").value="#ff0000";jQuery("#paddingColor-picker").spectrum({move:tinycolor=>{let color=tinycolor.toRgbString();_this.selectedPaddingGradientColor=null;jQuery("#paddingColor-picker").css("background-color","#"+color);jQuery("#paddingColor-input").val(color);_this.applyOthersBlockDimensions()},show:tinycolor=>{_this.isChanged=false;_this.previouscolor=tinycolor;_this.offGradientBox()},hide:tinycolor=>{if(!_this.isChanged&&_this.previouscolor){let color=tinycolor.toRgbString();jQuery("#paddingColor-picker").css("background-color","#"+color);jQuery("#paddingColor-input").val(color);_this.applyOthersBlockDimensions()}},change:tinycolor=>{_this.isChanged=true},color:"#ff0",showAlpha:true,showButtons:true,showInput:true,allowEmpty:true,preferredFormat:"rgb"});jQuery("#borderColor-picker").spectrum({move:tinycolor=>{let color=tinycolor.toRgbString();jQuery("#borderColor-picker").css("background-color","#"+color);jQuery("#borderColor-input").val(color);_this.applyOthersBlockDimensions()},show:tinycolor=>{_this.isChanged=false;_this.previouscolor=tinycolor;_this.offGradientBox()},hide:tinycolor=>{if(!_this.isChanged&&_this.previouscolor){let color=tinycolor.toRgbString();jQuery("#borderColor-picker").css("background-color","#"+color);jQuery("#borderColor-input").val(color);_this.applyOthersBlockDimensions()}},change:tinycolor=>{_this.isChanged=true},color:"#ff0000",showAlpha:true,showButtons:true,showInput:true,allowEmpty:true,preferredFormat:"rgb"})}}};cropImageRatios=async function(aspectRatioWidth,aspectRatioHeight,img){var width=img.width;var height=img.height;var ratio=aspectRatioWidth/aspectRatioHeight;var newWidth,newHeight,offsetX,offsetY;if(width/height>ratio){newHeight=height;newWidth=height*ratio;offsetX=(width-newWidth)/2;offsetY=0}else{newWidth=width;newHeight=width/ratio;offsetX=0;offsetY=(height-newHeight)/2}return{newWidth:newWidth,newHeight:newHeight,offsetX:offsetX,offsetY:offsetY}};ifValidScreenshot(upCanvas,cropStyle,cropW,cropH){if(this.fillCanvas){this.fillCanvas.removeEventListener("mousedown",this.fillMouseDown)}const widUpCanvas=parseInt(upCanvas.style.width);const heiUpCanvas=parseInt(upCanvas.offsetHeight);if(cropStyle=="fill"&&widUpCanvas<cropW&&heiUpCanvas<cropH){this.removeCropDownloadAnnotation();$(".screenshot-wrapper-middle-copyright .active").removeClass("active");$(".screenshot-wrapper-middle-copyright .annotation-row .annotation-col.crop-option").css({border:"2px solid transparent","box-shadow":"0px 0px 0px"});helpers.failureMessagePopup("Oops! Something went wrong","Crop dimensions are more than captured screenshot, Please choose custom crop.");return false}return true}applyOthersCropDownload=async cropType=>{if(jQuery("#screenshot-area-left #canvas_background")){jQuery("#screenshot-area-left #canvas_background").remove()}if(jQuery("#screenshot-area-left #quix-screen-capture-outer")){jQuery("#screenshot-area-left #quix-screen-capture-outer").remove()}jQuery(".screenshot-wrapper-middle-copyright .annotation-customcrop").css("border-color","#6b6868");$(".screenshot-wrapper-middle-copyright .annotation-row .annotation-col.crop-option").css({border:"2px solid transparent","box-shadow":"0px 0px 0px"});$(".screenshot-wrapper-middle-copyright .active .annotation-col.crop-option").css({border:"2px solid white","box-shadow":"0px 0px 5px white"});let upCanvas=document.getElementById("download-screen-canvas");let cropStyle=document.querySelector("#crop-style").value;let ww=upCanvas.style.width;let hh=upCanvas.style.height;if(!this.downloadScreenImg){this.downloadScreenImg=this.downloadScreenImg0}this.ctxD=upCanvas.getContext("2d");let outputW;let outputH;if(cropType==1||cropType==2||cropType==3){outputW=1200;outputH=630;if(!this.ifValidScreenshot(upCanvas,cropStyle,outputW,outputH)){return false}}else if(cropType==4){outputW=1856;outputH=1076;const{newWidth,newHeight,offsetX,offsetY}=await this.cropImageRatios(1,1,upCanvas);outputW=newWidth;outputH=newHeight;if(!this.ifValidScreenshot(upCanvas,cropStyle,outputW,outputH)){return false}}else if(cropType==5){outputW=1200;outputH=600;const{newWidth,newHeight,offsetX,offsetY}=await this.cropImageRatios(3,2,upCanvas);outputW=newWidth;outputH=newHeight;if(!this.ifValidScreenshot(upCanvas,cropStyle,outputW,outputH)){return false}}else if(cropType==6){outputW=1200;outputH=700;const{newWidth,newHeight,offsetX,offsetY}=await this.cropImageRatios(4,3,upCanvas);outputW=newWidth;outputH=newHeight;if(!this.ifValidScreenshot(upCanvas,cropStyle,outputW,outputH)){return false}}else if(cropType==7){outputW=557;outputH=557;if(!this.ifValidScreenshot(upCanvas,cropStyle,outputW,outputH)){return false}}else{outputW=1200;outputH=700;if(!this.ifValidScreenshot(upCanvas,cropStyle,outputW,outputH)){return false}}if(cropStyle=="fill"){this.fillCanvas=document.getElementById("download-screen-canvas");this.fillCanvas.removeEventListener("mousedown",this.fillMouseDown);this.fillCanvas.width=this.downloadScreenImg.width;this.fillCanvas.height=this.downloadScreenImg.height;this.ctxD.fillStyle="rgba(0, 0, 0, 1)";this.ctxD.fillRect(0,0,this.fillCanvas.width,this.fillCanvas.height);this.ctxD.globalAlpha=.5;this.ctxD.drawImage(this.downloadScreenImg,0,0,this.downloadScreenImg.width,this.downloadScreenImg.height);let dataUri=this.fillCanvas.toDataURL("image/jpeg",1);let canvasW=this.downloadScreenImg.width;let canvasH=this.downloadScreenImg.height;if(outputW>canvasW){outputW=canvasW}if(outputH>canvasH){outputH=canvasH}let wid=outputW*zoomValuePercentRatio;let hei=outputH*zoomValuePercentRatio;let canX=(canvasW-outputW)/2;let canY=(canvasH-outputH)/2;const screenshotAreaLeft=document.querySelector("#screenshot-area-left");const scrollTop=screenshotAreaLeft.scrollTop;const downloadScreenOffSetY=document.querySelector("#download-screen-canvas").getBoundingClientRect().top;const windowVisibleHeight=window.innerHeight-downloadScreenOffSetY;if(scrollTop>=0&&hei<windowVisibleHeight){if(hei/2+hei>windowVisibleHeight&&hei/2+hei<canvasH){canY=scrollTop+100}else if(hei/2+hei>canvasH){canY=scrollTop+10}else{canY=scrollTop+hei/2}}else if(scrollTop>=0&&hei>windowVisibleHeight){canY=scrollTop+10}canX=Math.max(10,canX);canY=Math.max(5,canY);if(canX<0){canX=0}if(canY<0){canY=0}this.ctxD.globalAlpha=1;this.ctxD.drawImage(this.downloadScreenImg,canX,canY,wid,hei,canX,canY,wid,hei);this.relativeFillX=canX;this.relativeFillY=canY;this.fillCanvasWidth=wid;this.fillCanvasHeight=hei;this.fillArea={startX:canX,startY:canY,width:wid,height:hei};let divOffset=$(this.fillCanvas).offset();this.fillMouseDown=e=>{this.relativeFillX=e.clientX-divOffset.left;this.relativeFillY=e.clientY-divOffset.top;this.dragOffsetX=e.clientX-divOffset.left-canX;this.dragOffsetY=e.clientY-divOffset.top-canY;this.isFillDragable=true;this.fillCanvas.style.cursor="move";this.fillCanvas.addEventListener("mousemove",fillMouseMove)};const fillMouseMove=e=>{if(this.isFillDragable){this.ctxD.clearRect(0,0,upCanvas.width,upCanvas.height);this.ctxD.fillStyle="rgba(0, 0, 0, 1)";this.ctxD.fillRect(0,0,this.fillCanvas.width,this.fillCanvas.height);this.ctxD.globalAlpha=.5;this.ctxD.drawImage(this.downloadScreenImg,0,0,this.downloadScreenImg.width,this.downloadScreenImg.height);this.ctxD.globalAlpha=1;const newRelativeFillX=e.clientX-divOffset.left-this.dragOffsetX;const newRelativeFillY=e.clientY-divOffset.top-this.dragOffsetY;const maxWidth=this.downloadScreenImg.width-wid;const maxHeight=this.downloadScreenImg.height-hei;const constrainedX=Math.min(Math.max(newRelativeFillX,0),maxWidth);const constrainedY=Math.min(Math.max(newRelativeFillY,0),maxHeight);this.ctxD.drawImage(this.downloadScreenImg,constrainedX,constrainedY,wid,hei,constrainedX,constrainedY,wid,hei);this.relativeFillX=constrainedX;this.relativeFillY=constrainedY;canX=constrainedX;canY=constrainedY;window.addEventListener("mouseup",fillMouseUp)}};const fillMouseUp=()=>{this.fillCanvas.style.cursor="default";this.ctxD.clearRect(0,0,upCanvas.width,upCanvas.height);this.ctxD.fillStyle="rgba(0, 0, 0, 1)";this.ctxD.fillRect(0,0,this.fillCanvas.width,this.fillCanvas.height);this.ctxD.globalAlpha=.5;this.ctxD.drawImage(this.downloadScreenImg,0,0,this.downloadScreenImg.width,this.downloadScreenImg.height);this.ctxD.globalAlpha=1;this.ctxD.drawImage(this.downloadScreenImg,this.relativeFillX,this.relativeFillY,wid,hei,this.relativeFillX,this.relativeFillY,wid,hei);this.fillDraggableArea={startX:this.relativeFillX,startY:this.relativeFillY,width:wid,height:hei};this.fillArea={startX:this.relativeFillX,startY:this.relativeFillY,width:wid,height:hei};this.fillCanvasWidth=wid;this.fillCanvasHeight=hei;this.fillApply=1;this.isFillDragable=false;this.fillCanvas.removeEventListener("mousemove",fillMouseMove);window.removeEventListener("mouseup",fillMouseUp)};this.fillCanvas.mousedownListener=this.fillMouseDown;this.fillCanvas.addEventListener("mousedown",this.fillMouseDown);this.fillApply=1}else{if(this.fillCanvas){this.fillCanvas.removeEventListener("mousedown",this.fillMouseDown)}let canvasW=this.downloadScreenImg.width;let canvasH=this.downloadScreenImg.height;let canvasAspectRatio=canvasW/canvasH;let imageAspectRatio=outputW/outputH;if(canvasAspectRatio>imageAspectRatio){canvasW=outputW;canvasH=outputW/canvasAspectRatio}else{canvasH=outputH;canvasW=outputH*canvasAspectRatio}let canX=(canvasW-outputW)/2;let canY=(canvasH-outputH)/2;upCanvas.width=outputW;upCanvas.height=outputH;let wid=outputW*zoomValuePercentRatio;let hei=outputH*zoomValuePercentRatio;this.ctxD.fillStyle="rgba(0, 0, 0, 1)";this.ctxD.fillRect(0,0,upCanvas.width,upCanvas.height);let sx=0;let sy=0;let sw=this.downloadScreenImg.width;let sh=this.downloadScreenImg.height;let dx=-canX;let dy=-canY;let dw=canvasW;let dh=canvasH;this.ctxD.drawImage(this.downloadScreenImg,sx,sy,sw,sh,dx,dy,dw,dh)}};applyOthersGradient=gradType=>{let canvasO=document.getElementById("download-screen-canvas");let ctxO=canvasO.getContext("2d");if(gradType==1){gradient=ctxO.createLinearGradient(0,0,canvasO.width,0);gradient.addColorStop(0,"red");gradient.addColorStop(.5,"green");gradient.addColorStop(1,"blue")}if(gradType==2){gradient=ctxO.createLinearGradient(0,0,canvasO.width,0);gradient.addColorStop(0,"yellow");gradient.addColorStop(.5,"lightgreen");gradient.addColorStop(1,"lightblue")}if(gradType==3){gradient=ctxO.createLinearGradient(0,0,canvasO.width,0);gradient.addColorStop(0,"green");gradient.addColorStop(.5,"skyblue");gradient.addColorStop(1,"red")}if(gradType==4){gradient=ctxO.createLinearGradient(0,0,canvasO.width,0);gradient.addColorStop(0,"pink");gradient.addColorStop(.5,"green");gradient.addColorStop(1,"Yellow")}else{gradient=ctxO.createLinearGradient(0,0,0,canvasO.height);gradient.addColorStop(0,"yellow");gradient.addColorStop(.5,"pink");gradient.addColorStop(1,"green")}let paddingO=parseInt(jQuery("#paddingSize-val").val());let borderO=parseInt(jQuery("#borderSize-val").val());this.drawBackGroundBorder(this.selectedPaddingColor,gradient,paddingO,borderO)};clearGradient=()=>{this.selectedPaddingGradientColor=null;this.applyOthersBlockDimensions()};applyOthersGradientPadding=gradType=>{this.needUploadScreanshotToServer=true;let canvasO=document.getElementById("captured-screen");let ctxO=canvasO.getContext("2d");let gradient;if(gradType==1){gradient=ctxO.createLinearGradient(0,0,canvasO.width,0);gradient.addColorStop(0,"#EDA2A5");gradient.addColorStop(.5,"#EA8789");gradient.addColorStop(1,"#E66A6A")}else if(gradType==2){gradient=ctxO.createLinearGradient(0,0,canvasO.width,0);gradient.addColorStop(0,"#E7BB44");gradient.addColorStop(.5,"#EB9C54");gradient.addColorStop(1,"#EF7864")}else if(gradType==3){gradient=ctxO.createLinearGradient(0,0,canvasO.width,0);gradient.addColorStop(0,"#309DCC");gradient.addColorStop(.5,"#41B4CD");gradient.addColorStop(1,"#5EDBCD")}else if(gradType==4){gradient=ctxO.createLinearGradient(0,canvasO.width/2,canvasO.width/2,canvasO.width);gradient.addColorStop(0,"#A061E1");gradient.addColorStop(.3,"#AB66C3");gradient.addColorStop(1,"#BC537F")}else if(gradType==5){gradient=ctxO.createLinearGradient(0,0,0,canvasO.height);gradient.addColorStop(0,"#C4BCF0");gradient.addColorStop(.3,"#D1A9E5");gradient.addColorStop(.6,"#F5BBBD");gradient.addColorStop(1,"#F3E1EA")}else if(gradType==6){gradient=ctxO.createLinearGradient(0,0,0,canvasO.height);gradient.addColorStop(0,"#FEBF81");gradient.addColorStop(.5,"#FF977A");gradient.addColorStop(1,"#FF7073")}else if(gradType==7){gradient=ctxO.createLinearGradient(0,0,0,canvasO.height);gradient.addColorStop(0,"#52DCD9");gradient.addColorStop(.5,"#89E7E5");gradient.addColorStop(1,"#C2F1F0")}else if(gradType==8){gradient=ctxO.createLinearGradient(0,0,0,canvasO.height);gradient.addColorStop(0,"#F09DED");gradient.addColorStop(.5,"#F5B7F2");gradient.addColorStop(1,"#F9D9F8")}else if(gradType==9){gradient=ctxO.createLinearGradient(0,canvasO.width/2,canvasO.width/2,canvasO.width);gradient.addColorStop(0,"#FFFAF1");gradient.addColorStop(.3,"#FDE0B7");gradient.addColorStop(1,"#FDB488")}else if(gradType==10){gradient=ctxO.createLinearGradient(0,canvasO.width/2,canvasO.width,0);gradient.addColorStop(0,"#AFF1FD");gradient.addColorStop(.5,"#3BDCFA");gradient.addColorStop(1,"#AFF1FD")}else if(gradType==11){gradient=ctxO.createLinearGradient(0,canvasO.width/2,canvasO.width,0);gradient.addColorStop(0,"#97A9FE");gradient.addColorStop(.4,"#A841EC");gradient.addColorStop(.7,"#DC58AF");gradient.addColorStop(1,"#F3A99D")}else{gradient=ctxO.createLinearGradient(0,canvasO.width/2,canvasO.width,0);gradient.addColorStop(0,"#F6DDDE");gradient.addColorStop(.5,"#EDF1D8");gradient.addColorStop(1,"#ADE9E8")}this.selectedPaddingGradientColor=gradient;this.selectedPaddingColor=gradient;let paddingO=parseInt(jQuery("#paddingSize-val").val());let borderO=parseInt(jQuery("#borderSize-val").val());this.drawBackGroundBorder(gradient,this.selectedBorderColor,paddingO,borderO)};applyOthersBlockDimensions=()=>{let paddingC;if(this.selectedPaddingGradientColor){paddingC=this.selectedPaddingGradientColor}else{paddingC=jQuery("#paddingColor-input").val()}let borderC=jQuery("#borderColor-input").val();let paddingO=parseInt(jQuery("#paddingSize-val").val());let borderO=parseInt(jQuery("#borderSize-val").val());this.drawBackGroundBorder(paddingC,borderC,paddingO,borderO)};drawBackGroundBorder=(paddingC,borderC,paddingO,borderO)=>{let _this=this;let shadowEnabled=jQuery("#screenshot-shadow").is(":checked");let borderRadius=jQuery("#borderRadius-input").val();if(paddingO>=0){this.selectedPaddingColor=paddingC;this.selectedPaddingOutline=paddingO}if(borderO>=0){this.selectedBorderColor=borderC;this.selectedBorderOutline=borderO}let CanvasP=document.getElementById("download-screen-canvas");let downloadCanvasImg=CanvasP.toDataURL("image/jpeg",1);let img=new Image;img.src=downloadCanvasImg;img.onload=async function(){let canvasWidth;let canvasHeight;if(_this.quixRotateClicked%2!=0){canvasWidth=parseInt(_this.downloadScreenHeight);canvasHeight=parseInt(_this.downloadScreenWidth)}else{canvasWidth=parseInt(_this.downloadScreenWidth);canvasHeight=parseInt(_this.downloadScreenHeight)}img.width=canvasWidth;img.height=canvasHeight;_this.downloadScreenImg=img;_this.downloadScreenImg.width=img.width;_this.downloadScreenImg.height=img.height;_this.executeRestOfCode(CanvasP,shadowEnabled,borderRadius,paddingO,borderO)}};executeRestOfCode=(CanvasP,shadowEnabled,borderRadius,paddingO,borderO)=>{let _this=this;let image;this.ctxP=CanvasP.getContext("2d");let additionalSpace=0;if(this.selectedPaddingOutline>0||this.selectedBorderOutline>0){additionalSpace=this.selectedPaddingOutline+this.selectedBorderOutline;this.ctxP.beginPath();this.ctxP.fillStyle="transparent";this.ctxP.filter="none";this.ctxP.clearRect(0,0,CanvasP.width,CanvasP.height)}if(shadowEnabled){let insetShadowBlur=20;_this.ctxP.shadowColor="rgba(0, 0, 0, 0.5)";_this.ctxP.shadowOffsetX=5;_this.ctxP.shadowOffsetY=5;_this.ctxP.shadowBlur=insetShadowBlur}else{_this.ctxP.shadowColor="rgba(0, 0, 0, 0)";_this.ctxP.shadowOffsetX=0;_this.ctxP.shadowOffsetY=0;_this.ctxP.shadowBlur=0}if(this.selectedPaddingColor){this.ctxP.fillStyle=this.selectedPaddingColor;this.ctxP.fillRect(0,0,CanvasP.style.width,CanvasP.style.height)}else if(this.selectedBorderColor){this.ctxP.fillStyle=this.selectedBorderColor;this.ctxP.fillRect(0,0,CanvasP.style.width,CanvasP.style.height)}if(this.selectedPaddingOutline>=0){let paddingL=this.selectedPaddingOutline*2;if(this.selectedPaddingOutline==0){this.ctxP.fillStyle="#DEDEDE"}else{this.ctxP.fillStyle=this.selectedPaddingColor}this.ctxP.lineWidth=paddingL;this.ctxP.fillRect(0,0,CanvasP.width,CanvasP.height);this.ctxP.fill()}if(this.selectedBorderOutline>0){let borderL=this.selectedBorderOutline*2;this.ctxP.strokeStyle=this.selectedBorderColor;this.ctxP.lineWidth=borderL;this.ctxP.strokeRect(0,0,CanvasP.width,CanvasP.height);this.ctxP.stroke()}if(this.flipRotate){image=this.downloadScreenImgflip}else{image=this.downloadScreenImg1}if(borderRadius>0&&paddingO>0){var cornerRadius=parseInt(borderRadius);var x=additionalSpace;var y=additionalSpace;var canW=parseInt(CanvasP.width);var canH=parseInt(CanvasP.height);var width=canW-additionalSpace*2;var height=canH-additionalSpace*2;var patternWidth=canW+additionalSpace*2;var patternHeight=canH+additionalSpace*2;var tempCanvas=document.createElement("canvas");tempCanvas.width=patternWidth;tempCanvas.height=patternHeight;var tempCtx=tempCanvas.getContext("2d");tempCtx.fillStyle="white";tempCtx.fillRect(0,0,patternWidth,patternHeight);var imageX=additionalSpace;var imageY=additionalSpace;tempCtx.drawImage(image,imageX,imageY,canW-additionalSpace*2,canH-additionalSpace*2);var pattern=this.ctxP.createPattern(tempCanvas,"repeat");this.ctxP.fillStyle=pattern;this.ctxP.beginPath();this.ctxP.moveTo(x+cornerRadius,y);this.ctxP.lineTo(x+width-cornerRadius,y);this.ctxP.quadraticCurveTo(x+width,y,x+width,y+cornerRadius);this.ctxP.lineTo(x+width,y+height-cornerRadius);this.ctxP.quadraticCurveTo(x+width,y+height,x+width-cornerRadius,y+height);this.ctxP.lineTo(x+cornerRadius,y+height);this.ctxP.quadraticCurveTo(x,y+height,x,y+height-cornerRadius);this.ctxP.lineTo(x,y+cornerRadius);this.ctxP.quadraticCurveTo(x,y,x+cornerRadius,y);this.ctxP.closePath();this.ctxP.fill()}else{this.ctxP.drawImage(image,additionalSpace,additionalSpace,CanvasP.width-additionalSpace*2,CanvasP.height-additionalSpace*2)}this.saveOthersSettingsAutoDownload()};roundedRect=(ctx,x,y,width,height,radius)=>{radius=parseInt(radius);ctx.beginPath();ctx.moveTo(x+radius,y);ctx.arcTo(x+width,y,x+width,y+radius,radius);ctx.arcTo(x+width,y+height,x+width-radius,y+height,radius);ctx.arcTo(x,y+height,x,y+height-radius,radius);ctx.arcTo(x,y,x+radius,y,radius);ctx.closePath()};applyLibraryBlockDimensions=()=>{let color=jQuery("#library-fill").val();jQuery(".outer-svg-fo.active.shape").find("svg").attr({fill:color})};removeIconActiveState=parent=>{let allItems=jQuery(parent);for(let i=0;i<allItems.length;i++){let path1=jQuery(allItems[i]).find(".sideBar-li-inner img").attr("data-src-inactive");let path2=jQuery(allItems[i]).find(".sideBar-li-inner img").attr("data-bg-inactive");jQuery(allItems[i]).removeClass("active")}};saveOthersSettingsAutoDownload=type=>{let capturedScreen=document.getElementById("download-screen-canvas");let imageURI;imageURI=capturedScreen.toDataURL("image/jpeg",1);let img=new Image;img.onload=()=>{this.ctxD.drawImage(img,0,0);this.downloadScreenImg=img;if(type=="flip"||type=="crop"){this.downloadScreenImg1=img}if(type=="crop"){this.downloadScreenImgflip=img}};img.src=imageURI};saveOthersSettingsAuto=type=>{let capturedScreen=document.getElementById("captured-screen");let imageURI;imageURI=capturedScreen.toDataURL("image/jpeg",1);this.screensHistory(imageURI);this.imageObjO.onload=()=>{this.ctxO.drawImage(this.imageObjO,0,0)};this.imageObjO.src=imageURI};saveOthersSettings=type=>{this.actionSave="";let capturedScreen=document.getElementById("captured-screen");let imageURI=capturedScreen.toDataURL("image/jpeg",1);this.screensHistory(imageURI);this.imageObjO.onload=()=>{this.ctxO.drawImage(this.imageObjO,0,0)};this.imageObjO.src=imageURI;if(jQuery("#download-overlay-inner").hasClass("full-screen-view")){chrome.runtime.sendMessage({type:"quixyFinalScreenshot",screen:imageURI})}this.othersResetListeners();jQuery("#annotations-popup-outer").hide()};getCSSRotatePropertyVal=element=>{const computedStyle=window.getComputedStyle(element);const transformValue=computedStyle.getPropertyValue("transform");const matrixValues=transformValue.match(/matrix\(([^\)]+)\)/)[1].split(",");let rotateValue=null;if(matrixValues.length===6){const a=parseFloat(matrixValues[0]);const b=parseFloat(matrixValues[1]);rotateValue=Math.atan2(b,a)}return rotateValue};isPreviousAnnDone=callback=>{if(this.actionSave!==""){switch(this.actionSave){case"text":this.addCoordinatestoLoop("text");setTimeout(()=>{callback()},500);break;case"crop":if(this.fillCanvas){this.fillCanvas.removeEventListener("mousedown",this.fillMouseDown);let originalCanvas=document.getElementById("captured-screen");let context=originalCanvas.getContext("2d");context.drawImage(this.imageObjOoriginal,this.fillArea.startX,this.fillArea.startY,this.fillArea.width,this.fillArea.height,0,0,originalCanvas.width,originalCanvas.height)}if(this.cropPoints==1){this.cropDrawnImage("auto")}{}setTimeout(()=>{callback()},500);break;case"blur":this.blurDrawnImage("auto");setTimeout(()=>{callback()},500);break;case"highlight":break;case"shapes":this.ShapeDrawnImage("auto");setTimeout(()=>{callback()},500);break;case"upload":this.addCoordinatestoLoop("image");setTimeout(()=>{callback()},500);break;case"library":this.addCoordinatestoLoop("library");setTimeout(()=>{callback()},500);break;case"others":this.saveOthersSettings("auto");setTimeout(()=>{callback()},500);break;case"padding":this.saveOthersSettings("auto");setTimeout(()=>{callback()},500);break;default:}}else{callback()}};othersResetListeners=()=>{jQuery(".library .save-annotation button").unbind("click")};checkWaterMarkSetting=()=>{chrome.storage.local.get("needToAppyWatermarkSettings",need=>{if(need.needToAppyWatermarkSettings.status){if(need.needToAppyWatermarkSettings.action=="custom"){chrome.storage.local.get("watermarkSettings",result=>{if(result.watermarkSettings){helpers.watermarkSettings.length=0;helpers.watermarkSettings.push(result.watermarkSettings);helpers.watermark=true;editScreenshot.applyWatermark("custom")}})}else{chrome.storage.local.get("accountWaterMarkSettings",result=>{if(result.accountWaterMarkSettings){helpers.watermark=true;editScreenshot.applyWatermark("account")}})}}})};loadScreenshotOnCanvas=(screenshot,type,reqType)=>{let canvas=document.getElementById("captured-screen");if(canvas!==undefined&&canvas!==null){let image=new Image;image.onload=()=>{let wid=image.width*zoomValuePercentRatio;let hei=image.height*zoomValuePercentRatio;canvas.height=image.height;canvas.width=image.width;let context=canvas.getContext("2d");context.drawImage(image,0,0);if(reqType!=="back"){this.firstScreenShot=image.src;this.firstScreenShotAddedWaterMark=image.src}jQuery(".screenshot-title input").val(screenshotName);if(jQuery("#download-overlay-inner").hasClass("full-screen-view")){let capturedScreen=canvas.toDataURL("image/jpeg",1);if(reqType!=="back"){chrome.runtime.sendMessage({type:"quixyFinalScreenshot",screen:capturedScreen})}}if(type===undefined){this.autoadjustScreenshot(image.width,image.height)}};image.src=screenshot}};performUndoRedo=type=>{let _this=this;if(type=="undo"){if(this.screensHistoryData.length>0&&this.screensHistoryStep+1<this.screensHistoryData.length){this.screensHistoryStep=this.screensHistoryStep+1;if(this.screensHistoryStep<0){this.screensHistoryStep=0}let index=this.screensHistoryData.length-this.screensHistoryStep-1;let imageURI=this.screensHistoryData[index];this.loadScreenshotOnCanvas(imageURI,"anno");updateScreenshot=imageURI;jQuery(".icon-redo img").removeClass("disabled")}}else{if(this.screensHistoryData.length>0&&this.screensHistoryStep-1>=0){this.screensHistoryStep=this.screensHistoryStep-1;if(this.screensHistoryStep>=this.screensHistoryData.length){this.screensHistoryStep=this.screensHistoryData.length-1}let index=this.screensHistoryData.length-this.screensHistoryStep-1;let imageURI=this.screensHistoryData[index];this.loadScreenshotOnCanvas(imageURI,"anno");updateScreenshot=imageURI}if(this.screensHistoryData.length>0&&this.screensHistoryStep<=0){jQuery(".icon-redo img").addClass("disabled")}}if(this.screensHistoryStep==this.screensHistoryData.length-1){jQuery(".icon-undo img").addClass("disabled")}else if(this.screensHistoryData.length>1){jQuery(".icon-undo img").removeClass("disabled")}};quixyZoomIn=async zoom=>{let _this=this;if(zoomValueX==0){zoomValueX=parseInt(jQuery("#captured-screen").width()*10/100)}if(zoomValueY==0){zoomValueY=parseInt(jQuery("#captured-screen").height()*10/100)}if(zoomValuePercent<200){let nW;let nH;if(zoom===undefined){zoomValuePercent=zoomValuePercent+10;nW=jQuery("#captured-screen").width()+zoomValueX;nH=jQuery("#captured-screen").height()+zoomValueY}else{zoomValuePercent=100;nW=parseInt(jQuery("#captured-screen").attr("width"));nH=parseInt(jQuery("#captured-screen").attr("height"))}zoomValuePercentRatio=zoomValuePercent/100;jQuery(".zoom-quix-status").text(zoomValuePercent+"%");jQuery("#captured-screen").css({width:nW+"px",height:nH+"px"});jQuery("#captured-screen-blur").css({width:nW+"px",height:nH+"px"});let mainSvg=document.querySelector(".mainSVG");if(mainSvg){let initialSvgWidth=parseInt(mainSvg.getAttribute("width"));let initialSvgHeight=parseInt(mainSvg.getAttribute("height"));mainSvg.setAttribute("width",nW);mainSvg.setAttribute("height",nH);mainSvg.style.width=nW+"px";mainSvg.style.height=nH+"px";let svgForElements=mainSvg.querySelectorAll(".outer-svg-fo");if(svgForElements.length>0){const svgForElementsArray=Array.from(svgForElements);for(let i=0;i<svgForElementsArray.length;i++){const outer_svg_fo=svgForElementsArray[i];outer_svg_fo.setAttribute("width",nW);outer_svg_fo.setAttribute("height",nH)}}let foreignObjects=mainSvg.querySelectorAll("foreignObject");async function processForeignObjects(){for(let i=0;i<foreignObjects.length;i++){const foreignObject=foreignObjects[i];const foreignObjectWidth=foreignObject.getAttribute("width");const foreignObjectHeight=foreignObject.getAttribute("height");if(foreignObjectWidth&&foreignObjectHeight){const scaledWidth=parseInt(foreignObjectWidth)*(nW/initialSvgWidth);const scaledHeight=parseInt(foreignObjectHeight)*(nH/initialSvgHeight);foreignObject.setAttribute("width",scaledWidth);foreignObject.setAttribute("height",scaledHeight);foreignObject.style.width=Math.floor(scaledWidth)+"px";foreignObject.style.height=Math.floor(scaledHeight)+"px";const translate=await _this.getTransformValues2(foreignObject.style.transform);const currentTranslateX=translate.x||0;const currentTranslateY=translate.y||0;const newTranslateX=currentTranslateX*(nW/initialSvgWidth);const newTranslateY=currentTranslateY*(nH/initialSvgHeight);foreignObject.style.transform=`translate(${newTranslateX}px, ${newTranslateY}px) rotate(${translate.rotate}rad)`;const spanElement=foreignObject.querySelector("span");const libShape=foreignObject.querySelector("#sameSVG");const rect=foreignObject.querySelector("#reactangle");const oval=foreignObject.querySelector("#oval");if(spanElement){const fontSizePercentage=Math.floor(70/100*scaledWidth);spanElement.style.fontSize=fontSizePercentage+"px"}if(libShape){libShape.setAttribute("width",scaledWidth);libShape.setAttribute("height",scaledHeight)}}}}processForeignObjects().then(()=>{})["catch"](error=>{});let lines=mainSvg.querySelectorAll(".line");let arrows=mainSvg.querySelectorAll(".arrow");let lineArrows=mainSvg.querySelectorAll(".lineArrow");let lineArrowsArray=Array.from(arrows);let freehandDraws=mainSvg.querySelectorAll("path.freeHand");freehandDraws.forEach(function(path){let pathData=path.getAttribute("d");pathData=pathData.replace(/([A-Za-z])\s+/g,"$1");let newPathData=[];let commands=pathData.match(/[a-zA-Z][^a-zA-Z]*/g);commands.forEach(function(command){let coords=command.trim().split(/[ ,]/).map(item=>{if(item.charAt(0)=="M"||item.charAt(0)=="L"){let valueWithoutML=item.substring(1);return valueWithoutML}return item});let newCoords=[];for(let i=0;i<coords.length;i+=2){let x=coords[i];let y=coords[i+1];let newX=x/initialSvgWidth*mainSvg.clientWidth;let newY=y/initialSvgHeight*mainSvg.clientHeight;newCoords.push(newX,newY)}newPathData.push(command.charAt(0),newCoords.join(" "))});path.setAttribute("d",newPathData.join(" "))});if(lines){lines.forEach(function(line){let x1=parseFloat(line.getAttribute("x1"));let y1=parseFloat(line.getAttribute("y1"));let x2=parseFloat(line.getAttribute("x2"));let y2=parseFloat(line.getAttribute("y2"));let newX1=x1/initialSvgWidth*mainSvg.clientWidth;let newY1=y1/initialSvgHeight*mainSvg.clientHeight;let newX2=x2/initialSvgWidth*mainSvg.clientWidth;let newY2=y2/initialSvgHeight*mainSvg.clientHeight;line.setAttribute("x1",newX1);line.setAttribute("y1",newY1);line.setAttribute("x2",newX2);line.setAttribute("y2",newY2)})}if(arrows&&lineArrows){lineArrows.forEach(function(line,index){let x1=parseFloat(line.getAttribute("x1"));let y1=parseFloat(line.getAttribute("y1"));let x2=parseFloat(line.getAttribute("x2"));let y2=parseFloat(line.getAttribute("y2"));let newX1=x1/initialSvgWidth*mainSvg.clientWidth;let newY1=y1/initialSvgHeight*mainSvg.clientHeight;let newX2=x2/initialSvgWidth*mainSvg.clientWidth;let newY2=y2/initialSvgHeight*mainSvg.clientHeight;line.setAttribute("x1",newX1);line.setAttribute("y1",newY1);line.setAttribute("x2",newX2);line.setAttribute("y2",newY2);const angle=Math.atan2(newY1-newY2,newX1-newX2);let arrowheadX=newX2-10*Math.cos(angle);let arrowheadY=newY2-10*Math.sin(angle);lineArrowsArray[index].setAttribute("points",`${arrowheadX},${arrowheadY} ${arrowheadX+10*Math.cos(angle-Math.PI/6)},${arrowheadY+10*Math.sin(angle-Math.PI/6)} ${arrowheadX},${arrowheadY} ${arrowheadX+10*Math.cos(angle+Math.PI/6)},${arrowheadY+10*Math.sin(angle+Math.PI/6)}`)})}}if(jQuery(".editor-outer-image-overlay").length>0){jQuery(".editor-outer-image-overlay").css({transform:"scale("+zoomValuePercentRatio+")","transform-origin":"top left"})}if(jQuery(".editor-outer-overlay").length>0){jQuery(".editor-outer-overlay").css({transform:"scale("+zoomValuePercentRatio+")","transform-origin":"top left"})}}};quixyZoomOut=xx=>{let _this=this;if(zoomValueX==0){zoomValueX=jQuery("#captured-screen").width()*10/100}if(zoomValueY==0){zoomValueY=jQuery("#captured-screen").height()*10/100}if(xx===undefined){xx=10}if(zoomValuePercent>=20){let capturedScreen=document.getElementById("captured-screen");let nW;let nH;let zVX;let zVY;if(xx==0){zVX=parseInt(jQuery("#captured-screen").width()/100);zVY=parseInt(jQuery("#captured-screen").height()/100);zoomValuePercent=100;zoomValuePercentRatio=1;jQuery(".zoom-quix-status").text(zoomValuePercent+"%");nW=jQuery("#captured-screen").width()-zVX;nH=jQuery("#captured-screen").height()-zVY}else if(xx==10){zoomValuePercent=zoomValuePercent-10;zoomValuePercentRatio=zoomValuePercent/100;jQuery(".zoom-quix-status").text(zoomValuePercent+"%");nW=jQuery("#captured-screen").width()-zoomValueX;nH=jQuery("#captured-screen").height()-zoomValueY}else{zVX=jQuery("#captured-screen").width()*xx/100;zVY=jQuery("#captured-screen").height()*xx/100;zoomValuePercent=zoomValuePercent-xx;zoomValuePercentRatio=zoomValuePercent/100;jQuery(".zoom-quix-status").text(zoomValuePercent+"%");nW=jQuery("#captured-screen").width()-zVX;nH=jQuery("#captured-screen").height()-zVY}jQuery("#captured-screen").css({width:nW+"px",height:nH+"px"});jQuery("#captured-screen-blur").css({width:nW+"px",height:nH+"px"});let mainSvg=document.querySelector(".mainSVG");if(mainSvg){let initialSvgWidth=parseInt(mainSvg.getAttribute("width"));let initialSvgHeight=parseInt(mainSvg.getAttribute("height"));if(nW>0&&nH>0){mainSvg.setAttribute("width",nW);mainSvg.setAttribute("height",nH);mainSvg.style.width=nW+"px";mainSvg.style.height=nH+"px"}else{return}let svgForElements=mainSvg.querySelectorAll(".outer-svg-fo");if(svgForElements.length>0){const svgForElementsArray=Array.from(svgForElements);for(let i=0;i<svgForElementsArray.length;i++){const outer_svg_fo=svgForElementsArray[i];outer_svg_fo.setAttribute("width",nW);outer_svg_fo.setAttribute("height",nH)}}let foreignObjects=mainSvg.querySelectorAll("foreignObject");async function processForeignObjects(){for(let i=0;i<foreignObjects.length;i++){const foreignObject=foreignObjects[i];const foreignObjectWidth=foreignObject.getAttribute("width");const foreignObjectHeight=foreignObject.getAttribute("height");if(foreignObjectWidth&&foreignObjectHeight){const scaledWidth=parseInt(foreignObjectWidth)*(nW/initialSvgWidth);const scaledHeight=parseInt(foreignObjectHeight)*(nH/initialSvgHeight);foreignObject.setAttribute("width",scaledWidth);foreignObject.setAttribute("height",scaledHeight);foreignObject.style.width=Math.floor(scaledWidth)+"px";foreignObject.style.height=Math.floor(scaledHeight)+"px";const translate=await _this.getTransformValues2(foreignObject.style.transform);const currentTranslateX=translate.x||0;const currentTranslateY=translate.y||0;const newTranslateX=currentTranslateX*(nW/initialSvgWidth);const newTranslateY=currentTranslateY*(nH/initialSvgHeight);foreignObject.style.transform=`translate(${newTranslateX}px, ${newTranslateY}px) rotate(${translate.rotate}rad)`;const spanElement=foreignObject.querySelector("span");const libShape=foreignObject.querySelector("#sameSVG");if(spanElement){const fontSizePercentage=Math.floor(70/100*scaledWidth);spanElement.style.fontSize=fontSizePercentage+"px"}if(libShape){libShape.setAttribute("width",scaledWidth);libShape.setAttribute("height",scaledHeight)}}}}processForeignObjects().then(()=>{})["catch"](error=>{console.error("Error:",error)});let lines=mainSvg.querySelectorAll(".line");let arrows=mainSvg.querySelectorAll(".arrow");let lineArrows=mainSvg.querySelectorAll(".lineArrow");let lineArrowsArray=Array.from(arrows);let freehandDraws=mainSvg.querySelectorAll("path.freeHand");freehandDraws.forEach(function(path){let pathData=path.getAttribute("d");pathData=pathData.replace(/([A-Za-z])\s+/g,"$1");let newPathData=[];let commands=pathData.match(/[a-zA-Z][^a-zA-Z]*/g);commands.forEach(function(command){let coords=command.trim().split(/[ ,]/).map(item=>{if(item.charAt(0)=="M"||item.charAt(0)=="L"){let valueWithoutML=item.substring(1);return valueWithoutML}return item});let newCoords=[];for(let i=0;i<coords.length;i+=2){let x=coords[i];let y=coords[i+1];let newX=x/initialSvgWidth*mainSvg.clientWidth;let newY=y/initialSvgHeight*mainSvg.clientHeight;newCoords.push(newX,newY)}newPathData.push(command.charAt(0),newCoords.join(" "))});path.setAttribute("d",newPathData.join(" "))});if(lines){lines.forEach(function(line){let x1=parseFloat(line.getAttribute("x1"));let y1=parseFloat(line.getAttribute("y1"));let x2=parseFloat(line.getAttribute("x2"));let y2=parseFloat(line.getAttribute("y2"));let newX1=x1/initialSvgWidth*mainSvg.clientWidth;let newY1=y1/initialSvgHeight*mainSvg.clientHeight;let newX2=x2/initialSvgWidth*mainSvg.clientWidth;let newY2=y2/initialSvgHeight*mainSvg.clientHeight;line.setAttribute("x1",newX1);line.setAttribute("y1",newY1);line.setAttribute("x2",newX2);line.setAttribute("y2",newY2)})}if(arrows&&lineArrows){lineArrows.forEach(function(line,index){let x1=parseFloat(line.getAttribute("x1"));let y1=parseFloat(line.getAttribute("y1"));let x2=parseFloat(line.getAttribute("x2"));let y2=parseFloat(line.getAttribute("y2"));let newX1=x1/initialSvgWidth*mainSvg.clientWidth;let newY1=y1/initialSvgHeight*mainSvg.clientHeight;let newX2=x2/initialSvgWidth*mainSvg.clientWidth;let newY2=y2/initialSvgHeight*mainSvg.clientHeight;line.setAttribute("x1",newX1);line.setAttribute("y1",newY1);line.setAttribute("x2",newX2);line.setAttribute("y2",newY2);const angle=Math.atan2(newY1-newY2,newX1-newX2);let arrowheadX=newX2-10*Math.cos(angle);let arrowheadY=newY2-10*Math.sin(angle);lineArrowsArray[index].setAttribute("points",`${arrowheadX},${arrowheadY} ${arrowheadX+10*Math.cos(angle-Math.PI/6)},${arrowheadY+10*Math.sin(angle-Math.PI/6)} ${arrowheadX},${arrowheadY} ${arrowheadX+10*Math.cos(angle+Math.PI/6)},${arrowheadY+10*Math.sin(angle+Math.PI/6)}`)})}}if(jQuery(".editor-outer-image-overlay").length>0){jQuery(".editor-outer-image-overlay").css({transform:"scale("+zoomValuePercentRatio+")","transform-origin":"top left"})}if(jQuery(".editor-outer-overlay").length>0){jQuery(".editor-outer-overlay").css({transform:"scale("+zoomValuePercentRatio+")","transform-origin":"top left"})}}};screensHistory=(screen,load)=>{if(load===undefined){isScreenshotUpdated=true;let data7={[`${extPrefix}isScreenshotUploadedToServer`]:false};chrome.storage.local.set(data7,()=>{})}this.screensHistoryStep=0;if(this.screensHistoryData.length<=10){this.screensHistoryData.push(screen)}else{this.screensHistoryData.shift();this.screensHistoryData.push(screen)}if(load!==undefined){if(this.screensHistoryData.length>1){jQuery(".icon-undo img").removeClass("disabled")}else{jQuery(".icon-undo img").addClass("disabled");jQuery(".icon-redo img").addClass("disabled")}}updateScreenshot=screen};showRightSidebar=type=>{jQuery("#annotations-popup-outer").attr("class","");jQuery("#annotations-popup-outer").addClass(type);jQuery("#annotations-popup-outer").show();if(type=="text"){jQuery("#annotations-popup-outer .annotation-outline").addClass("text")}};resetOriginalImage=()=>{cooridnatesDrawnAt=[];this.svgCordinates.length=0;this.svgItems.length=0;this.undoStack.length=0;this.redoStack.length=0;this.waterMarkAnnotations={};jQuery(".icon-undo img").addClass("disabled");jQuery(".icon-redo img").addClass("disabled");const mainSvg=document.querySelector(".mainSVG");if(mainSvg){this.svgMouseEventRemove(mainSvg);mainSvg.innerHTML=""}const anotationPopupLayer=document.querySelector("#annotations-popup-outer");if(anotationPopupLayer){anotationPopupLayer.style.display="none"}chrome.runtime.sendMessage({type:"updateCordinates",cooridnatesDrawnAt:cooridnatesDrawnAt});editScreenshot.loadScreenshotOnCanvas(originalImage);editScreenshot.screensHistory(originalImage);if(helpers.setIntervalRef){clearInterval(helpers.setIntervalRef)}};resetOriginalImageDownload=()=>{if(this.fillCanvas){this.fillCanvas.removeEventListener("mousedown",this.fillMouseDown)}if(this.needUploadScreanshotToServer==true){this.needUploadScreanshotToServer=false}this.removeCropDownloadAnnotation();this.removePaddingBorderAnnotationToolbar("reset");this.fillUsed=false;this.isFillDragable=false;this.fitUsed=false;this.isPrevFillCropDone=false;this.quixRotateClicked=0;this.downloadScreenWidth=null;this.downloadScreenHeight=null;this.fillCanvas="";this.flipRotate=false;let mainCanvas=document.getElementById("captured-screen");let canvas=document.getElementById("padding-screen");let source=canvas.toDataURL("image/jpeg",1);let downloadScreenCanvas=document.querySelector("#screenshot-area-left #download-screen-canvas");let context=downloadScreenCanvas.getContext("2d");this.ctxD=downloadScreenCanvas.getContext("2d");downloadScreenCanvas.width=canvas.width;downloadScreenCanvas.height=canvas.height;fitDownloadCanvasToSsreen();this.downloadScreenWidth=this.downloadScreenWidthZero;this.downloadScreenHeight=this.downloadScreenHeightZero;let image=new Image;image.onload=()=>{context.drawImage(image,0,0);this.downloadScreenImgZero=image;this.downloadScreenImg0=image;this.downloadScreenImg=image;this.downloadScreenImg1=image;this.downloadScreenImgflip=image};image.src=source;if(helpers.setIntervalRef){clearInterval(helpers.setIntervalRef)}};scrollWhileCropping=(event,type)=>{let canv=jQuery("#canvas_background").offset();let winScrolledX=$("html").scrollLeft();let winScrolledY=$("html").scrollTop();let x=event.clientX-(canv.left-winScrolledX+editScreenshot.rect.startX);let y=event.clientY-(canv.top-winScrolledY+editScreenshot.rect.startY);let prevScrolledX=$("#screenshot-wrapper-bottom").scrollLeft();let prevScrolledY=$("#screenshot-wrapper-bottom").scrollTop();let scrollX,scrollY;if(prevScrolledX-200>x){scrollX=x+200;scrollY=y+200}else{scrollX=x-200;scrollY=y-200}if(type=="screenshot"){if(scrollX>winScrolledX&&scrollY>winScrolledY){document.getElementsByTagName("body")[0].scrollTo({left:scrollX,top:scrollY,behavior:"smooth"})}}else{if(scrollX>prevScrolledX&&scrollY>prevScrolledY){document.getElementById("screenshot-wrapper-bottom").scrollTo({left:scrollX,top:scrollY,behavior:"smooth"})}}};copyClipboard=async()=>{let canvas=document.getElementById("padding-screen");let source=this.downloadScreenImg.src;let image=document.createElement("img");image.src=source;image.onload=()=>{let canvas=document.createElement("canvas");canvas.width=image.width;canvas.height=image.height;this.ctx=canvas.getContext("2d");this.ctx.drawImage(image,0,0,image.width,image.height);canvas.toBlob(blob=>{navigator.clipboard.write([new ClipboardItem({"image/png":blob})]);helpers.successMessagePopup("Copied Successfully","Your image has been copied to the clipboard successfully.")},"image/png")}};adjustTextAreaHeightAndWidth=elem=>{elem.on("input",e=>{this.adjustTextAreaAutomatically()});elem.on("paste",event=>{event.preventDefault();const text=(event.originalEvent||event).clipboardData.getData("text/plain");elem[0].textContent+=text;this.adjustTextAreaAutomatically()})};removeSvgItem=uniqueID=>{for(let i=0;i<this.svgCordinates.length;i++){let element=this.svgCordinates[i];if(element.element){element=element.element}const dd=element.getAttribute("id");if(dd&&dd==uniqueID){this.deletedItems.push({uniqueID:uniqueID});this.svgCordinates.splice(i,1)}}jQuery("#"+uniqueID+".outer-svg-fo").remove();jQuery("#annotations-popup-outer").css("display","none")};setSpectrumColor=(color,type)=>{if(type=="text"){jQuery(".text #fill-color-picker").spectrum("set",color)}else if(type=="shape"){jQuery("#library-color-picker").spectrum("set",color)}};adjustBlockAutomatically=(type,color)=>{if(type=="Block"){jQuery(".highlight-size").hide();jQuery(".outer-svg-fo.Block.active").find("#Block").attr("fill",color)}else if(type=="Brush"){}};adjustShapesAutomatically=(outlineValue,outlineColor)=>{const color=$(".shapes .color-picker-wrapper-shape").find("#outline-color-picker-shape").css("background-color");if(outlineValue)jQuery(".outer-svg-fo.reactangle.active").find("#reactangle").attr("stroke-width",outlineValue);if(outlineColor)jQuery(".outer-svg-fo.reactangle.active").find("#reactangle").attr("stroke",outlineColor);if(outlineValue)jQuery(".outer-svg-fo.oval.active").find("#oval").attr("stroke-width",outlineValue);if(outlineColor)jQuery(".outer-svg-fo.oval.active").find("#oval").attr("stroke",outlineColor)};svgMouseEventRemove=svg=>{svg.removeEventListener("mousemove",this.handleRectMove);svg.removeEventListener("mouseup",this.handleRectStop);svg.removeEventListener("mousedown",this.handleRectClick);svg.removeEventListener("mousedown",this.startDrawing1);svg.removeEventListener("mousemove",this.drawLine1);svg.removeEventListener("mousemove",this.drawLine1);svg.removeEventListener("mousedown",this.svgLineStart);svg.removeEventListener("mousemove",this.svgLineMove);svg.removeEventListener("mouseup",this.svgLineUp);svg.removeEventListener("mousedown",this.svgArrowLineStart);svg.removeEventListener("mousemove",this.svgArrowLineMove);svg.removeEventListener("mouseup",this.svgArrowLineUp)};svgFreeHandShapes=async(type,importedNode,svg,aspectRatioVal)=>{$(".outer-svg-fo.active").removeClass("active");let _this=this;document.querySelector(".shapes #outline-color-picker-shape").style.backgroundColor=this.shapeAnnoColor;document.querySelector(".shapes #font-outline-size-shape").value=this.shapeAnnoOutline;_this.setSpectrumColor(this.shapeAnnoOutline,"shape");const classes=["ui-rotatable-handle","ui-resizable-handle","resize-icon","rm-icon"];let ElemFoundOnMouseDown=false;function containsAnyClass(element,classes){return classes.some(cls=>element.classList.contains(cls))}if(type=="line"){let drawing=false;let currentLine;let x,y,x2,y2;let uniqueID;let lineNotDrawn=false;this.svgLineStart=event=>{_this.lastLine=false;_this.lastArrow=false;lineNotDrawn=true;let element=document.elementFromPoint(event.clientX,event.clientY);if(element&&(containsAnyClass(element,classes)||element.closest("#rotateDiv"))){ElemFoundOnMouseDown=true;return}else{drawing=true;const svgRect=svg.getBoundingClientRect();x=event.clientX-svgRect.left;y=event.clientY-svgRect.top;currentLine=document.createElementNS("http://www.w3.org/2000/svg","line");currentLine.classList.add("line","lineUndo");currentLine.setAttribute("x1",x);currentLine.setAttribute("y1",y);currentLine.setAttribute("x2",x);currentLine.setAttribute("y2",y);currentLine.setAttribute("stroke",this.shapeAnnoColor);svg.appendChild(currentLine);this.ensureBlurLast()}};this.svgLineMove=function(event){if(drawing){const svgRect=svg.getBoundingClientRect();x2=event.clientX-svgRect.left;y2=event.clientY-svgRect.top;const length=Math.sqrt(Math.pow(x2-currentLine.getAttribute("x1"),2)+Math.pow(y2-currentLine.getAttribute("y1"),2));const minLengthForArrow=5;if(length>=minLengthForArrow){currentLine.setAttribute("x2",x2);currentLine.setAttribute("y2",y2);currentLine.setAttribute("stroke-width",_this.shapeAnnoOutline);lineNotDrawn=false}}};this.svgLineUp=()=>{drawing=false;_this.lastLine=true;_this.lastArrow=false;if(!ElemFoundOnMouseDown&&!lineNotDrawn){_this.svgCordinates.push({element:svg,id:"line",action:"line",stroke:{stroke:_this.shapeAnnoColor,strokeWidth:_this.shapeAnnoOutline},x1:x,y1:y,x2:x2,y2:y2});const zoomStatus=document.querySelector("#screenshot-wrapper-top .zoom-quix-status").innerText;const mainWidth=parseInt(document.querySelector(".mainSVG").getAttribute("width"));const mainHeight=parseInt(document.querySelector(".mainSVG").getAttribute("height"));_this.undoStack.push({element:svg,id:"lineUndo",mainClass:{line:"line"},action:"line",type:type,stroke:{stroke:_this.shapeAnnoColor,strokeWidth:_this.shapeAnnoOutline},x1:x,y1:y,x2:x2,y2:y2,mainSvg:{mainWidth:mainWidth,mainHeight:mainHeight,zoomStatus:zoomStatus}});jQuery(".icon-undo img").removeClass("disabled")}else{svg.removeChild(currentLine)}};svg.addEventListener("mousedown",this.svgLineStart);svg.addEventListener("mousemove",this.svgLineMove);svg.addEventListener("mouseup",this.svgLineUp)}else if(type=="arrow"){let drawing=false;let currentLine;let arrowhead;let x,y,x2,y2,angle,arrowheadX,arrowheadY;let arrowNotDrawn=false;let uniqueID;this.svgArrowLineStart=event=>{_this.lastArrow=false;_this.lastLine=false;let element=document.elementFromPoint(event.clientX,event.clientY);if(element&&(containsAnyClass(element,classes)||element.closest("#rotateDiv"))){ElemFoundOnMouseDown=true;arrowNotDrawn=true;return}else{drawing=true;arrowNotDrawn=true;const svgRect=svg.getBoundingClientRect();x=event.clientX-svgRect.left;y=event.clientY-svgRect.top;currentLine=document.createElementNS("http://www.w3.org/2000/svg","line");currentLine.classList.add("lineArrow","lineArrowUndo");currentLine.setAttribute("x1",x);currentLine.setAttribute("y1",y);currentLine.setAttribute("x2",x);currentLine.setAttribute("y2",y);currentLine.setAttribute("stroke",this.shapeAnnoColor);currentLine.setAttribute("stroke-width",this.shapeAnnoOutline);arrowhead=document.createElementNS("http://www.w3.org/2000/svg","polyline");arrowhead.classList.add("arrow","arrowUndo");arrowhead.setAttribute("points",`${x},${y} ${x}, ${y} ${x},${y}`);arrowhead.setAttribute("stroke",this.shapeAnnoColor);arrowhead.setAttribute("stroke-width",this.shapeAnnoOutline);arrowhead.setAttribute("fill","none");svg.appendChild(currentLine);svg.appendChild(arrowhead);this.ensureBlurLast()}};this.svgArrowLineMove=function(event){if(drawing){const svgRect=svg.getBoundingClientRect();x2=event.clientX-svgRect.left;y2=event.clientY-svgRect.top;currentLine.setAttribute("x2",x2);currentLine.setAttribute("y2",y2);var length=Math.sqrt(Math.pow(x2-currentLine.getAttribute("x1"),2)+Math.pow(y2-currentLine.getAttribute("y1"),2));var minLengthForArrow=5;if(length>=minLengthForArrow){angle=Math.atan2(currentLine.getAttribute("y1")-y2,currentLine.getAttribute("x1")-x2);arrowheadX=parseFloat(currentLine.getAttribute("x2"))-10*Math.cos(angle);arrowheadY=parseFloat(currentLine.getAttribute("y2"))-10*Math.sin(angle);arrowhead.setAttribute("points",`${arrowheadX},${arrowheadY} ${arrowheadX+10*Math.cos(angle-Math.PI/6)},${arrowheadY+10*Math.sin(angle-Math.PI/6)} ${arrowheadX},${arrowheadY} ${arrowheadX+10*Math.cos(angle+Math.PI/6)},${arrowheadY+10*Math.sin(angle+Math.PI/6)}`);arrowNotDrawn=false}}};this.svgArrowLineUp=()=>{_this.lastArrow=true;drawing=false;if(!ElemFoundOnMouseDown&&!arrowNotDrawn){const zoomStatus=document.querySelector("#screenshot-wrapper-top .zoom-quix-status").innerText;const mainWidth=parseInt(document.querySelector(".mainSVG").getAttribute("width"));const mainHeight=parseInt(document.querySelector(".mainSVG").getAttribute("height"));_this.svgCordinates.push({element:svg,action:"line",id:{line:"lineArrow",arrow:"arrow"},arrow:arrowhead.animatedPoints,x:{x1:x,x2:x2},y:{y1:y,y2:y2}});_this.undoStack.push({element:svg,action:"line",type:type,id:{line:"lineArrowUndo",arrow:"arrowUndo"},mainClass:{line:"lineArrow",arrow:"arrow"},arrow:arrowhead.animatedPoints,stroke:{stroke:_this.shapeAnnoColor,strokeWidth:_this.shapeAnnoOutline},x:{x1:x,x2:x2},y:{y1:y,y2:y2},mainSvg:{mainWidth:mainWidth,mainHeight:mainHeight,zoomStatus:zoomStatus}});jQuery(".icon-undo img").removeClass("disabled")}else{svg.removeChild(currentLine);svg.removeChild(arrowhead)}};svg.addEventListener("mousedown",this.svgArrowLineStart);svg.addEventListener("mousemove",this.svgArrowLineMove);svg.addEventListener("mouseup",this.svgArrowLineUp)}};SvgperformUndoRedo=async type=>{if(type==="undo"&&this.undoStack.length>0){let lastAction=this.undoStack.pop();this.redoStack.push(lastAction);this.updateDrawing("undo");this.undoRedoSteps="undo"}else if(type==="redo"&&this.redoStack.length>0){let lastUndo=this.redoStack.slice(-1)[0];this.undoStack.push(lastUndo);this.updateDrawing("redo");this.undoRedoSteps="redo"}this.updateUndoRedoUI()};updateUndoRedoUI=()=>{if(this.undoStack.length>0){jQuery(".icon-undo img").removeClass("disabled")}else{jQuery(".icon-undo img").addClass("disabled")}if(this.redoStack.length>0){jQuery(".icon-redo img").removeClass("disabled")}else{jQuery(".icon-redo img").addClass("disabled")}};updateDrawing=type=>{const drawingArea=document.querySelector(".mainSVG");let logStack=type==="undo"?this.undoStack:this.redoStack;const currentZoom=this.parseZoom(document.querySelector("#screenshot-wrapper-top .zoom-quix-status").innerText);if(type==="undo"){drawingArea.innerHTML=""}if(type==="redo"&&logStack.length>0){logStack=[logStack[logStack.length-1]];if(logStack.length===1){this.redoStack.pop()}}const groupedActions=this.groupObjectsByProperty(logStack,"parent-id");Object.entries(groupedActions).forEach(async([key,actions])=>{if(actions.length>0){try{const action=actions[actions.length-1];const previousZoom=this.parseZoom(action.mainSvg.zoomStatus);const scaleFactor=previousZoom&&currentZoom?currentZoom/previousZoom:1;const deletedItem=this.deletedItems.find(item=>item.uniqueID===key);if(deletedItem){if(type==="undo"&&deletedItem.uniqueID!==this.undoStack[this.undoStack.length-1]?.["parent-id"]){return}if(type==="redo"&&deletedItem.uniqueID===key){this.deletedItems=this.deletedItems.filter(item=>item.uniqueID!==deletedItem.uniqueID)}}if(action.type!=="line"&&action.type!=="arrow"&&action.type!=="freeHand"){await this.processShapeOrSmiley(action,scaleFactor)}else if(["line","arrow","freeHand"].includes(action.type)){this.processLinesAndArrows(actions,scaleFactor,type,logStack)}}catch(error){console.error(error,"=error",actions[actions.length-1])}}})};parseZoom=zoomString=>parseFloat(zoomString.replace("%",""));parseTransform=transform=>{const translateMatch=transform.match(/translate\(([^,]+),\s*([^)]+)\)/);const rotateMatch=transform.match(/rotate\(([^)]+)\)/);if(!translateMatch||!rotateMatch){return{translateX:NaN,translateY:NaN,rotate:NaN}}const translateXValue=parseFloat(translateMatch[1].trim());const translateYValue=parseFloat(translateMatch[2].trim());const rotateValue=parseFloat(rotateMatch[1].trim());return{translateX:translateXValue,translateY:translateYValue,rotate:rotateValue}};processShapeOrSmiley=async(action,scaleFactor)=>{const drawingArea=document.querySelector(".mainSVG");const uniqueID=action["parent-id"];const element=action.element;const foreignObject=element.querySelector("foreignObject");const svg=foreignObject.querySelector("svg");const span=foreignObject.querySelector("span");if(action.width){const newWidth=`${parseInt(action.width)*scaleFactor}px`;foreignObject.setAttribute("width",newWidth);foreignObject.style.width=newWidth;if(svg)svg.style.width="100%";if(span)span.style.fontSize=`${Math.floor(70/100*parseInt(newWidth))}px`}if(action.height){const newHeight=`${parseInt(action.height)*scaleFactor}px`;foreignObject.setAttribute("height",newHeight);foreignObject.style.height=newHeight;if(svg)svg.style.height="100%";if(span)span.style.fontSize=`${Math.floor(70/100*parseInt(newHeight))}px`}if(action.transform){let transformVal=action.transform;const{translateX,translateY,rotate}=this.parseTransform(transformVal);const newTranslateX=translateX*scaleFactor;const newTranslateY=translateY*scaleFactor;foreignObject.style.transform=`translate(${newTranslateX}px, ${newTranslateY}px) rotate(${rotate}rad)`}drawingArea.appendChild(element);this.ensureBlurLast();this.svgElementEvents(action.type,drawingArea,uniqueID,action.aspectRatioVal,element,foreignObject)};processLinesAndArrows=(actions,scaleFactor,type,logStack)=>{const drawingArea=document.querySelector(".mainSVG");if(type=="undo"){actions.forEach((action,key)=>{const element=action.element;const lineClass=`${action.id}line${key}`;const arrowClass=`${action.id}arrow${key}`;if(action.type=="line"){let currentLine=document.createElementNS("http://www.w3.org/2000/svg","line");currentLine.classList.add(action.id+key,action.mainClass.line);action.element.appendChild(currentLine);if(currentLine){const x1=action.x1*scaleFactor;const y1=action.y1*scaleFactor;const x2=action.x2*scaleFactor;const y2=action.y2*scaleFactor;action.element.querySelector("."+action.id+key).setAttribute("x1",x1);action.element.querySelector("."+action.id+key).setAttribute("y1",y1);action.element.querySelector("."+action.id+key).setAttribute("x2",x2);action.element.querySelector("."+action.id+key).setAttribute("y2",y2);action.element.querySelector("."+action.id+key).setAttribute("stroke",action.stroke.stroke);action.element.querySelector("."+action.id+key).setAttribute("stroke-width",action.stroke.strokeWidth)}}else if(action.type==="arrow"){let arrowPoints=[];if(action.arrow){for(let i=0;i<action.arrow.length;i++){const point=action.arrow[i];arrowPoints.push(point)}}let currentLine=document.createElementNS("http://www.w3.org/2000/svg","line");let arrowhead=document.createElementNS("http://www.w3.org/2000/svg","polyline");currentLine.classList.add(action.id.line+key,action.mainClass.line);arrowhead.classList.add(action.id.arrow+key,action.mainClass.arrow);action.element.appendChild(currentLine);action.element.appendChild(arrowhead);if(currentLine&&arrowhead){const x1=action.x.x1*scaleFactor;const y1=action.y.y1*scaleFactor;const x2=action.x.x2*scaleFactor;const y2=action.y.y2*scaleFactor;action.element.querySelector("."+action.id.line+key).setAttribute("x1",x1);action.element.querySelector("."+action.id.line+key).setAttribute("y1",y1);action.element.querySelector("."+action.id.line+key).setAttribute("x2",x2);action.element.querySelector("."+action.id.line+key).setAttribute("y2",y2);action.element.querySelector("."+action.id.line+key).setAttribute("stroke",action.stroke.stroke);action.element.querySelector("."+action.id.line+key).setAttribute("stroke-width",action.stroke.strokeWidth);const angle=Math.atan2(y1-y2,x1-x2);let arrowheadX=x2-10*Math.cos(angle);let arrowheadY=y2-10*Math.sin(angle);action.element.querySelector("."+action.id.arrow+key).setAttribute("points",`${arrowheadX},${arrowheadY} ${arrowheadX+10*Math.cos(angle-Math.PI/6)},${arrowheadY+10*Math.sin(angle-Math.PI/6)} ${arrowheadX},${arrowheadY} ${arrowheadX+10*Math.cos(angle+Math.PI/6)},${arrowheadY+10*Math.sin(angle+Math.PI/6)}`);action.element.querySelector("."+action.id.arrow+key).setAttribute("stroke",action.stroke.stroke);action.element.querySelector("."+action.id.arrow+key).setAttribute("stroke-width",action.stroke.strokeWidth);action.element.querySelector("."+action.id.arrow+key).setAttribute("fill","none");arrowPoints.length=0}}else if(action.type=="freeHand"){const scalePoint=(x,y)=>({x:parseFloat(x)*scaleFactor,y:parseFloat(y)*scaleFactor});let newPath=document.createElementNS("http://www.w3.org/2000/svg","path");newPath.classList.add(action.id,action.mainClass.freeHand);let adjustedPathData=action.pathData.replace(/([ML])(\d+(?:\.\d+)?),(\d+(?:\.\d+)?)/g,(match,command,x,y)=>{const scaledPoint=scalePoint(x,y);return`${command}${scaledPoint.x},${scaledPoint.y}`});newPath.setAttribute("d",adjustedPathData);newPath.setAttribute("stroke",action.stroke.stroke);newPath.setAttribute("stroke-width",action.stroke.strokeWidth);newPath.setAttribute("fill","none");action.element.appendChild(newPath);return}})}else{let action=logStack[logStack.length-1];if(action.type=="line"){let currentLine=document.createElementNS("http://www.w3.org/2000/svg","line");currentLine.classList.add(action.id,action.mainClass.line);action.element.appendChild(currentLine);if(currentLine){const x1=action.x1*scaleFactor;const y1=action.y1*scaleFactor;const x2=action.x2*scaleFactor;const y2=action.y2*scaleFactor;action.element.querySelector("."+action.id+":last-of-type").setAttribute("x1",x1);action.element.querySelector("."+action.id+":last-of-type").setAttribute("y1",y1);action.element.querySelector("."+action.id+":last-of-type").setAttribute("x2",x2);action.element.querySelector("."+action.id+":last-of-type").setAttribute("y2",y2);action.element.querySelector("."+action.id+":last-of-type").setAttribute("stroke",action.stroke.stroke);action.element.querySelector("."+action.id+":last-of-type").setAttribute("stroke-width",action.stroke.strokeWidth)}}else if(action.type=="arrow"){let arrowPoints=[];for(let i=0;i<action.arrow.length;i++){const point=action.arrow[i];arrowPoints.push(point)}let currentLine=document.createElementNS("http://www.w3.org/2000/svg","line");let arrowhead=document.createElementNS("http://www.w3.org/2000/svg","polyline");currentLine.classList.add(action.id.line,action.mainClass.line);arrowhead.classList.add(action.id.arrow,action.mainClass.arrow);action.element.appendChild(currentLine);action.element.appendChild(arrowhead);if(currentLine&&arrowhead){const x1=action.x.x1*scaleFactor;const y1=action.y.y1*scaleFactor;const x2=action.x.x2*scaleFactor;const y2=action.y.y2*scaleFactor;action.element.querySelector("."+action.id.line+":last-of-type").setAttribute("x1",x1);action.element.querySelector("."+action.id.line+":last-of-type").setAttribute("y1",y1);action.element.querySelector("."+action.id.line+":last-of-type").setAttribute("x2",x2);action.element.querySelector("."+action.id.line+":last-of-type").setAttribute("y2",y2);action.element.querySelector("."+action.id.line+":last-of-type").setAttribute("stroke",action.stroke.stroke);action.element.querySelector("."+action.id.line+":last-of-type").setAttribute("stroke-width",action.stroke.strokeWidth);const angle=Math.atan2(y1-y2,x1-x2);let arrowheadX=x2-10*Math.cos(angle);let arrowheadY=y2-10*Math.sin(angle);action.element.querySelector("."+action.id.arrow+".arrowUndo:last-of-type").setAttribute("points",`${arrowheadX},${arrowheadY} ${arrowheadX+10*Math.cos(angle-Math.PI/6)},${arrowheadY+10*Math.sin(angle-Math.PI/6)} ${arrowheadX},${arrowheadY} ${arrowheadX+10*Math.cos(angle+Math.PI/6)},${arrowheadY+10*Math.sin(angle+Math.PI/6)}`);action.element.querySelector("."+action.id.arrow+":last-of-type").setAttribute("stroke",action.stroke.stroke);action.element.querySelector("."+action.id.arrow+":last-of-type").setAttribute("stroke-width",action.stroke.strokeWidth);action.element.querySelector("."+action.id.arrow+":last-of-type").setAttribute("fill","none");arrowPoints.length=0}}else if(action.type=="freeHand"){let newPath=document.createElementNS("http://www.w3.org/2000/svg","path");newPath.classList.add(action.id,action.mainClass.freeHand);const scalePoint=(x,y)=>({x:parseFloat(x)*scaleFactor,y:parseFloat(y)*scaleFactor});let adjustedPathData=action.pathData.replace(/([ML])(\d+(?:\.\d+)?),(\d+(?:\.\d+)?)/g,(match,command,x,y)=>{const scaledPoint=scalePoint(x,y);return`${command}${scaledPoint.x},${scaledPoint.y}`});newPath.setAttribute("d",adjustedPathData);newPath.setAttribute("stroke",action.stroke.stroke);newPath.setAttribute("stroke-width",action.stroke.strokeWidth);newPath.setAttribute("fill","none");newPath.id=action.id;action.element.appendChild(newPath)}}this.ensureBlurLast()};groupObjectsByProperty=(array,property)=>{return array.reduce(function(acc,obj){var key=obj[property];if(!acc[key]){acc[key]=[]}acc[key].push(obj);return acc},{})};addSVG=async(capturedScreen,mainSVG,svgNS)=>{let svg;if(!mainSVG){svg=document.createElementNS(svgNS,"svg");svg.setAttribute("width",capturedScreen.offsetWidth);svg.setAttribute("height",capturedScreen.offsetHeight);svg.classList.add("mainSVG");svg.style.position="absolute";svg.style.top=0;svg.style.left=0;document.querySelector("div#screenshot-wrapper-bottom-wrap #screenshot-wrapper-bottom-wrap-inner").appendChild(svg);return svg}else{svg=mainSVG;return svg}};applyShapesSmileys=(elem,type)=>{let obj=this;let libItem=jQuery(elem.currentTarget).find(".library-col").html();if(type=="shape"){libItem=jQuery(elem.currentTarget).find(".shape-col").html();if(jQuery(elem.currentTarget).hasClass("svg-shape")){obj.applySvgAndUpdate(type,libItem)}}else{obj.applySvgAndUpdate(type,libItem)}};applySvgAndUpdate=async(type,libItem)=>{this.isDrawing=false;let _this=this;const capturedScreen=document.getElementById("captured-screen");const mainSVG=document.querySelector(".mainSVG");const svgNS="http://www.w3.org/2000/svg";const svg=await this.addSVG(capturedScreen,mainSVG,svgNS);this.svgMouseEventRemove(svg);if(type=="Brush"){var isDrawing=false;var path=null;const classes=["ui-rotatable-handle","ui-resizable-handle","resize-icon","rm-icon"];let ElemFoundOnMouseDown=false;function containsAnyClass(element,classes){return classes.some(cls=>element.classList.contains(cls))}this.startDrawing1=event=>{let color=jQuery("#highlight-bg-color-picker").css("background-color");let highlightSize=document.querySelector("#highlight-size").value;let element=document.elementFromPoint(event.clientX,event.clientY);if(element&&(containsAnyClass(element,classes)||element.closest("#rotateDiv"))){ElemFoundOnMouseDown=true;return}else{isDrawing=true;var point=getSVGPoint(event);path=document.createElementNS("http://www.w3.org/2000/svg","path");path.setAttribute("stroke",color);path.setAttribute("stroke-width",highlightSize);path.setAttribute("fill","none");path.setAttribute("d","M"+point.x+","+point.y);path.classList.add("freeHand","freeHandUndo");svg.appendChild(path);this.ensureBlurLast()}};this.drawLine1=event=>{if(!isDrawing)return;var point=getSVGPoint(event);var d=path.getAttribute("d");d+=" L"+point.x+","+point.y;path.setAttribute("d",d)};this.stopDrawing1=()=>{if(!isDrawing)return;let color=jQuery("#highlight-bg-color-picker").css("background-color");let highlightSize=document.querySelector("#highlight-size").value;isDrawing=false;if(!ElemFoundOnMouseDown){const zoomStatus=document.querySelector("#screenshot-wrapper-top .zoom-quix-status").innerText;const mainWidth=parseInt(document.querySelector(".mainSVG").getAttribute("width"));const mainHeight=parseInt(document.querySelector(".mainSVG").getAttribute("height"));this.undoStack.push({element:svg,action:"freeHand",type:"freeHand",id:"freeHandUndo",mainClass:{freeHand:"freeHand"},pathData:path.getAttribute("d"),stroke:{stroke:color,strokeWidth:highlightSize},mainSvg:{mainWidth:mainWidth,mainHeight:mainHeight,zoomStatus:zoomStatus}});this.freeHandCordinates.push("freeHand");jQuery(".icon-undo img").removeClass("disabled")}path=null};function getSVGPoint(event){var point=svg.createSVGPoint();point.x=event.clientX;point.y=event.clientY;return point.matrixTransform(svg.getScreenCTM().inverse())}svg.addEventListener("mousedown",this.startDrawing1);svg.addEventListener("mousemove",this.drawLine1);svg.addEventListener("mouseup",this.stopDrawing1);svg.addEventListener("mouseleave",this.stopDrawing1)}else{this.applyShapeAndSmiley(type,svg,libItem)}};applyShapeAndSmiley=async(type,svg,libItem)=>{let _this=this;let aspectRatioVal=true;let importedNode;_this.lastArrow=false;_this.lastLine=false;if(type=="shape"){this.showRightSidebar("library-shape");jQuery("#library-color-picker").css("background-color","#203f99");libItem=libItem.replaceAll("#FFFFFF","#203f99");this.setSpectrumColor("#203f99","shape");libItem=libItem.replaceAll('width="30px"',`width="100%"`);libItem=libItem.replaceAll('height="30px"',`height="100%"`);const parser=new DOMParser;const doc=parser.parseFromString(libItem,"image/svg+xml");importedNode=document.importNode(doc.documentElement,true);importedNode.setAttribute("id","sameSVG")}else if(type=="smiley"){importedNode=document.createElement("span");importedNode.style.cssText="width: 100%; height: 100%; position: absolute;top: 0px; left: 0px;";importedNode.style.fontSize="70px";importedNode.textContent=libItem}else if(type=="Block"){aspectRatioVal=false;const color1=jQuery("#highlight-bg-color-picker").css("background-color");importedNode=`<svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
      <rect id="Block" width="100%" height="100%" x="0" y="0" fill="${color1}" style="opacity: 0.6;"/>
    </svg>
    `}else if(type=="blur"){aspectRatioVal=false;importedNode=`<svg id="sameSVG" class="blur" height="100%" width="100%" xmlns="http://www.w3.org/2000/svg" style="backdrop-filter: blur(3px);">
            <rect x="0" y="0" width="100%" height="100%" fill="transparent" />
           </svg>`}else if(type=="image"){importedNode=`<svg height="100%" width="100%" xmlns="http://www.w3.org/2000/svg" style="overflow: visible">
          <image height="100%" width="100%" href=${libItem} style="width: auto; height: 100%; object-fit: cover;"/>
          </svg>`}else if(type=="text"){const borderColor=document.querySelector(".annotation-col #outline-color-picker").style.backgroundColor;const borderWidth=document.querySelector(".annotation-col #font-outline-size").value;const fontsize=document.querySelector(".annotation-col #font-size").value;const fontFamily=document.querySelector(".annotation-col #font-family").value;const textColor=document.querySelector(".annotation-col #text-color-picker").style.backgroundColor;aspectRatioVal=false;importedNode=document.createElement("div");importedNode.id="textarea";importedNode.textContent="";importedNode.style.width="100%";importedNode.style.height="100%";importedNode.style.overflow="hidden";importedNode.style.backgroundColor="rgba(254, 254, 254, 0)";importedNode.contentEditable="true";importedNode.style.textAlign="left";importedNode.style.border=`${borderWidth}px  solid  ${borderColor}`;importedNode.style.color=textColor||"#FF0000";importedNode.style.fontFamily=fontFamily||"Arial";importedNode.style.fontSize=fontsize+"px"||"14";importedNode.dir="ltr"}else if(type=="reactangle"){document.querySelector(".shapes .annotation-outline-shape #outline-color-picker-shape").style.backgroundColor="#203f99";document.querySelector(".shapes .annotation-outline-shape #font-outline-size-shape").value="2";aspectRatioVal=false;importedNode=` <svg width="100%" height="100%"  style='overflow: visible' >
      <rect id="reactangle" x="0" y="0" width="100%" height="100%" stroke="#203f99" stroke-width="2" fill="none" />
      </svg>`}else if(type=="oval"){document.querySelector(".shapes .annotation-outline-shape #outline-color-picker-shape").style.backgroundColor="#203f99";document.querySelector(".shapes .annotation-outline-shape #font-outline-size-shape").value="2";aspectRatioVal=false;importedNode=`<svg width="100%" height="100%"  style='overflow: visible'>
                  <ellipse id="oval" cx="50%" cy="50%" rx="50%" ry="50%" stroke="#203f99" stroke-width="2" fill="none" />
                </svg>`}else if(type=="line"||type=="arrow"){_this.svgFreeHandShapes(type,importedNode,svg,aspectRatioVal);return}_this.addSvgElements(type,importedNode,svg,aspectRatioVal)};ensureBlurLast(){var parentContainer=document.querySelector(".mainSVG");const allOuterSVGs=parentContainer.querySelectorAll(".outer-svg-fo");const outerSVGsWithBlur=Array.from(allOuterSVGs).filter(function(outerSVG){return outerSVG.querySelector(".blur")!==null});var targetSVGs=Array.from(outerSVGsWithBlur);var firstTargetSVG=targetSVGs.length>0?targetSVGs[0]:null;allOuterSVGs.forEach(function(svgElement){if(!targetSVGs.includes(svgElement)){if(firstTargetSVG){parentContainer.insertBefore(svgElement,firstTargetSVG)}else{parentContainer.appendChild(svgElement)}}});targetSVGs.forEach(function(svgElement){parentContainer.appendChild(svgElement)})}addSvgElements=async(type,importedNode,svg,aspectRatioVal)=>{let _this=this;this.lastLine=false;this.lastArrow=false;this.svgMouseEventRemove(svg);let uniqueID="";const svgNS="http://www.w3.org/2000/svg";const capturedScreen=document.getElementById("captured-screen");const newSVG=document.createElementNS(svgNS,"svg");const zoomStatus=document.querySelector("#screenshot-wrapper-top .zoom-quix-status").innerText;newSVG.setAttribute("width",capturedScreen.offsetWidth);newSVG.setAttribute("height",capturedScreen.offsetHeight);uniqueID="added-svg"+Date.now();newSVG.setAttribute("id",uniqueID);$(".outer-svg-fo.active").removeClass("active");const foreignObject=document.createElementNS(svgNS,"foreignObject");foreignObject.setAttribute("width","100px");foreignObject.setAttribute("height","100px");const element=document.querySelector("#screenshot-wrapper-bottom");const scrollTop=element.scrollTop;var randomX=Math.floor(Math.random()*parseInt(svg.getAttribute("width")/3));var randomY=Math.floor(Math.random()*200+scrollTop);foreignObject.setAttribute("x","0");foreignObject.setAttribute("y","0");foreignObject.style.overflow="visible";foreignObject.style.transform=`translate(${randomX}px, ${randomY}px) rotate(0rad)`;let rotateDiv=document.createElement("div");rotateDiv.style.cssText="position:absolute; width:100%; height: 100%";rotateDiv.id="rotateDiv";if(type=="Block"||type=="blur"||type=="image"||type=="reactangle"||type=="oval"){rotateDiv.innerHTML=importedNode}else{rotateDiv.append(importedNode)}foreignObject.appendChild(rotateDiv);newSVG.classList="outer-svg-fo active "+type;newSVG.appendChild(foreignObject);svg.appendChild(newSVG);this.ensureBlurLast();if(type=="smiley"){const parentWidth=foreignObject.clientWidth;const fontSizePercentage=Math.floor(70/100*parentWidth);importedNode.style.fontSize=fontSizePercentage+"px"}$(document).ready(function(){$(".mainSVG").each(function(index){_this.svgElementEvents(type,svg,uniqueID,aspectRatioVal,newSVG,foreignObject)})});_this.addSvgCoordinate(newSVG);const mainWidth=parseInt(document.querySelector(".mainSVG").getAttribute("width"));const mainHeight=parseInt(document.querySelector(".mainSVG").getAttribute("height"));if(type!="image"){_this.undoStack.push({element:newSVG,action:"added",type:type,foreignObject:foreignObject,"parent-id":uniqueID,width:"100px",height:"100px",transform:`translate(${randomX}px, ${randomY}px) rotate(0rad)`,aspectRatioVal:aspectRatioVal,mainSvg:{mainWidth:mainWidth,mainHeight:mainHeight,zoomStatus:zoomStatus}})}if(type=="image"){const imageElement=document.querySelector("#"+uniqueID+" image");const imageRect=imageElement.getBoundingClientRect();const imageHeight=imageRect.height;const imageWidth=imageRect.width;if(imageHeight&&imageWidth){$("#"+uniqueID).find("foreignObject").attr({width:imageWidth,height:imageHeight})}_this.undoStack.push({element:newSVG,action:"added",type:type,foreignObject:foreignObject,"parent-id":uniqueID,width:imageWidth+"px",height:imageHeight+"px",transform:`translate(${randomX}px, ${randomY}px) rotate(0rad)`,aspectRatioVal:aspectRatioVal,mainSvg:{mainWidth:mainWidth,mainHeight:mainHeight,zoomStatus:zoomStatus}})}if(_this.svgItems.length>=0){jQuery(".icon-undo img").removeClass("disabled")}};addSvgCoordinate=coordinate=>{this.svgCordinates.push(coordinate)};svgElementEvents=async(type,svg,uniqueID,aspectRatioVal,newSVG,foreignObject)=>{let _this=this;_this.addRemoveIcon(uniqueID);_this.addResizeIcon(uniqueID);if(type=="text"){_this.textAreaFocusEvent(uniqueID)}else{$("#"+uniqueID).find("foreignObject").css("user-select","none")}$(newSVG).on("click",function(){$(".outer-svg-fo.active").removeClass("active");$(this).addClass("active");_this.svgFocusEvents($(this))});foreignObject.addEventListener("mouseover",function(){if(type!=="text"){$(this).css("border","1px dashed black")}});foreignObject.addEventListener("mouseout",function(){$(this).css("border","none")});let svgElem=$(svg);$("#"+uniqueID).find("foreignObject").resizable({aspectRatio:aspectRatioVal,minWidth:50,minHeight:50,handles:"e,s,es",containment:svg,start:function(event,ui){_this.lastLine=false;_this.lastArrow=false;_this.svgResizeStart(svg,foreignObject);$(".outer-svg-fo.active").removeClass("active");$(newSVG).addClass("active");_this.svgFocusEvents(newSVG)},resize:function(event,ui){_this.svgResizing(svg,aspectRatioVal,ui,type,uniqueID)},stop:()=>{_this.svgResizeStop(uniqueID,foreignObject,aspectRatioVal,newSVG,type)}}).draggable({cursor:"move",containment:svg,start:async(event,ui)=>{_this.lastLine=false;_this.lastArrow=false;$("#"+uniqueID).find("foreignObject").find("#textarea").focus();_this.svgDragStart(svg,foreignObject,svgElem,event);$(".outer-svg-fo.active").removeClass("active");$(newSVG).addClass("active");_this.svgFocusEvents(newSVG)},drag:(event,ui)=>{_this.svgDragging(svgElem,foreignObject,ui,event)},stop:()=>{_this.svgDragStop(uniqueID,foreignObject,aspectRatioVal,newSVG,type)}}).rotatable({transforms:"translate",wheelRotate:false,start:function(event,ui){_this.lastLine=false;_this.lastArrow=false;_this.svgRotateStart(svg,foreignObject);$(".outer-svg-fo.active").removeClass("active");$(newSVG).addClass("active");_this.svgFocusEvents(newSVG)},rotate:(event,ui)=>{let angle=ui.angle.current;_this.svgRotating(foreignObject,angle)},stop:()=>{_this.svgRotateStop(uniqueID,foreignObject,aspectRatioVal,newSVG,type)}});$(".ui-rotatable-handle").css("height","20px");$(".ui-rotatable-handle").css("width","20px");$(".ui-rotatable-handle").css("right","-10px");$(".ui-rotatable-handle").css("top","-10px")};textAreaFocusEvent=uniqueID=>{let _this=this;document.querySelector("#"+uniqueID+" #textarea").addEventListener("keydown",function(event){if(event.shiftKey&&event.key==="+"||event.shiftKey&&event.key==="_"){event.preventDefault()}});$("#"+uniqueID).find("foreignObject").find("#textarea").each(function(){$(this).on("click",function(event){var range=document.createRange();var selection=window.getSelection();var clickedNode=event.target.firstChild;var clickOffset=0;var node=event.target.firstChild;var caretPosition=_this.getCaretPosition(event);if(clickedNode!=null){range.setStart(clickedNode,caretPosition);range.collapse(true);selection.removeAllRanges();selection.addRange(range);event.target.focus()}else{$(this).focus()}});_this.adjustTextAreaHeightAndWidth($(this))})};getCaretPosition=event=>{var range=document.caretRangeFromPoint(event.clientX,event.clientY);var textNode=range.startContainer;var offset=range.startOffset;var charIndex=0;if(textNode.nodeType==3){var text=textNode.nodeValue;for(var i=0;i<text.length;i++){if(i==offset){break}if(text[i]!==""){charIndex++}}}return charIndex};addRemoveIcon=uniqueID=>{if(uniqueID){let removeIcon=`<image class="rm-icon"
      style="display:none; height: 18px;  width: 18px; position: absolute; left: -10px; top: -10px; top: -10px; padding: 4px; border-radius: 50%; background: rgb(0 0 0 / 85%); cursor: pointer; user-select: none;"
      src="${this.deleteIcon}">`;jQuery("#"+uniqueID+".outer-svg-fo foreignObject").append(removeIcon);jQuery("#"+uniqueID+".outer-svg-fo foreignObject").on("mouseover",()=>{jQuery("#"+uniqueID+".outer-svg-fo foreignObject .rm-icon").css("display","block")});jQuery("#"+uniqueID+".outer-svg-fo foreignObject").on("mouseout",()=>{jQuery("#"+uniqueID+".outer-svg-fo foreignObject .rm-icon").css("display","none")});jQuery("#"+uniqueID+".outer-svg-fo foreignObject .rm-icon").on("click",()=>this.removeSvgItem(uniqueID))}};addResizeIcon=uniqueID=>{if(uniqueID){let removeIcon=`<image class="resize-icon"
      style="display:none; height: 18px;  width: 18px; position: absolute;  left: 50%; top: -10px;transform: translate(-50%, -10%);  top: -10px; padding: 4px; border-radius: 50%; background: rgb(0 0 0 / 85%); cursor: pointer; user-select: none;"
      src="${this.resizeIcon}">`;jQuery("#"+uniqueID+".outer-svg-fo foreignObject").append(removeIcon);jQuery("#"+uniqueID+".outer-svg-fo foreignObject").on("mouseover",()=>{jQuery("#"+uniqueID+".outer-svg-fo foreignObject .resize-icon").css("display","block")});jQuery("#"+uniqueID+".outer-svg-fo foreignObject").on("mouseout",()=>{jQuery("#"+uniqueID+".outer-svg-fo foreignObject .resize-icon").css("display","none")})}};svgDragStart=(svg,foreignObject,svgElem,event)=>{this.svgMouseEventRemove(svg);let _this=this;let transformString=foreignObject.style.transform;let foreignWidth=parseInt(foreignObject.style.width)||100;let foreignHeight=parseInt(foreignObject.style.height)||100;let transformRes=_this.getTransformValues(transformString);_this.setTranform(foreignObject,transformRes.x,transformRes.y,transformRes.rotate);let xTranslation=event.clientX-svgElem.offset().left;let yTranslation=event.clientY-svgElem.offset().top;var rect=foreignObject.getBoundingClientRect();function radians(degrees){return degrees*Math.PI/180}let dynamicConstant=0;let absRotate=Math.abs(transformRes.rotate);if(absRotate>0&&absRotate<=radians(20)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.09}else if(absRotate>radians(20)&&absRotate<=radians(40)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.17}else if(absRotate>radians(40)&&absRotate<=radians(60)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.19}else if(absRotate>radians(60)&&absRotate<=radians(80)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.195}else if(absRotate>radians(80)&&absRotate<=radians(100)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.15}else if(absRotate>radians(100)&&absRotate<=radians(120)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.125}else if(absRotate>radians(120)&&absRotate<=radians(140)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.17}else if(absRotate>radians(140)&&absRotate<=radians(160)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.19}else if(absRotate>radians(160)&&absRotate<=radians(180)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.09}else if(absRotate>radians(180)&&absRotate<=radians(200)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.13}else if(absRotate>radians(200)&&absRotate<=radians(220)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.19}else if(absRotate>radians(220)&&absRotate<=radians(240)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.17}else if(absRotate>radians(240)&&absRotate<=radians(260)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.125}else if(absRotate>radians(260)&&absRotate<=radians(280)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.15}else if(absRotate>radians(280)&&absRotate<=radians(300)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.195}else if(absRotate>radians(300)&&absRotate<=radians(320)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.19}else if(absRotate>radians(320)&&absRotate<=radians(340)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.17}else if(absRotate>radians(340)&&absRotate<=radians(360)){dynamicConstant=Math.min(foreignWidth,foreignHeight)*.09}let offsetX=dynamicConstant;let offsetY=dynamicConstant;if(transformRes.rotate!=0){_this.FFclickX=event.clientX-rect.left-offsetX;_this.FFclickY=event.clientY-rect.top-offsetY}else{_this.FFclickX=event.clientX-rect.left;_this.FFclickY=event.clientY-rect.top}};svgDragging=(svgElem,foreignObject,ui,event)=>{let _this=this;let transformString=foreignObject.style.transform;let transformRes=_this.getTransformValues(transformString);const wid=foreignObject.getAttribute("width").split("px")[0];const higt=foreignObject.getAttribute("height").split("px")[0];let xTranslation=event.clientX-(svgElem.offset().left+_this.FFclickX);let yTranslation=event.clientY-(svgElem.offset().top+_this.FFclickY);xTranslation=Math.max(0,Math.min(xTranslation,svgElem.outerWidth()-ui.helper.width()));yTranslation=Math.max(0,Math.min(yTranslation,svgElem.outerHeight()-ui.helper.height()));xTranslation=Math.min(xTranslation-50,svgElem.outerWidth());yTranslation=Math.min(yTranslation-50,svgElem.outerHeight());_this.setTranform(foreignObject,xTranslation+50,yTranslation+50,transformRes.rotate)};svgDragStop=(uniqueID,foreignObject,aspectRatioVal,newSVG,type)=>{let _this=this;let transformString=foreignObject.style.transform;let transformRes=_this.getTransformValues(transformString);_this.lastTransform=transformString;let style=window.getComputedStyle(foreignObject);let width=style.getPropertyValue("width");let height=style.getPropertyValue("height");let transform=foreignObject.getAttribute("transform");let elem=document.querySelector('[id="'+uniqueID+'"]');const zoomStatus=document.querySelector("#screenshot-wrapper-top .zoom-quix-status").innerText;const mainWidth=parseInt(document.querySelector(".mainSVG").getAttribute("width"));const mainHeight=parseInt(document.querySelector(".mainSVG").getAttribute("height"));_this.undoStack.push({element:newSVG,foreignObject:foreignObject,type:type,"parent-id":uniqueID,action:"drag",width:width,height:height,transform:transformString,aspectRatioVal:aspectRatioVal,mainSvg:{mainWidth:mainWidth,mainHeight:mainHeight,zoomStatus:zoomStatus}})};svgResizeStart=(svg,foreignObject)=>{this.svgMouseEventRemove(svg);let _this=this;let transformString=foreignObject.style.transform;let transformRes=_this.getTransformValues(transformString);_this.setTranform(foreignObject,transformRes.x,transformRes.y,transformRes.rotate)};svgResizing=(svg,aspectRatioVal,ui,type,uniqueID)=>{let _this=this;let width=ui.size.width;let height=ui.size.height;if(type!="image"&&type!="text"){if(aspectRatioVal==false){$("#"+uniqueID).find("foreignObject").width(width);$("#"+uniqueID).find("foreignObject").height(height)}else{$("#"+uniqueID).find("foreignObject").width(width);$("#"+uniqueID).find("foreignObject").height(width)}if(type!=="smiley"&&type!=="image"){$("#"+uniqueID).find("#sameSVG").attr({width:width,height:height});$("#"+uniqueID).find("foreignObject").attr({width:width,height:height})}else if(type=="smiley"){$("#"+uniqueID).find("foreignObject").attr({width:width,height:height});const fontSizePercentage=Math.floor(70/100*width);$("#"+uniqueID).find("span").css("font-size",fontSizePercentage+"px")}else{alert("something went wrong")}}else if(type=="image"){const imageElement=document.querySelector("#"+uniqueID+" image");const imageRect=imageElement.getBoundingClientRect();const imageHeight=imageRect.height;const imageWidth=imageRect.width;$("#"+uniqueID).find("foreignObject").attr({width:imageWidth,height:imageHeight})}else if(type=="text"){$("#"+uniqueID).find("foreignObject").attr({width:width,height:height})}};svgResizeStop=async(uniqueID,foreignObject,aspectRatioVal,newSVG,type)=>{let _this=this;let transformString=foreignObject.style.transform;let transformRes=_this.getTransformValues(transformString);_this.lastTransform=transformString;let width=foreignObject.getAttribute("width");let height=foreignObject.getAttribute("height");let transform=foreignObject.getAttribute("transform");let elem=document.querySelector('[id="'+uniqueID+'"]');const zoomStatus=document.querySelector("#screenshot-wrapper-top .zoom-quix-status").innerText;const mainWidth=parseInt(document.querySelector(".mainSVG").getAttribute("width"));const mainHeight=parseInt(document.querySelector(".mainSVG").getAttribute("height"));_this.undoStack.push({element:newSVG,foreignObject:foreignObject,type:type,"parent-id":uniqueID,action:"resize",width:width,height:height,transform:transformString,aspectRatioVal:aspectRatioVal,mainSvg:{mainWidth:mainWidth,mainHeight:mainHeight,zoomStatus:zoomStatus}})};svgRotateStart=async(svg,foreignObject)=>{this.svgMouseEventRemove(svg);let _this=this;let transformString=foreignObject.style.transform;let transformRes=_this.getTransformValues(transformString);_this.setTranform(foreignObject,transformRes.x,transformRes.y,transformRes.rotate)};svgRotating=async(foreignObject,angle)=>{let _this=this;let transformString=foreignObject.style.transform;let transformRes=_this.getTransformValues(transformString);_this.setTranform(foreignObject,transformRes.x,transformRes.y,angle)};svgRotateStop=async(uniqueID,foreignObject,aspectRatioVal,newSVG,type)=>{let _this=this;let transformString=foreignObject.style.transform;let transformRes=_this.getTransformValues(transformString);_this.lastTransform=transformString;let elem=document.querySelector('[id="'+uniqueID+'"]');const zoomStatus=document.querySelector("#screenshot-wrapper-top .zoom-quix-status").innerText;const mainWidth=parseInt(document.querySelector(".mainSVG").getAttribute("width"));const mainHeight=parseInt(document.querySelector(".mainSVG").getAttribute("height"));_this.undoStack.push({element:newSVG,foreignObject:foreignObject,type:type,"parent-id":uniqueID,action:"rotate",rotate:transformString,aspectRatioVal:aspectRatioVal,mainSvg:{mainWidth:mainWidth,mainHeight:mainHeight,zoomStatus:zoomStatus}})};removeEvents=elem=>{if(elem.data("ui-draggable")){elem.draggable("destroy")}if(elem.data("ui-resizable")){elem.resizable("destroy")}if(elem.data("ui-rotatable")){elem.rotatable("destroy")}};svgFocusEvents=obj=>{const mainSVG=document.querySelector(".mainSVG");this.lastLine=false;this.lastArrow=false;if($(obj).hasClass("text")){this.showRightSidebar("text");const fontFamily=$(obj).find("#textarea").css("font-family");const fontSize=$(obj).find("#textarea").css("font-size");const textColor=$(obj).find("#textarea").css("color");let backgroundColor=$(obj).find("#textarea").css("background-color");const outlineWidth=$(obj).find("#textarea").css("border-width");const outlineStyle=$(obj).find("#textarea").css("border-style");const outlineColor=$(obj).find("#textarea").css("border-color");if(backgroundColor=="rgba(254, 254, 254, 0)"){backgroundColor="rgba(221, 221, 210, 0.827)"}document.querySelector(".text .annotation-font-family #font-family").value=fontFamily||"Arial";document.querySelector(".text .annotation-fonts #font-size").value=`${parseInt(fontSize)}`||"14";document.querySelector(".text .annotation-fonts-colors #text-color-picker").style.backgroundColor=textColor||"rgb(255, 0, 0)";document.querySelector(".text .annotation-fill-transparency #fill-color-picker").style.backgroundColor=`${backgroundColor}`||"rgba(221, 221, 210, 0.827)";document.querySelector(".text .annotation-outline #outline-color-picker").style.backgroundColor=outlineColor||"rgb(31, 54, 202)";document.querySelector(".text .annotation-outline #font-outline-size").value=`${parseInt(outlineWidth)}`||"2";jQuery(".outer-svg-fo.text.active #textarea").unbind("keyup");jQuery(".outer-svg-fo.text.active #textarea").on("keyup",event=>{if(event.keyCode==86&&event.ctrlKey||event.keyCode==32){}})}else if($(obj).hasClass("shape")){this.showRightSidebar("library-shape");const backgroundColor=$(obj).find("#rotateDiv").find("svg").attr("fill");document.querySelector(".annotation-library-fill #library-color-picker").style.backgroundColor=`${backgroundColor}`||"#203f99"}else if($(obj).hasClass("reactangle")){this.showRightSidebar("shapes");const outlineColor=$(obj).find("#reactangle").attr("stroke");const outlineWidth=$(obj).find("#reactangle").attr("stroke-width");document.querySelector(".shapes .annotation-outline-shape #outline-color-picker-shape").style.backgroundColor=outlineColor;document.querySelector(".shapes .annotation-outline-shape #font-outline-size-shape").value=outlineWidth;this.adjustShapesAutomatically()}else if($(obj).hasClass("oval")){this.showRightSidebar("shapes");const outlineColor=$(obj).find("ellipse").attr("stroke");const outlineWidth=$(obj).find("ellipse").attr("stroke-width");document.querySelector(".shapes .annotation-outline-shape #outline-color-picker-shape").style.backgroundColor=outlineColor;document.querySelector(".shapes .annotation-outline-shape #font-outline-size-shape").value=outlineWidth;this.adjustShapesAutomatically()}else if($(obj).hasClass("Block")){const elementColor=$(obj).find("#Block").attr("fill");this.svgMouseEventRemove(mainSVG);document.querySelector(".annotation-highlight #highlight-bg-color-picker").style.backgroundColor=elementColor;jQuery(".highlight-type select").val("Block");this.showRightSidebar("highlight");this.adjustBlockAutomatically("Block",elementColor)}else if($(obj).hasClass("smiley")){jQuery("#download-overlay-inner #annotations-popup-outer").css("display","none")}else if($(obj).hasClass("image")){jQuery("#download-overlay-inner #annotations-popup-outer").css("display","none")}else if($(obj).hasClass("blur")){let blur=$(obj).find("#sameSVG").css("backdrop-filter");let value=blur.match(/blur\(([0-9.]+)px\)/);jQuery("#blur-strength").val=value[1];$("#range-value-blur-strength").html(value[1]);this.showRightSidebar("blur")}};setTranform=(elem,x,y,angle)=>{x=parseInt(x);y=parseInt(y);let wid=elem.getAttribute("width");let higt=elem.getAttribute("height");wid=parseInt(wid.split("px")[0]);higt=parseInt(higt.split("px")[0]);elem.style.transformOrigin=`${wid/2}px ${higt/2}px`;elem.style.transform="translate("+x+"px,"+y+"px) rotate("+angle+"rad) "};getTransformValues=transformString=>{const translateRegex=/translate\(([^,]+),([^)]+)\)/;const rotateRegex=/rotate\(([^)]+)\)/;let x=0;let y=0;let rotate=0;const translateMatches=transformString.match(translateRegex);if(translateMatches&&translateMatches.length>=3){x=parseFloat(translateMatches[1]);y=parseFloat(translateMatches[2])}const rotateMatches=transformString.match(rotateRegex);if(rotateMatches&&rotateMatches.length>=2){rotate=parseFloat(rotateMatches[1])}return{x:x,y:y,rotate:rotate}};getTransformValues2=async transformString=>{const translateRegex=/translate\(([^,]+),([^)]+)\)/;const rotateRegex=/rotate\(([^)]+)\)/;let x=0;let y=0;let rotate=0;const translateMatches=transformString.match(translateRegex);if(translateMatches&&translateMatches.length>=3){x=parseFloat(translateMatches[1]);y=parseFloat(translateMatches[2])}const rotateMatches=transformString.match(rotateRegex);if(rotateMatches&&rotateMatches.length>=2){rotate=parseFloat(rotateMatches[1])}return{x:x,y:y,rotate:rotate}};uploadAnnotationRequest=file=>{var reader=new FileReader;reader.onload=event=>{var img=new Image;img.src=event.target.result;this.applySvgAndUpdate("image",img.src)};reader.readAsDataURL(file)};addPaddingArea=(image,callback)=>{let canvas=document.getElementById("captured-screen");canvas.height=image.height+this.whiteSpaceAround*2;canvas.width=image.width+this.whiteSpaceAround*2;let context=canvas.getContext("2d");context.fillStyle="white";context.fillRect(0,0,canvas.width,canvas.height);context.drawImage(image,this.whiteSpaceAround,this.whiteSpaceAround);this.isWhiteSpace=true;callback()};removePaddingArea=(image,callback)=>{let canvas=document.getElementById("captured-screen");canvas.height=image.height-this.whiteSpaceAround*2;canvas.width=image.width-this.whiteSpaceAround*2;let context=canvas.getContext("2d");context.fillStyle="white";context.fillRect(0,0,canvas.width,canvas.height);context.drawImage(image,this.whiteSpaceAround,this.whiteSpaceAround,canvas.width,canvas.height,0,0,canvas.width,canvas.height);this.isWhiteSpace=false;callback()};extractBlurValue=blurString=>{var regex=/blur\((\d+)px\)/;var match=blurString.match(regex);if(match&&match[1]){return parseInt(match[1])}return null};extractTranslateFromMatrix=matrixString=>{var regex=/matrix\((.*)\)/;var match=matrixString.match(regex);if(match&&match[1]){var matrixValues=match[1].split(",").map(parseFloat);var tx=matrixValues[4];var ty=matrixValues[5];return{x:tx,y:ty}}return null};extractTranslateValues=transformString=>{var regex=/translate\(([-+]?\d*\.?\d+)(px)?,\s*([-+]?\d*\.?\d+)(px)?\)/;var match=transformString.match(regex);if(match&&match[1]&&match[3]){return{x:parseFloat(match[1]),y:parseFloat(match[3])}}return null};drawBlurAll=async(index,callback)=>{let _this=this;let blurElements=jQuery(".outer-svg-fo.blur");if(blurElements.length>0){_this.blurElementsCount=blurElements.length;let blurElement=blurElements[index];let foreignElem=jQuery(blurElement).find("foreignObject");let blurVal=jQuery(blurElement).find("svg").css("backdrop-filter");blurVal=_this.extractBlurValue(blurVal);let transformVal=jQuery(foreignElem).css("transform");let translateVal=_this.extractTranslateFromMatrix(transformVal);let x=translateVal.x;let y=translateVal.y;let w=parseInt(jQuery(foreignElem).css("width"));let h=parseInt(jQuery(foreignElem).css("height"));let blurStrength=blurVal*2+"px";let canvasB=document.getElementById("captured-screen");let ctxB=canvasB.getContext("2d");x=x/zoomValuePercentRatio;y=y/zoomValuePercentRatio;w=w/zoomValuePercentRatio;h=h/zoomValuePercentRatio;let imageObjB=new Image;imageObjB.onload=()=>{ctxB.globalAlpha=1;ctxB.drawImage(imageObjB,0,0);ctxB.clearRect(0,0,500,500);ctxB.filter="blur("+blurStrength+")";ctxB.globalAlpha=1;ctxB.drawImage(imageObjB,0,0);ctxB.strokeStyle="transparent";let imgData=ctxB.getImageData(x,y,w,h);ctxB.clearRect(0,0,canvasB.width,canvasB.height);ctxB.filter="none";ctxB.globalAlpha=1;ctxB.drawImage(imageObjB,0,0);let rw;let rh;if(w<0){rw=x+w}else{rw=x}if(h<0){rh=y+h}else{rh=y}ctxB.lineWidth=3;ctxB.putImageData(imgData,rw,rh);ctxB.strokeRect(x,y,w,h);if(index+1==_this.blurElementsCount){callback()}else{index++;_this.drawBlurAll(index,callback)}};imageObjB.src=canvasB.toDataURL("image/jpeg",1)}else{callback()}};openPaddingPopup=()=>{let _this=this;let canvas=document.getElementById("captured-screen");_this.updateCanvasByAnno(canvas,(source,res)=>{let image=document.createElement("img");image.src=source;image.onload=()=>{let canW=parseInt(window.innerWidth/100*90);let canvasW=parseInt(window.innerWidth/100*90);let canvasH=parseInt(window.innerHeight/100*80);let canvasPadding=document.querySelector("#padding-screen");let canvasPaddingCtx=canvasPadding.getContext("2d");let x=0;let y=0;if(res.topDraw==0){y=_this.whiteSpaceAround;image.height=image.height-_this.whiteSpaceAround}if(res.bottomDraw==0){image.height=image.height-_this.whiteSpaceAround}if(res.leftDraw==0){x=_this.whiteSpaceAround;image.width=image.width-_this.whiteSpaceAround}if(res.rightDraw==0){image.width=image.width-_this.whiteSpaceAround}canvasPadding.width=image.width;canvasPadding.height=image.height;canvasPadding.style.width=canW-17+"px";canvasPaddingCtx.drawImage(image,x,y,image.width,image.height,0,0,image.width,image.height);_this.imageObjPadding=image;document.querySelector("#quix-padding-annotation-inner").style.width=canvasW+"px";document.querySelector("#quix-padding-annotation-inner").style.height=canvasH+"px";document.querySelector("#quix-padding-annotation-canvas").style.height=canvasH-50+"px";let canvas=document.getElementById("padding-screen");let capturedScreen=canvas.toDataURL("image/jpeg",1);_this.uploadScreenshotAuto("continue",capturedScreen);loadScreenshotOnDownloadScreen("continue");jQuery(".fulscreen-mode").hide();jQuery(".download-mode").show();_this.borderPaddingEventListener();jQuery("#padding-cancel").unbind("click");jQuery("#padding-cancel").on("click",()=>{document.querySelector("#quix-padding-annotation-wrapper").style.display="none"});jQuery("#padding-continue").unbind("click");jQuery("#padding-continue").on("click",()=>{_this.continuePaddingStep();document.querySelector("#quix-padding-annotation-wrapper").style.display="none"});jQuery("#padding-skip").unbind("click");jQuery("#padding-skip").on("click",()=>{_this.skipPaddingStep();document.querySelector("#quix-padding-annotation-wrapper").style.display="none"})}})};borderPaddingEventListener=()=>{let _this=this;jQuery(".annotation-border-radius input").unbind("input");jQuery(".annotation-border-radius input").on("input",()=>{_this.needUploadScreanshotToServer=true;_this.applyOthersBlockDimensions()});jQuery(".annotation-shadow #screenshot-shadow").unbind("change");jQuery(".annotation-shadow #screenshot-shadow").on("change",()=>{_this.needUploadScreanshotToServer=true;_this.applyOthersBlockDimensions();_this.offGradientBox()});jQuery(".annotation-bordertext input").unbind("input");jQuery(".annotation-bordertext input").on("input",()=>{_this.needUploadScreanshotToServer=true;_this.applyOthersBlockDimensions();_this.offGradientBox()});jQuery(".annotation-paddingtext input").unbind("input");jQuery(".annotation-paddingtext input").on("input",()=>{_this.needUploadScreanshotToServer=true;_this.applyOthersBlockDimensions();_this.offGradientBox()});jQuery("#paddingGColor-input").unbind("change");jQuery("#paddingGColor-input").on("change",elem=>{_this.needUploadScreanshotToServer=true;let gradType=jQuery(elem.currentTarget)[0].value;_this.applyOthersGradientPadding(gradType);_this.offGradientBox()});jQuery("#borderGColor-input").unbind("change");jQuery("#borderGColor-input").on("change",elem=>{_this.needUploadScreanshotToServer=true;let gradType=jQuery(elem.currentTarget)[0].value;_this.applyOthersGradient(gradType);_this.offGradientBox()});jQuery(".gradient-dropdown-content .clearGradient").on("click",elem=>{_this.clearGradient()});jQuery(".annotation-paddinggradient-download span").unbind("click");jQuery(".annotation-paddinggradient-download span").on("click",elem=>{let gradientDropDownValue=jQuery(".gradient-dropdown-content").css("display");if(gradientDropDownValue=="flex"){jQuery(".gradient-dropdown-content").css("display","none")}else{jQuery(".gradient-dropdown-content").addClass("flex");jQuery(".gradient-dropdown-content").css("display","flex");_this.gradientPicker()}});jQuery(".annotation-paddinggradient-download .color-picker-gradient-1").unbind("click");jQuery(".annotation-paddinggradient-download .color-picker-gradient-1").on("click",elem=>{let gradientDropDownValue=jQuery(".gradient-dropdown-content").css("display");if(gradientDropDownValue=="flex"){jQuery(".gradient-dropdown-content").css("display","none")}else{jQuery(".gradient-dropdown-content").addClass("flex");jQuery(".gradient-dropdown-content").css("display","flex");_this.gradientPicker()}});jQuery("#borderColor-picker").spectrum({move:tinycolor=>{let color=tinycolor.toRgbString();jQuery("#borderColor-picker").css("background-color","#"+color);jQuery("#borderColor-input").val(color);_this.applyOthersBlockDimensions()},show:tinycolor=>{_this.isChanged=false;_this.previouscolor=tinycolor;_this.offGradientBox()},hide:tinycolor=>{if(!_this.isChanged&&_this.previouscolor){let color=tinycolor.toRgbString();jQuery("#borderColor-picker").css("background-color","#"+color);jQuery("#borderColor-input").val(color);_this.applyOthersBlockDimensions()}},change:tinycolor=>{_this.isChanged=true},color:"#ff0000",showAlpha:true,showButtons:true,showInput:true,allowEmpty:true,preferredFormat:"rgb"});jQuery("#paddingColor-picker").spectrum({move:tinycolor=>{let color=tinycolor.toRgbString();_this.selectedPaddingGradientColor=null;jQuery("#paddingColor-picker").css("background-color","#"+color);jQuery("#paddingColor-input").val(color);_this.applyOthersBlockDimensions()},show:tinycolor=>{_this.isChanged=false;_this.previouscolor=tinycolor;_this.offGradientBox()},hide:tinycolor=>{if(!_this.isChanged&&_this.previouscolor){let color=tinycolor.toRgbString();jQuery("#paddingColor-picker").css("background-color","#"+color);jQuery("#paddingColor-input").val(color);_this.applyOthersBlockDimensions()}},change:tinycolor=>{_this.isChanged=true},color:"#ff0",showAlpha:true,showButtons:true,showInput:true,allowEmpty:true,preferredFormat:"rgb"})};gradientPicker=()=>{let _this=this;const gradientDownloads=document.querySelectorAll(".gradient-download");function hideDropdown(event,parent,dropdown){if(!parent.contains(event.target)){dropdown.style.display="none";document.removeEventListener("click",hideDropdown)}}if(extPrefix=="OCR_"){var dropdown=document.querySelector(".gradient-dropdown-content");var parent=document.querySelector(".grad-dropdown");document.addEventListener("click",e=>hideDropdown(e,parent,dropdown))}else{var dropdown=document.querySelector(".gradient-dropdown-content");var parent=document.querySelector(".annotation-paddinggradient-download");document.addEventListener("click",e=>hideDropdown(e,parent,dropdown))}gradientDownloads.forEach(function(gradientDownload){gradientDownload.addEventListener("click",function(){let dd=jQuery(gradientDownload).find("img").attr("src");jQuery(".color-picker-gradient-1").css("background-image",`url(${dd})`);_this.gradientDownloadColor=gradientDownload.getAttribute("value");_this.applyOthersGradientPadding(_this.gradientDownloadColor)})})};offGradientBox=()=>{let gradientDropDownValue=jQuery(".gradient-dropdown-content").css("display");if(gradientDropDownValue=="flex"){jQuery(".gradient-dropdown-content").css("display","none")}else{jQuery(".gradient-dropdown-content").addClass("flex")}};continuePaddingStep=()=>{let _this=this;let canvas=document.getElementById("padding-screen");let capturedScreen=canvas.toDataURL("image/jpeg",1);_this.uploadScreenshotAuto("continue",capturedScreen);loadScreenshotOnDownloadScreen("continue");jQuery(".fulscreen-mode").hide();jQuery(".download-mode").show()};skipPaddingStep=()=>{_this.uploadScreenshotAuto("skip");let canvas=document.getElementById("captured-screen");let capturedScreen=canvas.toDataURL("image/jpeg",1);chrome.runtime.sendMessage({type:"quixyFinalScreenshot",screen:capturedScreen});loadScreenshotOnDownloadScreen("skip");jQuery(".fulscreen-mode").hide();jQuery(".download-mode").show()};uploadScreenshotAuto=(type,source)=>{let _this=this;chrome.storage.local.get(`${extPrefix}quixyLoginUserData`,function(result){if(result[`${extPrefix}quixyLoginUserData`]!==""&&result[`${extPrefix}quixyLoginUserData`]!==null){const data=JSON.stringify({access_token:result[`${extPrefix}quixyLoginUserData`].access_token,token_type:"extension"});helpers.makeServerRequest("POST","",helpers.api+"/user/get",data,res=>{helpers.handleUserSession(res,"get")})}else{helpers.handleUserSession({})}});chrome.storage.local.get(`${extPrefix}screenshotUploadServer`,async obj=>{if(obj[`${extPrefix}screenshotUploadServer`]!==undefined&&obj[`${extPrefix}screenshotUploadServer`]!==""){screenshotUploadServer=obj[`${extPrefix}screenshotUploadServer`];if(isScreenshotUpdated&&screenshotUploadServer){chrome.storage.local.get(`${extPrefix}quixyLoginUserData`,result=>{if(result[`${extPrefix}quixyLoginUserData`]!==""&&result[`${extPrefix}quixyLoginUserData`]!==null){if(type=="skip"){uploadScreenshotServer("manual")}else{uploadScreenshotServerPadding("manual",source)}}})}}});chrome.storage.local.get(`${extPrefix}quixyLoginUserData`,result=>{if(result[`${extPrefix}quixyLoginUserData`]!==""&&result[`${extPrefix}quixyLoginUserData`]!==null){jQuery(".loggedin-item").show();jQuery(".loggedOut-item").hide()}else{jQuery(".loggedin-item").hide();jQuery(".loggedOut-item").show()}})}}