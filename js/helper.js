class helperSG{constructor(){this.feedbackIcon=chrome.runtime.getURL("images/quix-share-feedback-form.png");this.successIcon=chrome.runtime.getURL("/images/quix-success.png");this.failureIcon=chrome.runtime.getURL("/images/quix-failure.png");this.loaderIcon=chrome.runtime.getURL("/images/light-loader.gif");this.logo=chrome.runtime.getURL("/images/vizam-logo.png");this.closeIcon=chrome.runtime.getURL("/images/quix-close-icon.png");this.googleicon=chrome.runtime.getURL("/images/google-icon.png");this.fbicon=chrome.runtime.getURL("/images/facebook-icon.png");this.twittericon=chrome.runtime.getURL("/images/twitter-icon.png");this.linkedinicon=chrome.runtime.getURL("/images/linkedin-icon.png");this.api="https://api.vizam.ai";this.dashboard="https://vizam.ai";this.extPrefix="SG_";this.clientIDOauth="289798756049-kb8flpfrcnsib8kviihvi4ijo50njb2b.apps.googleusercontent.com";this.driveNyoutubeClientID="289798756049-kb8flpfrcnsib8kviihvi4ijo50njb2b.apps.googleusercontent.com";this.fbClientID="3147454238896419";this.downloadFormats={videos:{webm:true,mp4:true},screenshots:{png:true,jpg:true,pdf:true}};this.gradientAvailable=false;this.integrationsAvailable=false;this.recoveryAvailable=false;this.resolutions={"360p":true,"480p":true,"720p":true,"1080p":true,"4K":true};this.unlimitedVideos=20;this.unlimitedScreenshots=40;this.videoLength=299;this.userManagement=false;this.watermark=false;this.limitStopStr="05:00";this.setIntervalRef=null;this.watermarkSettings=[];this.tagsList=[];this.fileType="";this.accountWaterMarkSettings=null}shareViaEmail=()=>{let _this=this;if(jQuery("#download-overlay-inner").hasClass("full-screen-view")){_this.shareViaEmailPopup()}else{chrome.runtime.sendMessage({type:"googleAuth"})}};capitalize=str=>{let _this=this;let strArr=str.split(" ");let Lststring=[];for(let i=0;i<strArr.length;i++){const lower=strArr[i].toLowerCase();let out=strArr[i].charAt(0).toUpperCase()+lower.slice(1);Lststring.push(out)}return Lststring.join(" ")};IsEmail=email=>{let _this=this;let regex=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!regex.test(email)){return false}else{return true}};shareViaEmailPopup=()=>{let _this=this;let loaderIcon="/images/light-loader.gif";let attachmentic="/images/quix-save.png";let shareemailic="/images/quix-share-link-popup.png";jQuery("#email-share-popup-wrapper").remove();let html='<div id="email-share-popup-wrapper">\n        <div class="email-share-popup">\n        <div class="email-share-heading">\n        <img src="'+shareemailic+'"/>\n        <span>Send through Email</span>\n        </div>\n        <div class="email-share-form">\n            <input type="text" name="to-name-feedback" placeholder="Enter Recipient Name*">\n            <input type="text" name="to-email" placeholder="Enter Recipient Email*"/>\n            <textarea id="email-message" placeholder="Message" maxlength ="300" name="email-message"></textarea>\n            <p class="message-counter"></p>\n            <div class="attachment-thumb" style="background-image:url('+attachmentic+');"><p>Screenshot is attached.</p></div>\n        </div>\n        <div class="email-share-submit">\n            <img class="loader-icon" src="'+loaderIcon+'"/>\n            <button class="send-email-share">Send</button>\n            <button class="close-email-share">Close</button>\n        </div>\n        </div>\n        </div>';chrome.storage.local.get(`${this.extPrefix}quixyLoginUserData`,result=>{if(result[`${this.extPrefix}quixyLoginUserData`]!==""&&result[`${this.extPrefix}quixyLoginUserData`]!==null){_this.shareViaEmailPopupHandler(result,html)}else{_this.openSignInpopup();_this.setIntervalRef=setInterval(()=>{chrome.storage.local.get(`${this.extPrefix}quixyLoginUserData`,result=>{if(result[`${this.extPrefix}quixyLoginUserData`]!==""&&result[`${this.extPrefix}quixyLoginUserData`]!==null){clearInterval(_this.setIntervalRef);_this.shareViaEmailPopupHandler(result,html)}})},500)}})};shareViaEmailPopupHandler=(result,html)=>{let sessionData=result[`${this.extPrefix}quixyLoginUserData`];let _this=this;jQuery("body").append(html);jQuery(".send-email-share").unbind("click");jQuery(".send-email-share").on("click",()=>{jQuery("#email-share-popup-wrapper .loader-icon").show();let toName=jQuery("input[name=to-name-feedback]").val();let toEmail=jQuery("#email-share-popup-wrapper input[name=to-email]").val();let emailMessage=jQuery("#email-share-popup-wrapper textarea[name=email-message]").val();if(toName==""){alert("Please enter your name.");jQuery(".loader-icon").hide();return}if(toEmail==""){alert("Please enter email Id.");jQuery("#email-share-popup-wrapper .loader-icon").hide();return}if(!_this.IsEmail(toEmail)){alert("Please enter correct email Id.");jQuery(".loader-icon").hide();return}let access_token=sessionData.access_token;let user_id=sessionData.id;chrome.storage.local.get(`${this.extPrefix}isScreenshotUploadedToServer`,res=>{if(!res[`${this.extPrefix}isScreenshotUploadedToServer`]){uploadScreenshotServer("auto",res=>{let data1={toname:toName,emailId:toEmail,userMessage:emailMessage,user_id:user_id,access_token:access_token,sid:res.insertedId};_this.makeServerRequest("POST","json",_this.api+"/screenshots/send-email",data1,res=>{_this.shareEmailResponseHandler(res)})})}else{let data2={toname:toName,emailId:toEmail,userMessage:emailMessage,user_id:user_id,access_token:access_token,sid:res[`${this.extPrefix}isScreenshotUploadedToServer`]};_this.makeServerRequest("POST","json",_this.api+"/screenshots/send-email",data2,res=>{_this.shareEmailResponseHandler(res)})}})});jQuery("#email-message").keyup(()=>{jQuery("#email-share-popup-wrapper .message-counter").text(300-jQuery("#email-message").val().length+" characters left")});jQuery(".close-email-share").unbind("click");jQuery(".close-email-share").on("click",()=>{jQuery("#email-share-popup-wrapper").remove();jQuery(".close-email-share").unbind("click")})};shareViaSocialMediaPopupButtons=(type,paths)=>{let _this=this;let path=paths;let sharehtml='<div class="share-facebook '+type+'"><img src="/images/facebook-icon.png" title="Facebook"></div>\n        <div class="share-Twitter '+type+'"><img src="/images/twitter-icon.png" title="X"></div>\n        <div class="share-linkedIn '+type+'"><img src="/images/linkedin-icon.png" title="LinkedIN"></div>\n        <div class="share-instagram '+type+'"><img src="/images/instagram-icon.png" title="Instagram"></div>\n        <div class="share-email '+type+'"><img src="/images/Email-icon.png" title="Email"></div>\n        <div class="share-qrCode '+type+'"><img src="/images/qr-code-icon.png" title="QR Code"></div>';document.querySelector(".social-share-form").innerHTML=sharehtml;jQuery("#social-share-popup-wrapper .loader-icon").hide();jQuery(".share-email").unbind("click");jQuery(".share-email").on("click",elem=>{jQuery("#link-share-popup-wrapper").remove();if(type==="video"){_this.shareVideoViaEmailPopup()}else{_this.shareViaEmail()}});jQuery(".share-qrCode").unbind("click");jQuery(".share-qrCode").on("click",elem=>{const fileURL=path;_this.shareQRCodePopup();QRCode.toDataURL(fileURL,function(err,url){if(err)console.error(err);var img=document.createElement("img");img.src=url;document.getElementById("qrcode-box").appendChild(img);jQuery("#qrcode-share-popup-wrapper").show()})});jQuery(".share-facebook.screenshot").unbind("click");jQuery(".share-facebook.screenshot").on("click",()=>{jQuery("#quix-popup-loader").show();new Promise((resolve,reject)=>{setTimeout(async()=>{await resolve(true)},1e3)}).then(()=>{jQuery("#link-share-popup-wrapper").remove();jQuery("#quix-popup-loader").hide();window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(path)}`,"facebookpopup","popup")})["catch"](err=>{jQuery("#quix-popup-loader").hide();jQuery("#link-share-popup-wrapper").remove();_this.failureMessagePopup("Share Failed","Some error in Our End")})});jQuery(".share-linkedIn.screenshot").unbind("click");jQuery(".share-linkedIn.screenshot").on("click",()=>{jQuery("#quix-popup-loader").show();new Promise((resolve,reject)=>{setTimeout(async()=>{await resolve(true)},1e3)}).then(()=>{const shareUrl=`https://www.linkedin.com/shareArticle?url=${encodeURIComponent(path)}`;window.open(shareUrl,"linkedInpopup","popup");jQuery("#quix-popup-loader").hide();jQuery("#link-share-popup-wrapper").remove()})["catch"](err=>{jQuery("#quix-popup-loader").hide();jQuery("#link-share-popup-wrapper").remove();_this.failureMessagePopup("Share Failed","Please try again")})});jQuery(".share-instagram").unbind("click");jQuery(".share-instagram").on("click",elem=>{jQuery("#quix-popup-loader").show();const imageURL=path;const videoURL=path;var filesArray;const shareImageAndVideo=async elem=>{try{const imageFile=await fetch(imageURL).then(response=>response.blob());const videoFile=await fetch(videoURL).then(response=>response.blob());if(jQuery(elem.currentTarget).hasClass("video")){if(videoURL){filesArray=[new File([videoFile],"video.mp4",{type:"video/mp4"})]}else{jQuery("#quix-popup-loader").hide();this.failureMessagePopup("Share failed","Please try again.");return}}else if(jQuery(elem.currentTarget).hasClass("screenshot")){if(imageURL){filesArray=[new File([imageFile],"image.png",{type:"image/png"})]}else{jQuery("#quix-popup-loader").hide();this.failureMessagePopup("Share failed","Please try again.");return}}if(filesArray){const shareData={files:filesArray};try{if(navigator.canShare&&navigator.canShare(shareData)){await navigator.share(shareData);jQuery("#quix-popup-loader").hide();jQuery("#link-share-popup-wrapper").remove()}else{jQuery("#quix-popup-loader").hide();_this.failureMessagePopup("Share Failed","Some error in Our End")}}catch(error){jQuery("#quix-popup-loader").hide();_this.failureMessagePopup("Share Failed","Some error in Our End")}}}catch(err){jQuery("#quix-popup-loader").hide();_this.failureMessagePopup("Share Failed","Some error in Our End")}};shareImageAndVideo(elem)});jQuery(".share-Twitter").css({opacity:"0.5"});jQuery(".share-Twitter").attr({title:"Coming soon"});jQuery(".share-Twitter").unbind("click");jQuery(".share-Twitter").on("click",elem=>{return;_this.create_oauth_twitter("share",data=>{const requestData={caption:"post data",access_token:data.access_token,access_token_secret:data.access_token_secret};let urlReq="";if(jQuery(elem.currentTarget).hasClass("video")){requestData.recording=path||"/upload/videos/sample-5s.mp4";urlReq=_this.api+"/share/video/twitter";_this.makeServerRequest("POST","json",urlReq,requestData,function(res){jQuery("#link-share-popup-wrapper").remove();if(res.status){jQuery("#quix-popup-loader").hide();_this.successMessagePopup("Shared Successfully","")}else{jQuery("#quix-popup-loader").hide();_this.failureMessagePopup("Share Failed","Some Error in our end while uploading...")}})}else{requestData.recording=path;urlReq=_this.api+"/share/screenshot/twitter";_this.makeServerRequest("POST","json",urlReq,requestData,function(res){jQuery("#quix-popup-loader").hide();jQuery("#link-share-popup-wrapper").remove();if(res.status){_this.successMessagePopup("Shared Successfully","")}else{jQuery("#quix-popup-loader").hide();_this.failureMessagePopup("Share Failed","Some Error in our end while uploading...")}})}})});jQuery(".share-facebook.video").css({opacity:"0.5"});jQuery(".share-facebook.video").attr({title:"Coming soon"});jQuery(".share-facebook.video").unbind("click");jQuery(".share-facebook.video").on("click",()=>{return;this.create_oauth_fb("share-video")});jQuery(".share-linkedIn.video").css({opacity:"0.5"});jQuery(".share-linkedIn.video").attr({title:"Coming soon"});jQuery(".share-linkedIn.video").unbind("click");jQuery(".share-linkedIn.video").on("click",()=>{return;const CLIENT_ID="77tqv2ubzatucy";const CLIENT_SECRET="zy6YV1Kcw0l2fjL6";const REDIRECT_URI=chrome.identity.getRedirectURL();const YOUR_STATE=Math.random().toString(36).substring(7);chrome.identity.launchWebAuthFlow({url:`https://www.linkedin.com/oauth/v2/authorization?response_type=code&state=987654321&scope=email w_member_social profile openid&client_id=77tqv2ubzatucy&redirect_uri=${REDIRECT_URI}`,interactive:true},token=>{const urlParams=new URLSearchParams(new URL(token).search);const code=urlParams.get("code");const state=urlParams.get("state");const urlencoded=new URLSearchParams;urlencoded.append("grant_type","authorization_code");urlencoded.append("code",code);urlencoded.append("redirect_uri",REDIRECT_URI);urlencoded.append("client_id",CLIENT_ID);urlencoded.append("client_secret",CLIENT_SECRET);const requestOptions={method:"POST",body:urlencoded,redirect:"follow"};fetch("https://www.linkedin.com/oauth/v2/accessToken",requestOptions).then(response=>response.json()).then(result=>{const myHeaders=new Headers;myHeaders.append("Authorization","Bearer"+result.access_token);myHeaders.append("X-Restli-Protocol-Version","2.0.0");myHeaders.append("Content-Type","application/json");myHeaders.append("Cookie",'lidc="b=TSR04:s=T:r=T:a=T:p=T:g=6:u=1:x=1:i=1709027182:t=1709113582:v=2:sig=AQHS2JEGigu2jsIYJ9iFj9apOCRevscM"; bcookie="v=2&1eff54b0-e8e1-4361-8b99-9dc3bc54a5b4"; lidc="b=VB98:s=V:r=V:a=V:p=V:g=3145:u=2:x=1:i=1708942516:t=1709028916:v=2:sig=AQGbz2sYVFSDZDPWuEpIeTT49j-pnTs0"');const raw=JSON.stringify({author:"urn:li:organization:2414183",lifecycleState:"PUBLISHED",specificContent:{"com.linkedin.ugc.ShareContent":{media:[{media:"urn:li:digitalmediaAsset:C5500AQG7r2u00ByWjw",status:"READY",title:{attributes:[],text:"Sample Video Create"}},{media:"https://screengenius.io/upload/screenshots/IMG_8768.jpg",status:"READY",title:{attributes:[],text:"Sample Image"}}],shareCommentary:{attributes:[],text:"Some share text"},shareMediaCategory:"VIDEO"}},targetAudience:{targetedEntities:[{geoLocations:["urn:li:geo:103644278"],seniorities:["urn:li:seniority:3"],industries:["urn:li:industry:4"]}]},visibility:{"com.linkedin.ugc.MemberNetworkVisibility":"PUBLIC"}});const requestOptions={method:"POST",headers:myHeaders,body:raw,redirect:"follow"};fetch("https://api.linkedin.com/v2/ugcPosts",requestOptions).then(response=>response.text()).then(result=>{})["catch"](error=>console.error(error))})["catch"](error=>console.error(error))});jQuery("#link-share-popup-wrapper").remove()})};shareQRCodePopup=()=>{let html='<div id="qrcode-share-popup-wrapper">\n        <div class="qrcode-share-popup">\n        <div class="qrcode-share-heading">\n        <span>Scan QR code</span>\n        </div>\n        <div class="qrcode-share-content">\n            <div id="qrcode-box"></div>\n        </div>\n        <div class="qrcode-share-submit">\n            <button class="close-qrcode-share">Close</button>\n        </div>\n        </div>\n        </div>';jQuery("body").append(html);jQuery(".close-qrcode-share").unbind("click");jQuery(".close-qrcode-share").on("click",function(){jQuery("#qrcode-share-popup-wrapper").remove();jQuery(".close-qrcode-share").unbind("click")})};shareVideoLinkPopup=()=>{let _this=this;let loaderIcon="/images/light-loader.gif";let sharelinkic="/images/quix-share-link-popup.png";jQuery("#link-share-popup-wrapper").remove();let html='<div id="link-share-popup-wrapper">\n        <div class="email-share-popup">\n        <div class="email-share-heading">\n        <img src="'+sharelinkic+'"/>\n        <span>Send through Social Platforms</span>\n        <div class="social-share-form">\n        </div>\n        <span>Share link with Anyone</span>\n        </div>\n        <div class="email-share-form">\n            <img class="loader-icon" src="'+loaderIcon+'"/>\n        </div>\n        </div>\n        </div>';chrome.storage.local.get(`${_this.extPrefix}quixyLoginUserData`,function(result){if(result[`${_this.extPrefix}quixyLoginUserData`]!==""&&result[`${_this.extPrefix}quixyLoginUserData`]!==null){_this.shareVideoLinkPopupHandler(result,html)}else{_this.openSignInpopup();_this.setIntervalRef=setInterval(()=>{chrome.storage.local.get(`${_this.extPrefix}quixyLoginUserData`,function(result){if(result[`${_this.extPrefix}quixyLoginUserData`]!==""&&result[`${_this.extPrefix}quixyLoginUserData`]!==null){clearInterval(_this.setIntervalRef);_this.shareVideoLinkPopupHandler(result,html)}})},500)}})};shareVideoLinkPopupHandler=(result,html)=>{let _this=this;let sessionData=result[`${_this.extPrefix}quixyLoginUserData`];jQuery("body").append(html);jQuery("#link-share-popup-wrapper .loader-icon").show();chrome.storage.local.get(`${_this.extPrefix}isVideoUploadedToServer`,function(res){const isVideoUploadedToServer=res[`${_this.extPrefix}isVideoUploadedToServer`];console.log(isVideoUploadedToServer,"sdfl");if(!isVideoUploadedToServer){_this.uploadVideoProcessHelper(result,html,sessionData)}else{let data={access_token:sessionData?.access_token,user_id:parseInt(sessionData.id),vid:res[`${extPrefix}isVideoUploadedToServer`]?.insertedId};helpers.makeServerRequest("POST","json",helpers.api+"/videos/exist",data,resp=>{if(resp.responseJSON){resp=resp.responseJSON}else{resp=resp}if(!resp.status){_this.uploadVideoProcessHelper(result,html,sessionData)}else{const requestData={user_id:parseInt(sessionData?.id),access_token:sessionData?.access_token};_this.makeServerRequest("POST","json",_this.api+"/videos/details?vid="+isVideoUploadedToServer.insertedId,requestData,function(res){if(res.responseJSON){jQuery("#link-share-popup-wrapper").remove();jQuery("#link-share-popup-wrapper .loader-icon").hide();res=res.responseJSON;_this.failureMessagePopup("Upload Failed",res.message);return}else{res=res}let path="";if(res.data.path){let parsedUrl=_this.removeDomainFromPath(_this.api,res.data.path);path=parsedUrl}_this.shareLinkResponseHandler(path);_this.shareViaSocialMediaPopupButtons("video",path)})}})}})};uploadVideoProcessHelper=(result,html,sessionData)=>{let _this=this;_this.addTitleAndSummaryPopup(function(itemTitle,itemSummary,tagIdList){let formd=new FormData;formd.append("name","test.webm");formd.append("user_id",parseInt(sessionData.id));formd.append("access_token",sessionData?.access_token);formd.append("file_size",recordedvideoSize);formd.append("file_duration",null);formd.append("recording",recordedVideoBlobData);formd.append("title",itemTitle);formd.append("summary",itemSummary);formd.append("tags",tagIdList);_this.makeServerRequest("POST","form-data",_this.api+"/videos/upload",formd,function(res){if(res.responseJSON){res=res.responseJSON}else{res=res}if(res.status){let data={[`${_this.extPrefix}isVideoUploadedToServer`]:res};chrome.storage.local.set(data,()=>{});let path="";if(res.path){let parsedUrl=_this.removeDomainFromPath(_this.api,res.path);path=parsedUrl}_this.shareLinkResponseHandler(path);_this.shareViaSocialMediaPopupButtons("video",path)}else{jQuery("#link-share-popup-wrapper").remove();jQuery("#link-share-popup-wrapper .loader-icon").hide();if(res.message=="You exceeded Limit."){_this.failureMessagePopup("Upload Failed","You have reached max upload limit.")}else{_this.failureMessagePopup("Upload Failed","Something Went Wrong.")}}})})};shareVideoViaEmailPopup=()=>{let _this=this;let loaderIcon="/images/light-loader.gif";let attachmentic="/images/quix-save.png";let shareemailic="/images/quix-share-link-popup.png";jQuery("#email-share-popup-wrapper").remove();let html='<div id="email-share-popup-wrapper">\n        <div class="email-share-popup">\n        <div class="email-share-heading">\n        <img src="'+shareemailic+'"/>\n        <span>Send through Email</span>\n        </div>\n        <div class="email-share-form">\n            <input type="text" name="to-name-feedback" placeholder="Enter Recipient Name*">\n            <input type="text" name="to-email" placeholder="Enter Recipient Email*"/>\n            <textarea id="email-message" placeholder="Message" maxlength ="300" name="email-message"></textarea>\n            <p class="message-counter"></p>\n            <div class="attachment-thumb" style="background-image:url('+attachmentic+');"><p>Video is attached.</p></div>\n        </div>\n        <div class="email-share-submit">\n            <img class="loader-icon" src="'+loaderIcon+'"/>\n            <button class="send-email-share">Send</button>\n            <button class="close-email-share">Close</button>\n        </div>\n        </div>\n        </div>';chrome.storage.local.get(`${this.extPrefix}quixyLoginUserData`,function(result){if(result[`${_this.extPrefix}quixyLoginUserData`]!==""&&result[`${_this.extPrefix}quixyLoginUserData`]!==null){_this.shareVideoViaEmailPopupHandler(result,html)}else{_this.openSignInpopup();_this.setIntervalRef=setInterval(()=>{chrome.storage.local.get(`${this.extPrefix}quixyLoginUserData`,function(result){if(result[`${_this.extPrefix}quixyLoginUserData`]!==""&&result[`${_this.extPrefix}quixyLoginUserData`]!==null){clearInterval(_this.setIntervalRef);_this.shareVideoViaEmailPopupHandler(result,html)}})},500)}})};shareVideoViaEmailPopupHandler=(result,html)=>{let _this=this;jQuery("body").append(html);jQuery(".send-email-share").unbind("click");jQuery(".send-email-share").on("click",function(){jQuery("#email-share-popup-wrapper .loader-icon").show();let toName=jQuery("input[name=to-name-feedback]").val();let toEmail=jQuery("#email-share-popup-wrapper input[name=to-email]").val();let emailMessage=jQuery("#email-share-popup-wrapper textarea[name=email-message]").val();if(toName==""){alert("Please enter your name.");jQuery(".loader-icon").hide();return}if(toEmail==""){alert("Please enter email Id.");jQuery("#email-share-popup-wrapper .loader-icon").hide();return}if(!_this.IsEmail(toEmail)){alert("Please enter correct email Id.");jQuery(".loader-icon").hide();return}let sessionData=result[`${_this.extPrefix}quixyLoginUserData`];let access_token=sessionData.access_token;let user_id=sessionData.id;chrome.storage.local.get(`${_this.extPrefix}isVideoUploadedToServer`,function(res){if(!res[`${_this.extPrefix}isVideoUploadedToServer`]){_this.addTitleAndSummaryPopup(function(itemTitle,itemSummary,tagIdList){let formd=new FormData;formd.append("name","test.webm");formd.append("user_id",parseInt(sessionData.id));formd.append("access_token",sessionData?.access_token);formd.append("file_size",recordedvideoSize);formd.append("file_duration",null);formd.append("recording",recordedVideoBlobData);formd.append("title",itemTitle);formd.append("summary",itemSummary);formd.append("tags",tagIdList);_this.makeServerRequest("POST","form-data",_this.api+"/videos/upload",formd,function(res){if(res.responseJSON){res=res.responseJSON}else{res=res}if(res.status){let data={[`${_this.extPrefix}isVideoUploadedToServer`]:res};chrome.storage.local.set(data,()=>{});let data3={toname:toName,emailId:toEmail,userMessage:emailMessage,user_id:user_id,access_token:access_token,vid:res.insertedId};_this.makeServerRequest("POST","json",_this.api+"/videos/send-email",data3,function(res){_this.shareEmailResponseHandler(res)})}else{jQuery("#email-share-popup-wrapper").remove();jQuery("#email-share-popup-wrapper .loader-icon").hide();if(res.message=="You exceeded Limit."){_this.failureMessagePopup("Upload Failed","You have reached max upload limit.")}else{_this.failureMessagePopup("Upload Failed","Something Went Wrong.")}}})})}else{let data4={toname:toName,emailId:toEmail,userMessage:emailMessage,user_id:user_id,access_token:access_token,vid:res[`${_this.extPrefix}isVideoUploadedToServer`].insertedId};_this.makeServerRequest("POST","json",_this.api+"/videos/send-email",data4,function(res){_this.shareEmailResponseHandler(res)})}})});jQuery("#email-message").keyup(function(){jQuery("#email-share-popup-wrapper .message-counter").text(300-jQuery(this).val().length+" characters left")});jQuery(".close-email-share").unbind("click");jQuery(".close-email-share").on("click",function(){jQuery("#email-share-popup-wrapper").remove();jQuery(".close-email-share").unbind("click")})};addTitleAndSummaryPopup=callback=>{let _this=this;let loaderIcon="/images/light-loader.gif";if(jQuery("#add-title-popup-wrapper")){jQuery("#add-title-popup-wrapper").remove()}let html='<div id="add-title-popup-wrapper">\n        <div class="add-title-popup">\n        <div class="add-title-heading">\n        <span>Add Title</span>\n        </div>\n        <div class="add-title-form">\n            <label for="title-tile">Add Title*</label>\n            <input type="text" id="title-tile" name="add-title" placeholder="Add Title*">\n            <span id=add-title-warning style="display:none; font-size:12px; color:red;">Please add a title.</span>\n             <label for="add-summary">Add Summary</label>\n            <textarea id="add-summary" placeholder="Add Summary" maxlength ="300" name="add-summary"></textarea>\n            <label for="tag-search">Add Tags</label>\n            <div class="tagging-system">\n                <input type="text" id="tag-search" placeholder="Search and add a tag" autocomplete="off"/>\n                <ul id="tag-dropdown" class="dropdown">\n                    \x3c!-- Search results will appear here --\x3e\n                </ul>\n                <div class="tags-container" id="tags-container">\n                    \x3c!-- Tags will appear here --\x3e\n                </div>\n            </div>\n            <div class="add-custom-tag">\n                <label for="add-custom-tag-input" class="add-custom-tag-label">Add Custom Tag</label>\n                <div class="add-custom-tag-form">\n                    <input type="text" name="summary" placeholder="add custom tag" value="" id="add-custom-tag-input">\n                    <button class="btn add-custom-tag-btn">Add custom</button>\n                </div>\n            </div>\n        </div>\n        <div class="add-title-submit">\n            <img class="loader-icon" src="'+loaderIcon+'"/>\n            <button class="send-add-title">Save</button>\n            <button class="close-add-title">Skip</button>\n        </div>\n        </div>\n        </div>';chrome.storage.local.get(`${_this.extPrefix}quixyLoginUserData`,result=>{let loginUserData=result[`${_this.extPrefix}quixyLoginUserData`];jQuery("body").append(html);_this.addTitleAndSummaryPopupHandle(loginUserData);jQuery(".send-add-title").unbind("click");jQuery(".send-add-title").on("click",function(){var itemTitle=jQuery("input[name='add-title']").val().trim();if(!itemTitle){jQuery("#add-title-warning").show();return}var itemSummary=jQuery("textarea[name='add-summary']").val();var itemTags=jQuery("#tags-container div");let tagIdList=[];for(let i=0;i<itemTags.length;i++){var tagName=jQuery(itemTags[i]).attr("data-tag");let tagId=_this.getTagID(tagName,_this.tagsList);tagIdList.push(tagId)}tagIdList=tagIdList.toString();if(!itemTitle)itemTitle=null;if(!itemSummary)itemSummary=null;if(!tagIdList)tagIdList=null;callback(itemTitle,itemSummary,tagIdList);jQuery("#add-title-popup-wrapper").remove();jQuery("#add-title-popup-wrapper .loader-icon").hide()});jQuery(".close-add-title").unbind("click");jQuery(".close-add-title").on("click",function(){callback(null,null,null);jQuery("#add-title-popup-wrapper").remove();jQuery("#add-title-popup-wrapper .loader-icon").hide();jQuery(".close-add-title").unbind("click")})})};getTagID=(tagName,array)=>{const environmentObject=array.find(item=>item.name.toLowerCase()===tagName.toLowerCase());const environmentId=environmentObject?environmentObject.id:null;return environmentId};addTitleAndSummaryPopupHandle=loginUserData=>{let _this=this;let userTags=[];if(loginUserData.tags){userTags=loginUserData.tags}_this.tagsList=loginUserData.tags;const tagsSys=document.querySelector(".tagging-system");const tagsContainer=document.getElementById("tags-container");const tagSearch=document.getElementById("tag-search");const tagDropdown=document.getElementById("tag-dropdown");let availableTags=userTags.map(tag=>tag.name.toLowerCase());let filteredTags=[...availableTags];tagSearch.addEventListener("input",function(){const searchValue=tagSearch.value.toLowerCase();filteredTags=availableTags.filter(tag=>tag.includes(searchValue)&&!isTagSelected(tag));renderDropdown()});tagSearch.addEventListener("focus",function(){filteredTags=availableTags.filter(tag=>!isTagSelected(tag));renderDropdown()});const myElement=document.getElementById("myElement");document.body.addEventListener("click",event=>{if(!tagsSys.contains(event.target)){hideDropdown()}});jQuery(".add-custom-tag-btn").unbind("click");jQuery(".add-custom-tag-btn").on("click",function(){var name=jQuery(".add-custom-tag-form input").val();if(name!==""){const requestData={user_id:parseInt(loginUserData.id),access_token:loginUserData?.access_token,name:name};_this.makeServerRequest("POST","json",_this.api+"/tag/add",requestData,res=>{if(res.data){let tagID=res.data.id;addTag(name);availableTags.push(name);_this.tagsList.push({adminTag:false,id:tagID,name:name});jQuery(".add-custom-tag-form input").val("")}})}else{alert("Please add a tag name.")}});tagDropdown.addEventListener("click",function(event){if(event.target.tagName==="LI"){addTag(event.target.textContent);tagSearch.value="";filteredTags=availableTags.filter(tag=>!isTagSelected(tag));hideDropdown()}});tagsContainer.addEventListener("click",function(event){if(event.target.tagName==="BUTTON"){removeTag(event.target.parentElement);filteredTags=availableTags.filter(tag=>!isTagSelected(tag))}});function addTag(tag){if(isTagSelected(tag))return;const tagElement=document.createElement("div");tagElement.classList.add("tag");tagElement.dataset.tag=tag;const tagText=document.createElement("span");tagText.textContent=`#${tag}`;const removeButton=document.createElement("button");removeButton.textContent="x";tagElement.appendChild(tagText);tagElement.appendChild(removeButton);tagsContainer.appendChild(tagElement)}function removeTag(tagElement){tagsContainer.removeChild(tagElement)}function isTagSelected(tag){return Array.from(tagsContainer.children).some(tagElement=>tagElement.dataset.tag===tag)}function renderDropdown(){tagDropdown.innerHTML="";if(filteredTags.length>0){tagDropdown.style.display="block";filteredTags.forEach(tag=>{const li=document.createElement("li");li.textContent=tag;tagDropdown.appendChild(li)})}else{tagDropdown.style.display="none"}}function hideDropdown(){tagDropdown.style.display="none"}};shareEmailResponseHandler=res=>{let _this=this;if(res.status){jQuery("#email-share-popup-wrapper").remove();jQuery(".close-email-share").unbind("click");_this.successMessagePopup("Email Shared Successfully","Email has been shared successfully.")}else{jQuery("#email-share-popup-wrapper").remove();jQuery("#email-share-popup-wrapper .loader-icon").hide();_this.failureMessagePopup("Email Sharing Failed","Email couldn't be sent.")}};shareLinkPopup=()=>{let _this=this;let loaderIcon="/images/light-loader.gif";let sharelinkic="/images/quix-share-link-popup.png";jQuery("#link-share-popup-wrapper").remove();let html='<div id="link-share-popup-wrapper">\n        <div class="email-share-popup">\n        <div class="email-share-heading">\n        <img src="'+sharelinkic+'"/>\n        <span>Send through Social Platforms</span>\n        <div class="social-share-form">\n        </div>\n        <span>Share link with Anyone</span>\n        </div>\n        <div class="email-share-form">\n            <img class="loader-icon" src="'+loaderIcon+'"/>\n        </div>\n        </div>\n        </div>';let canvas=document.getElementById("padding-screen");chrome.storage.local.get(`${this.extPrefix}quixyLoginUserData`,result=>{if(result[`${this.extPrefix}quixyLoginUserData`]!==""&&result[`${this.extPrefix}quixyLoginUserData`]!==null){_this.shareLinkPopupHandler(result,html)}else{_this.openSignInpopup();_this.setIntervalRef=setInterval(()=>{chrome.storage.local.get(`${this.extPrefix}quixyLoginUserData`,result=>{if(result[`${this.extPrefix}quixyLoginUserData`]!==""&&result[`${this.extPrefix}quixyLoginUserData`]!==null){clearInterval(this.setIntervalRef);_this.shareLinkPopupHandler(result,html)}})},500)}})};shareLinkPopupHandler=(result,html)=>{let _this=this;let sessionData=result[`${this.extPrefix}quixyLoginUserData`];jQuery("body").append(html);jQuery("#link-share-popup-wrapper .loader-icon").show();chrome.storage.local.get(`${this.extPrefix}isScreenshotUploadedToServer`,res=>{if(!res[`${this.extPrefix}isScreenshotUploadedToServer`]){uploadScreenshotServer("auto",res=>{let path="";if(res.path){let parsedUrl=_this.removeDomainFromPath(_this.api,res.path);path=parsedUrl}_this.shareLinkResponseHandler(path);_this.shareViaSocialMediaPopupButtons("screenshot",path)})}else{console.log(res,"p----");let data={access_token:sessionData?.access_token,user_id:parseInt(sessionData.id),sid:res[`${extPrefix}isScreenshotUploadedToServer`]};helpers.makeServerRequest("POST","json",helpers.api+"/screenshots/exist",data,resp=>{if(resp.responseJSON){resp=resp.responseJSON}else{resp=resp}if(!resp.status){uploadScreenshotServer("auto",res=>{let path="";if(res.path){let parsedUrl=_this.removeDomainFromPath(_this.api,res.path);path=parsedUrl}_this.shareLinkResponseHandler(path);_this.shareViaSocialMediaPopupButtons("screenshot",path)})}else{const requestData={user_id:parseInt(sessionData.id),access_token:sessionData?.access_token};_this.makeServerRequest("POST","json",_this.api+"/screenshots/details?sid="+res[`${this.extPrefix}isScreenshotUploadedToServer`],requestData,res=>{let path="";if(!res.data){_this.failureMessagePopup("Share Failed","Something Went wrong.")}if(res.data.path){let parsedUrl=_this.removeDomainFromPath(_this.api,res.data.path);path=parsedUrl}_this.shareLinkResponseHandler(path);_this.shareViaSocialMediaPopupButtons("screenshot",path)})}})}})};shareLinkResponseHandler=path=>{let _this=this;if(path!==""){let mHTML='<input value="'+path+'" type="text" name="share-Link" id="share-screenshot-link"/><button class="send-link-share">Copy</button><button class="close-link-share">Close</button>';jQuery("#link-share-popup-wrapper .email-share-form").html(mHTML);jQuery(".send-link-share").unbind("click");jQuery(".send-link-share").on("click",()=>{jQuery("#share-screenshot-link").select();navigator.clipboard.writeText(jQuery("#share-screenshot-link").val());jQuery(".send-link-share").unbind("click");jQuery("#link-share-popup-wrapper").remove();_this.successMessagePopup("Link copied Successfully","Share link has been copied successfully.")});jQuery(".close-link-share").unbind("click");jQuery(".close-link-share").on("click",()=>{jQuery("#link-share-popup-wrapper").remove();jQuery(".close-link-share").unbind("click")})}else{jQuery("#link-share-popup-wrapper").remove();jQuery("#link-share-popup-wrapper .loader-icon").hide();_this.failureMessagePopup("Share Link Failed","Share link couldn't be copied.")}};successMessagePopup=(text,description)=>{let _this=this;if(_this.successIcon===""){_this.successIcon="/images/quix-success.png"}let padTop="40px";let html='<div id="'+_this.extPrefix+'success-popup-wrapper">\n        <div class="'+_this.extPrefix+'success-popup">\n        <div class="'+_this.extPrefix+'success-heading" style="padding-top: '+padTop+';">\n        <img src="'+_this.successIcon+'" style="margin: auto;"/>\n        <span class="'+_this.extPrefix+'success-message">'+text+'</span>\n        <span class="'+_this.extPrefix+'success-description">'+description+"</span>\n        </div>\n        </div>\n        </div>";jQuery("body").append(html);setTimeout(()=>{jQuery("#"+_this.extPrefix+"success-popup-wrapper").remove()},3e3)};failureMessagePopup=(text,description)=>{let _this=this;if(_this.failureIcon===""){_this.failureIcon="/images/quix-failure.png"}let padTop="40px";let html='<div id="'+_this.extPrefix+'failure-popup-wrapper">\n        <div class="'+_this.extPrefix+'failure-popup">\n        <div class="'+_this.extPrefix+'failure-heading" style="padding-top: '+padTop+';">\n        <img src="'+_this.failureIcon+'" style="margin: auto;"/>\n        <span class="'+_this.extPrefix+'failure-message">'+text+'</span>\n        <span class="'+_this.extPrefix+'failure-description">'+description+"</span>\n        </div>\n        </div>\n        </div>";jQuery("body").append(html);setTimeout(()=>{jQuery("#"+_this.extPrefix+"failure-popup-wrapper").remove()},3e3)};shareFeedbackPopup=()=>{let _this=this;if(_this.loaderIcon===""){_this.loaderIcon="/images/light-loader.gif"}if(_this.feedbackIcon===""){_this.feedbackIcon="/images/quix-share-feedback-form.png"}let html='<div id="'+_this.extPrefix+'feedback-share-popup-wrapper">\n        <div class="'+_this.extPrefix+'feedback-share-popup">\n        <div class="'+_this.extPrefix+'feedback-share-heading">\n        <img src="'+_this.feedbackIcon+'"/>\n        <span>Share your feedback with us</span>\n        </div>\n        <div id="'+_this.extPrefix+'share-feedback-form" class="'+_this.extPrefix+'email-share-form">\n            <input type="text" name="to-email-feedback" placeholder="Enter Your Email">\n            <textarea id="'+_this.extPrefix+'email-message-feedback" placeholder="Enter Your Feedback" maxlength="900" name="email-message-feedback"></textarea>\n            <p class="'+_this.extPrefix+'message-counter"></p>\n        </div>\n        <div class="'+_this.extPrefix+'feedback-share-submit">\n            <img class="loader-icon" src="'+_this.loaderIcon+'" style="display: none;">\n            <button class="'+_this.extPrefix+'send-feedback-share">Send</button>\n            <button class="'+_this.extPrefix+'close-feedback-share">Close</button>\n        </div>\n        </div>\n        </div>';jQuery("body").append(html);chrome.storage.local.get(`${_this.extPrefix}quixyLoginUserData`,function(result){const sessionData=result[`${_this.extPrefix}quixyLoginUserData`];if(sessionData){document.querySelector("#"+_this.extPrefix+"share-feedback-form input[name='to-email-feedback']").value=sessionData.email}});jQuery("."+_this.extPrefix+"send-feedback-share").unbind("click");jQuery("."+_this.extPrefix+"send-feedback-share").on("click",()=>{jQuery(".loader-icon").show();let senderEmail=jQuery("input[name=to-email-feedback]").val();let emailMessage=jQuery("textarea[name=email-message-feedback]").val();if(senderEmail==""){alert("Please enter email Id.");jQuery(".loader-icon").hide();return}if(emailMessage==""){alert("Please enter your message.");jQuery(".loader-icon").hide();return}if(!_this.IsEmail(senderEmail)){alert("Please enter correct email Id.");jQuery(".loader-icon").hide();return}let data5={senderEmail:senderEmail,userMessage:emailMessage};_this.makeServerRequest("POST","json",_this.api+"/screenshots/send-feedback",data5,res=>{_this.sharefeedbackResponseHandler(res)})});jQuery("#"+_this.extPrefix+"email-message-feedback").keyup(()=>{jQuery("#"+_this.extPrefix+"feedback-share-popup-wrapper ."+_this.extPrefix+"message-counter").text(900-jQuery("#"+_this.extPrefix+"email-message-feedback").val().length+" characters left")});jQuery("."+_this.extPrefix+"close-feedback-share").unbind("click");jQuery("."+_this.extPrefix+"close-feedback-share").on("click",()=>{jQuery("#"+_this.extPrefix+"feedback-share-popup-wrapper").remove();jQuery("."+_this.extPrefix+"close-feedback-share").unbind("click")})};sharefeedbackResponseHandler=res=>{let _this=this;if(res.status){jQuery("#"+_this.extPrefix+"feedback-share-popup-wrapper").remove();jQuery("."+_this.extPrefix+"close-feedback-share").unbind("click");_this.successMessagePopup("Email Shared Successfully","Email has been shared successfully.")}else{jQuery("#"+_this.extPrefix+"feedback-share-popup-wrapper .loader-icon").hide();_this.failureMessagePopup("Email Sharing Failed","Email couldn't be sent.")}};shareLoginPopup=()=>{let _this=this;if(document.querySelector("#login-share-popup-wrapper")){document.querySelector("#login-share-popup-wrapper").remove()}let html='<div id="login-share-popup-wrapper">\n                        <div class="login-share-popup">\n                            <div class="login-share-heading">\n                                <img class="login-close-popup" src="'+_this.closeIcon+'"/>\n                                <img class="login-popup-logo-icon" src="'+_this.logo+'"/>\n                                <h3>Welcome to Vizam</h3>\n                                <h4>To get started, please sign in</h4>\n                            </div>\n                            <div class="login-button-wrapper">\n                                <div class="login-google"><img src="'+_this.googleicon+'" title="Google"></div>\n                                <div class="login-facebook"><img src="'+_this.fbicon+'" title="Facebook"></div>\n                                <div class="login-Twitter"><img src="'+_this.twittericon+'" title="X"></div>\n                                <div class="login-linkedIn"><img src="'+_this.linkedinicon+'" title="LinkedIN"></div>\n                            </div>\n                        </div>\n                    </div>';jQuery("body").append(html);document.querySelector(".login-close-popup").addEventListener("click",()=>{document.querySelector("#login-share-popup-wrapper").remove();if(this.setIntervalRef){clearInterval(this.setIntervalRef)}});document.querySelector(".login-button-wrapper .login-google").addEventListener("click",()=>{document.querySelector("#login-share-popup-wrapper").remove();this.handleGoogleLogin()});document.querySelector(".login-button-wrapper .login-facebook").addEventListener("click",()=>{document.querySelector("#login-share-popup-wrapper").remove();this.create_oauth_fb("oauth")});document.querySelector(".login-button-wrapper .login-Twitter").style.opacity="0.5";document.querySelector(".login-button-wrapper .login-Twitter").setAttribute("title","Coming Soon");document.querySelector(".login-button-wrapper .login-Twitter").addEventListener("click",elem=>{return;document.querySelector("#login-share-popup-wrapper").remove();this.create_oauth_twitter("oauth",data=>{jQuery("#quix-popup-loader").hide();const requestData={caption:"post data",access_token:data.access_token,access_token_secret:data.access_token_secret};let urlReq="";urlReq=_this.api+"/share/video/TwitterAuth";_this.makeServerRequest("POST","json",urlReq,requestData,function(res){if(res.status){_this.handleQuixyLogIn(res.data)}else{jQuery("#quix-popup-loader").hide();_this.failureMessagePopup("Authentication Failed","Some Error in our end while uploading...")}})})});document.querySelector(".login-button-wrapper .login-linkedIn").addEventListener("click",()=>{document.querySelector("#login-share-popup-wrapper").remove();_this.create_oauth_LinkedIn("oauth")})};handleQuixyLogOut=()=>{let _this=this;jQuery("#quix-popup-loader").show();chrome.storage.local.get(`${this.extPrefix}quixyLoginUserData`,result=>{if(result[`${this.extPrefix}quixyLoginUserData`]!==""&&result[`${this.extPrefix}quixyLoginUserData`]!==null){let data12={user_id:result[`${this.extPrefix}quixyLoginUserData`].id,access_token:result[`${this.extPrefix}quixyLoginUserData`].access_token,token_type:"extension"};_this.makeServerRequest("POST","",_this.api+"/user/logout",JSON.stringify(data12),res=>{jQuery("#quix-popup-loader").hide();jQuery(".loggedin-item").hide();jQuery(".loggedOut-item").show();let data6={[`${this.extPrefix}quixyLoginUserData`]:null};chrome.storage.local.set(data6,()=>{});chrome.runtime.sendMessage({type:"quixyDashboardLogout"})})}})};handleQuixyLogIn=(data,callback)=>{let _this=this;let email=data.email;let name=data.name;let pic=data.picture;let password=data.password;let data7={email:email,name:name,picture:pic,password:password,token_type:"extension"};_this.makeServerRequest("POST","json",_this.api+"/user/login",data7,res=>{jQuery("#quix-popup-loader").hide();if(callback&&callback!==null&&callback!==undefined){callback(res)}else{_this.handleUserSession(res,"login")}})};handleGoogleLogin=()=>{let _this=this;jQuery("#quix-popup-loader").show();if(chrome.identity){chrome.identity.launchWebAuthFlow({url:_this.create_oauth(),interactive:true},token=>{if(token){let tokenStr=token.split("access_token=");let tokenStr1=tokenStr[1].split("token_type=");let fToken=tokenStr1[0];jQuery.ajax({url:"https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token="+fToken,success:result=>{_this.handleQuixyLogIn(result)}})}else{jQuery("#quix-popup-loader").hide();if(_this.setIntervalRef){clearInterval(_this.setIntervalRef)}this.failureMessagePopup("Authentication Failed","Some Error in our end")}})}else{jQuery("#quix-popup-loader").hide();this.failureMessagePopup("Authentication Failed","Some Error in our end")}};handleUserSession=(res,type)=>{let _this=this;if(res.status){let data8={[`${this.extPrefix}quixyLoginUserData`]:res.data};chrome.storage.local.set(data8,()=>{});jQuery(".loggedin-item").show();jQuery(".loggedOut-item").hide();_this.handleUserSettings(res.data)}else{let data9={[`${this.extPrefix}quixyLoginUserData`]:null};chrome.storage.local.set(data9,()=>{});jQuery(".loggedin-item").hide();jQuery(".loggedOut-item").show()}};handleUserSettings=data=>{if(data.pricing_plan){let settings=data.pricing_plan.features;settings=JSON.parse(settings);if(settings.Download&&settings.Download.status){this.downloadFormats=settings.Download.formats}if(settings.Gradient){this.gradientAvailable=settings.Gradient.status}if(settings.Integrations){this.integrationsAvailable=settings.Integrations.status}if(settings.Recovery){this.recoveryAvailable=settings.Recovery.status}if(settings.Resolution&&settings.Resolution.status){this.resolutions=settings.Resolution.resolutions}if(settings.Unlimited&&settings.Unlimited.screenshots&&settings.Unlimited.videos){this.unlimitedVideos=settings.Unlimited.videos;this.unlimitedScreenshots=settings.Unlimited.screenshots}if(settings.UnlimitedLength&&settings.UnlimitedLength.status){this.videoLength=settings.UnlimitedLength.length;if(this.videoLength>0){this.limitStopStr=""}else{this.limitStopStr="05:00"}}if(settings.UserManagement){this.userManagement=settings.UserManagement.status}}};dataURItoBlob=(blobUrl,callback)=>{let _this=this;let xhr=new XMLHttpRequest;xhr.responseType="blob";xhr.onload=()=>{let recoveredBlob=xhr.response;callback(recoveredBlob)};xhr.open("GET",blobUrl);xhr.send()};formatBytes=(bytes,decimals=2)=>{let _this=this;if(!+bytes)return"0 Bytes";const k=1024;const dm=decimals<0?0:decimals;const sizes=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"];const i=Math.floor(Math.log(bytes)/Math.log(k));return`${parseFloat((bytes/Math.pow(k,i)).toFixed(dm))} ${sizes[i]}`};getImageSize=base64String=>{let _this=this;let stringLength=base64String.length-"data:image/png;base64,".length;let sizeInBytes=4*Math.ceil(stringLength/3)*.5624896334383812;return sizeInBytes};getTodayDate=()=>{let _this=this;let today=new Date;let dd=String(today.getDate()).padStart(2,"0");let mm=String(today.getMonth()+1).padStart(2,"0");let yyyy=today.getFullYear();today=dd+"."+mm+"."+yyyy;return today};makeServerRequest=(type,dataType,url,data,callback)=>{let _this=this;let contentType="application/json";if(dataType=="json"){data=JSON.stringify(data)}else if(dataType=="form-data"){contentType=false}jQuery.ajax({url:url,type:type,contentType:contentType,cache:false,processData:false,success:data=>{callback(data)},error:error=>{callback(error)},data:data})};openSignInpopup=()=>{jQuery("#quix-popup-loader").hide();jQuery("#quix-signin-wrapper").show()};closeSignInpopup=()=>{if(this.setIntervalRef){clearInterval(this.setIntervalRef)}jQuery("#quix-signin-wrapper").hide()};closeUpdateAccountInpopup=()=>{jQuery("#quix-update-account-wrapper").hide()};openDashboard=page=>{let _this=this;chrome.storage.local.get(`${this.extPrefix}quixyLoginUserData`,result=>{if(result[`${this.extPrefix}quixyLoginUserData`]!==""&&result[`${this.extPrefix}quixyLoginUserData`]!==null){window.open(this.dashboard+"/dashboard#"+page,"_blank")}else{_this.openSignInpopup();_this.setIntervalRef=setInterval(()=>{chrome.storage.local.get(`${this.extPrefix}quixyLoginUserData`,result=>{if(result[`${this.extPrefix}quixyLoginUserData`]!==""&&result[`${this.extPrefix}quixyLoginUserData`]!==null){clearInterval(_this.setIntervalRef);window.open(this.dashboard+"/dashboard#"+page,"_blank")}})},500)}})};create_oauth=()=>{let _this=this;let auth_url=`https://accounts.google.com/o/oauth2/v2/auth?`;let auth_params={client_id:_this.driveNyoutubeClientID,redirect_uri:chrome.identity.getRedirectURL(),response_type:"token",scope:"https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile openid",prompt:"select_account"};const url=new URLSearchParams(Object.entries(auth_params));url.toString();auth_url+=url;return auth_url};create_oauth_drive=()=>{let _this=this;let auth_url=`https://accounts.google.com/o/oauth2/v2/auth?`;let auth_params={client_id:_this.driveNyoutubeClientID,redirect_uri:chrome.identity.getRedirectURL(),response_type:"token",scope:"https://www.googleapis.com/auth/drive",prompt:"select_account"};const url=new URLSearchParams(Object.entries(auth_params));url.toString();auth_url+=url;return auth_url};create_oauth_yt=()=>{let _this=this;let auth_url=`https://accounts.google.com/o/oauth2/v2/auth?`;let auth_params={client_id:_this.driveNyoutubeClientID,redirect_uri:chrome.identity.getRedirectURL(),response_type:"token",scope:"https://www.googleapis.com/auth/youtube.upload",prompt:"select_account"};const url=new URLSearchParams(Object.entries(auth_params));url.toString();auth_url+=url;return auth_url};create_oauth_fb=type=>{jQuery("#quix-popup-loader").show();let _this=this;const CLIENT_ID=_this.fbClientID;const REDIRECT_URI=chrome.identity.getRedirectURL();const YOUR_STATE=Math.random().toString(36).substring(7);chrome.identity.launchWebAuthFlow({url:`https://www.facebook.com/v19.0/dialog/oauth?client_id=${CLIENT_ID}&redirect_uri=${REDIRECT_URI}&state=${YOUR_STATE}`,interactive:true},token=>{if(token==undefined||token==null||token==""){jQuery("#quix-popup-loader").hide();if(_this.setIntervalRef){clearInterval(_this.setIntervalRef)}_this.failureMessagePopup("Something went wrong","Some error in Our End");return}const extractDataFromRedirectUrl=token=>{const urlParams=new URLSearchParams(token.split("?")[1]);const code=urlParams.get("code");const state=urlParams.get("state");return{code:code,state:state}};const{code,state}=extractDataFromRedirectUrl(token);let data={code:code,redirect_uri:REDIRECT_URI};this.shareToFacebook(type,data)})};shareToFacebook=(type,data)=>{let _this=this;let urlReq="";urlReq=_this.api+"/share/video/facebook";this.makeServerRequest("POST","json",urlReq,data,function(res){if(!res.access_token){if(type==="share-video"||type==="oauth"){jQuery("#social-share-popup-wrapper").remove();jQuery("#quix-popup-loader").hide();if(_this.setIntervalRef){clearInterval(_this.setIntervalRef)}_this.failureMessagePopup("Some thing went wrong","Please try again")}else if(type=="oauthPopup"){chrome.runtime.sendMessage({type:"quixyLoginFailedBackground"})}return false}if(type==="share-video"){return false;if(res.status){jQuery("#social-share-popup-wrapper").remove();jQuery("#quix-popup-loader").hide();_this.successMessagePopup("Shared Successfully","")}else{jQuery("#quix-popup-loader").hide();_this.failureMessagePopup("Share Failed","Some error in Our End")}}else if(type==="oauth"){jQuery.ajax({url:"https://graph.facebook.com/v12.0/me?fields=name,email&access_token="+res.access_token,success:result=>{jQuery("#quix-popup-loader").hide();_this.handleQuixyLogIn(result);return true},error:(xhr,status,error)=>{jQuery("#quix-popup-loader").hide();if(_this.setIntervalRef){clearInterval(_this.setIntervalRef)}_this.failureMessagePopup("Login Failed","Some error in Our End");return false}})}else if(type=="oauthPopup"){jQuery.ajax({url:"https://graph.facebook.com/v12.0/me?fields=name,email&access_token="+res.access_token,success:result=>{chrome.runtime.sendMessage({type:"quixyGotoQuixyLoginFacebookResponse2",res:result});return true},error:(xhr,status,error)=>{chrome.runtime.sendMessage({type:"quixyLoginFailedBackground"});return false}})}})};create_oauth_twitter=(type,callback)=>{let _this=this;try{jQuery("#quix-popup-loader").show();let formd=new FormData;let urlReq="";urlReq=_this.api+"/share/video/reqTokenTwitter";this.makeServerRequest("POST","form-data",urlReq,formd,function(res){if(res.data==undefined||res.data==null||!res.data.oauth_token){if(type=="oauthPopup"){chrome.runtime.sendMessage({type:"quixyLoginFailedBackground"})}else{jQuery("#quix-popup-loader").hide();if(_this.setIntervalRef){clearInterval(_this.setIntervalRef)}_this.failureMessagePopup("Something went wrong","Please try again")}return}let oauth_token=res.data.oauth_token;let oauth_token_secret=res.data.oauth_token_secret;let oauth_callback_confirmed=res.data.oauth_callback_confirmed;if(oauth_token){if(type=="share"||type=="oauth"){_this.oauth_twitter_access_token(type,callback,oauth_token)}else if(type=="oauthPopup"){chrome.runtime.sendMessage({type:"quixyGotoQuixyLoginTwitterResponse",oauthToken:oauth_token,tabId:callback})}else{jQuery("#quix-popup-loader").hide();if(_this.setIntervalRef){clearInterval(_this.setIntervalRef)}_this.failureMessagePopup("Something Went Wrong","Sorry For Inconvinence we are trying our best")}}else{if(type!=="oauthPopup"){jQuery("#quix-popup-loader").hide();_this.failureMessagePopup("Something Went Wrong","Sorry For Inconvinence we are trying our best")}else{chrome.runtime.sendMessage({type:"quixyLoginFailedBackground"})}}})}catch(error){if(type=="oauthPopup"){chrome.runtime.sendMessage({type:"quixyLoginFailedBackground"})}else{jQuery("#quix-popup-loader").hide();this.failureMessagePopup("Something Went Wrong","Sorry For Inconvinence we are trying our best")}}};oauth_twitter_access_token=(type,callback,oauth_token)=>{let _this=this;try{chrome.identity.launchWebAuthFlow({url:`https://api.twitter.com/oauth/authorize?oauth_token=${oauth_token}`,interactive:true},token=>{if(token==undefined){jQuery("#quix-popup-loader").hide();if(_this.setIntervalRef){clearInterval(_this.setIntervalRef)}_this.failureMessagePopup("Something Went Wrong","Please give permision to Authorize")}else{const params=new URLSearchParams(new URL(token).search);const oauthToken=params.get("oauth_token");var oauthVerifier=params.get("oauth_verifier");var oauth_callback_confirmed=params.get("oauth_callback_confirmed");let urlReq="";const requestData={caption:"post data",oauthToken:oauthToken,oauthVerifier:oauthVerifier};urlReq=_this.api+"/share/video/accessTokenTwitter";_this.makeServerRequest("POST","json",urlReq,requestData,function(res){if(res.status){callback(res.data)}else{jQuery("#quix-popup-loader").hide();if(_this.setIntervalRef){clearInterval(_this.setIntervalRef)}_this.failureMessagePopup("Authentication Failed","Some Error in our end.")}})}})}catch(error){if(type=="oauthPopup"){chrome.runtime.sendMessage({type:"quixyLoginFailedBackground"})}else{jQuery("#quix-popup-loader").hide();if(_this.setIntervalRef){clearInterval(_this.setIntervalRef)}_this.failureMessagePopup("Authentication Failed","Some Error in our end.")}}};create_oauth_LinkedIn=type=>{let _this=this;jQuery("#quix-popup-loader").show();const authData={CLIENT_ID:"770lg3auun6mvh",CLIENT_SECRET:"46LgxOUjQZmrVp6S",REDIRECT_URI:chrome.identity.getRedirectURL(),YOUR_STATE:Math.random().toString(36).substring(7)};try{chrome.identity.launchWebAuthFlow({url:`https://www.linkedin.com/oauth/v2/authorization?response_type=code&state=${authData.YOUR_STATE}&scope=email w_member_social profile openid&client_id=${authData.CLIENT_ID}&redirect_uri=${authData.REDIRECT_URI}`,interactive:true},token=>{if(token){this.oauth_LinkedIn_Access_Token(token,authData,"screen")}else{jQuery("#quix-popup-loader").hide();if(_this.setIntervalRef){clearInterval(_this.setIntervalRef)}_this.failureMessagePopup("Authentication Failed","Please try again")}})}catch(error){if(_this.setIntervalRef){clearInterval(_this.setIntervalRef)}_this.failureMessagePopup("Authentication Failed","Please try again")}};oauth_LinkedIn_Access_Token=(token,authData,type,tabId)=>{let _this=this;if(token){try{const urlParams=new URLSearchParams(new URL(token).search);const code=urlParams.get("code");const state=urlParams.get("state");const urlencoded=new URLSearchParams;urlencoded.append("grant_type","authorization_code");urlencoded.append("code",code);urlencoded.append("redirect_uri",authData.REDIRECT_URI);urlencoded.append("client_id",authData.CLIENT_ID);urlencoded.append("client_secret",authData.CLIENT_SECRET);const requestOptions={method:"POST",body:urlencoded,redirect:"follow"};fetch("https://www.linkedin.com/oauth/v2/accessToken",requestOptions).then(response=>response.json()).then(result=>{if(result.access_token){if(type=="screen"){const myHeaders=new Headers;myHeaders.append("Authorization","Bearer "+result.access_token);myHeaders.append("X-Restli-Protocol-Version","2.0.0");const requestOptions={method:"GET",headers:myHeaders,redirect:"follow"};fetch("https://api.linkedin.com/v2/userinfo",requestOptions).then(response=>{if(response.ok){return response.json()}else{jQuery("#quix-popup-loader").hide();_this.failureMessagePopup("Authentication Failed","Some Error in our end")}}).then(profileData=>{jQuery("#quix-popup-loader").hide();this.handleQuixyLogIn(profileData)})["catch"](error=>{jQuery("#quix-popup-loader").hide();if(_this.setIntervalRef){clearInterval(_this.setIntervalRef)}_this.failureMessagePopup("Authentication Failed","Some Error in our end")})}else if(type=="popup"){chrome.runtime.sendMessage({type:"quixyGotoQuixyLoginLinkedinResponseBack",access_token:result.access_token,tabId:tabId})}}else{if(type=="popup"){chrome.runtime.sendMessage({type:"quixyLoginFailedBackground"})}else{jQuery("#quix-popup-loader").hide();if(_this.setIntervalRef){clearInterval(_this.setIntervalRef)}_this.failureMessagePopup("Authentication Failed","Some Error in our end")}}})}catch(error){if(type=="popup"){chrome.runtime.sendMessage({type:"quixyLoginFailedBackground"})}else{jQuery("#quix-popup-loader").hide();if(_this.setIntervalRef){clearInterval(_this.setIntervalRef)}_this.failureMessagePopup("Authentication Failed","Please try again")}}}else{if(type=="popup"){chrome.runtime.sendMessage({type:"quixyLoginFailedBackground"})}else{jQuery("#quix-popup-loader").hide();if(_this.setIntervalRef){clearInterval(_this.setIntervalRef)}_this.failureMessagePopup("Authentication Failed","Some Error in our end")}}};handleGoogleCode=callback=>{let _this=this;jQuery("#quix-popup-loader").show();chrome.identity.launchWebAuthFlow({url:_this.create_oauth_drive(),interactive:true},token=>{let tokenStr=token.split("oauth2#");callback(tokenStr[1])})};handleGoogleCode=(type,callback)=>{let _this=this;let authURL="";if(type=="youtube"){authURL=_this.create_oauth_yt()}else{authURL=_this.create_oauth_drive()}jQuery("#quix-popup-loader").show();chrome.identity.launchWebAuthFlow({url:authURL,interactive:true},token=>{let tokenStr=token.split("#");callback(tokenStr[1])})};upgradeAccountpopup=(userid,name,email,picture)=>{const _this=this;const overlayy=document.querySelector("#"+this.extPrefix+"overlay-upgrade");if(overlayy){overlayy.remove()}var profileURL=null;const editprofile=()=>{const OutermostDiv=document.querySelector("."+this.extPrefix+"OutermostDiv");if(OutermostDiv){OutermostDiv.style.height="435px";OutermostDiv.innerHTML=editProfileStructure;const closeProfilePopup=document.querySelector("#"+this.extPrefix+"close-icon").addEventListener("click",closeProfilePopupfn);const cancleProfilePopup=document.querySelector("#"+this.extPrefix+"cancelbutton").addEventListener("click",closeProfilePopupfn);const saveProfilePopup=document.querySelector("#"+this.extPrefix+"savebutton").addEventListener("click",saveProfilePopupfn);const uploadpic=document.querySelector("."+this.extPrefix+"quix-choose-profile");if(uploadpic){uploadpic.addEventListener("change",function(event){const file=event.target.files[0];if(file&&file.type=="image/jpeg"||file.type=="image/png"||file.type=="image/jpg"){const img=document.querySelector("."+_this.extPrefix+"quix-profile-img");profileURL=file;img.src=URL.createObjectURL(file)}else{_this.failureMessagePopup("Invalid Format","Please make sure you're importing a PNG, JPG, or JPEG file.");return}})}}};const closeProfilePopupfn=()=>{const overlay=document.querySelector("#"+this.extPrefix+"overlay-upgrade");if(overlay){overlay.remove()}};const saveProfilePopupfn=()=>{const name=document.querySelector("#"+this.extPrefix+"name");const email=document.querySelector("#"+this.extPrefix+"email");const pass=document.querySelector("#"+this.extPrefix+"pass");const img=document.querySelector("."+this.extPrefix+"quix-profile-img");const payload={name:name.value,email:email.value,profile:profileURL!==null?profileURL:img?.src};if(payload?.name&&payload?.email){chrome.storage.local.get(`${this.extPrefix}quixyLoginUserData`,function(result){if(result[`${_this.extPrefix}quixyLoginUserData`]!==""&&result[`${_this.extPrefix}quixyLoginUserData`]!==null){let sessionData=result[`${_this.extPrefix}quixyLoginUserData`];const formdata=new FormData;formdata.append("name",payload?.name);formdata.append("picture",payload?.profile);formdata.append("stripe_acc_id",payload?.name);formdata.append("access_token",sessionData?.access_token);_this.makeServerRequest("POST","form-data",_this.api+"/user/update/"+userid,formdata,res=>{if(res?.status){_this.successMessagePopup("Profile updated successfully!","You're all set with your latest updates!");closeProfilePopupfn()}})}})}};const closeIcon=chrome.runtime.getURL("../images/quix-close-icon.png");const mailIcon=chrome.runtime.getURL("../images/quix-mail.png");const passlockIcon=chrome.runtime.getURL("../images/quix-padlock.png");const userIcon=chrome.runtime.getURL("../images/user.png");const webcam=chrome.runtime.getURL("../images/quix-webcam-tool.png");const editpic=chrome.runtime.getURL("../images/editimage.png");const profileStructure=`<div class='${this.extPrefix}outer-div'>
                                        <div class='${this.extPrefix}top-container'>
                                            <span>Profile</span>
                                            <img id="${this.extPrefix}close-icon" src=${closeIcon} alt='closeIcon' />
                                        </div>    
                                        <div class='${this.extPrefix}mid-container'>
                                            <img id="${this.extPrefix}mid-img" src="${picture}" alt='profile-img' />
                                            <span id="${this.extPrefix}mid-name" title="${name}" style="text-align=center">${name}</span>
                                            <button id="${this.extPrefix}mid-edit">Edit Profile</button>
                                        </div>    
                                        <div class='${this.extPrefix}bottom-container'>
                                            <input style="background-image:url(${mailIcon})" type="text" id="SG-name" name="SG-name" value="${name}" readonly><br>
                                        </div>    
                                    </div>`;const editProfileStructure=`<div class='${this.extPrefix}outer-div'>
                                        <div class='${this.extPrefix}top-container'>
                                            <span>Edit Profile</span>
                                            <img id="${this.extPrefix}close-icon" src=${closeIcon} alt='closeIcon' />
                                        </div>    
                                        <div class='${this.extPrefix}mid-container'>
                                        <div class="${this.extPrefix}quix-user-profile">
                                        <div class="${this.extPrefix}quix-user-profile-box">
                                        <img class="${this.extPrefix}quix-profile-img" src="${picture}" alt="profile" />
                                        <input
                                            class="${this.extPrefix}quix-choose-profile"
                                            type="file"
                                            name="profile"
                                            accept=".png, .jpg, .jpeg"
                                        />
                                        </div>
                                        <div class="${this.extPrefix}quix-edit-profile-option">
                                        <img   class="${this.extPrefix}quix-edit-icon" src=${editpic} />
                                        </div>
                                    </div>
                                            
                                        </div>    
                                        <div class='${this.extPrefix}bottom-container'>
                                            <input style="background-image:url(${userIcon})" type="text" id="${this.extPrefix}name" name="${this.extPrefix}name" value="${name}"><br>
                                            <input style="background-image:url(${mailIcon})" type="text" id="${this.extPrefix}email" name="${this.extPrefix}email" value="${email}" readonly><br>
                                        </div>    
                                        <div class='${this.extPrefix}bottom-containerEdit'>
                                            <button id="${this.extPrefix}savebutton">Save</button>
                                            <button id="${this.extPrefix}cancelbutton">Cancel</button>
                                        </div>    
                                    </div>`;const overlay=document.createElement("div");overlay.id=this.extPrefix+"overlay-upgrade";const OutermostDiv=document.createElement("div");OutermostDiv.classList.add(this.extPrefix+"OutermostDiv");OutermostDiv.style.cssText="width:400px; height: 350px;margin: auto;background-color: white;border-radius: 30px;";OutermostDiv.innerHTML=profileStructure;overlay.appendChild(OutermostDiv);document.body.appendChild(overlay);const editProfileButton=document.querySelector("#"+this.extPrefix+"mid-edit");editProfileButton.addEventListener("click",editprofile);const closeProfilePopup=document.querySelector("#"+this.extPrefix+"close-icon");closeProfilePopup.addEventListener("click",closeProfilePopupfn)};addWatermarkPopup=async()=>{let _this=this;const downloadIcon=chrome.runtime.getURL("../images/download-icon.png");const closeCircleBlackIcon=chrome.runtime.getURL("../images/quix-close-icon.png");return new Promise((resolve,reject)=>{const html=`
                <div id= "watermark-overlay">
                <div class="quix-dashboard-popup-inner">
                <div class="quix-dashboard-popup-title">
                    <div class="quix-dashboard-popup-title-inner">
                        <span>Upload Water Mark</span>
                         <img class="qiux-close-function-popup" id="close-video-editor-popup" src="${closeCircleBlackIcon}" />
                    </div>
                </div>
                <div class="manage-water-mark">
                    <div class="water-mark-box" id="account-btn">
                        <input id="account" type="radio" name="water-mark-option" value="account" />
                        <label for="account">User Account Setting</label>
                    </div>
                    <div class="water-mark-box" id="custom-btn">
                        <input id="custom" type="radio" name="water-mark-option" value="custom" checked />
                        <label for="custom">Custom Watermark Setting</label>
                    </div>
                </div>
                <div class="quix-dashboard-popup-body">
                    <div class="quix-dashboard-popup-body-inner">
                    <div class=" quix-upload-outer text-center">
                        <div class="quix-water-screenshot-content">
                        <p class="quix-heading-con">Upload watermark</p>
                        <div class="col-md-12 mb-3 text-start">
                            <div class="quix-item-uploader-box">
                                <div class="preview-uploaded-image-wrapper">
                                    <img class="qiux-remove-picture-function-popup" id="close-video-editor-popup" src="${closeCircleBlackIcon}" />
                                    <img class="preview-uploaded-image" src="" alt="Upload Icon" />
                                </div>
                                <div class="quix-uploader">
                                    <div class="quix-item-uploader">
                                        <input id="input-file-upload" class="quix-upload-input" accept="image/jpg,image/jpeg,image/png" type="file" name="image_screenshot" value="">
                                        <img src=${downloadIcon}>
                                    </div>
                                    <div style=" display: flex; ">
                                        <span style="font-size: 12px; display: block;">Choose only this format(JPG, JPEG, PNG)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="water-mark-mid-section">
                        <div class="water-mark-text-wrapper">
                            <label class="label">Water mark text</label>
                            <input type="text" name="text_screenshot" class="form-control" value="">
                        </div>
                        <div class="font-size-color-wrapper">
                            <div class="position-wrapper">
                                <label class="label">Position</label>
                                <select class="form-control" name="position_screenshot" id="positionScreenshot">
                                    <option value="LT">Left Top</option>
                                    <option value="LB">Left Bottom</option>
                                    <option value="RT">Right Top</option>
                                    <option value="RB">Right Bottom</option>
                                    <option value="C" selected>Center</option>
                                </select>
                            </div>
                            <div class="color-wrapper">
                                <label class="label">Text Color</label>
                                <input type="color" class="form-control color-picker-box" value="">
                            </div>
                        </div>
                        <div class="position-transparency-wrapper">
                             <div class="font-size-wrapper range-input-filed">
                                <label class="label">Font Size</label>
                                <input type="range" class="form-control form-range" name="fontSize" value="14" min="12" max="72" title=value>
                                <div class="range-badge">14</div>
                            </div>
                            <div class="transparency-wrapper range-input-filed">
                                <label class="label">Transparency <span style="font-size: 10px">(range between 0 to 1)</span></label>
                                <input type="range" class="form-control form-range" name="transparency" value="0.3" min="0" max="1" step="0.1">
                                <div class="range-badge">0.3</div>
                            </div>
                        </div>
                        <div class="border-x-border-y-wrapper">
                            <div class="border-x-wrapper range-input-filed">
                                <label class="label">Margin from border X</label>
                                <input type="range" name="marginBorderX" class="form-control form-range" value="0" min="0" max="50">
                                <div class="range-badge">0</div>
                            </div>
                            <div class="border-y-wrapper range-input-filed">
                            <label class="label">Margin from border Y</label>
                            <input type="range" name="marginBorderY" class="form-control form-range" value="0" min="0" max="50">
                            <div class="range-badge">0</div>
                            </div>
                        </div>
                        </div>
                        </div>
                    </div>
                    <div class="water-mark-button-wrapper">
                        <button class="btn form-action-button form-cancel-button">Cancel</button>
                        <button class="btn form-action-button form-save-button">Save</button>
                    </div>
                    </div>
                </div>
                </div>
                </div>
                `;jQuery("body").append(html);jQuery(document).ready(()=>{jQuery(".form-range").mousemove(function(event){var value=jQuery(this).val();var min=parseInt(jQuery(this).attr("min"));var max=parseInt(jQuery(this).attr("max"));var range=max-min;var percent=(value-min)/range*100;jQuery(this).next(".range-badge").text(value);var rangeBadge=jQuery(this).next(".range-badge");var rangeBadgeWidth=rangeBadge.outerWidth();var parentWidth=jQuery(this).outerWidth();var cursorOffset=event.pageX-jQuery(this).offset().left;var leftOffset=cursorOffset-rangeBadgeWidth/2;rangeBadge.css({left:leftOffset+"px"})});document.getElementById("positionScreenshot").addEventListener("change",function(){let position=this.value;CheckMarginDisable(position)});function CheckMarginDisable(position){let marginBorderX=document.querySelector('input[name="marginBorderX"]');let marginBorderY=document.querySelector('input[name="marginBorderY"]');if(position==="C"){marginBorderX.disabled=true;marginBorderY.disabled=true;marginBorderX.parentNode.classList.add("margindisabled");marginBorderY.parentNode.classList.add("margindisabled")}else{marginBorderX.disabled=false;marginBorderY.disabled=false;marginBorderX.parentNode.classList.remove("margindisabled");marginBorderY.parentNode.classList.remove("margindisabled")}}let position=document.getElementById("positionScreenshot").value;CheckMarginDisable(position)});chrome.storage.local.get(`${extPrefix}quixyLoginUserData`,function(result){if(result[`${extPrefix}quixyLoginUserData`]!=""&&result[`${extPrefix}quixyLoginUserData`]!=null){let accountSetting=result[`${extPrefix}quixyLoginUserData`];_this.accountWaterMarkSettings=null;if(accountSetting.waterMarkSetting&&accountSetting.waterMarkSetting.length>0){jQuery(".manage-water-mark .water-mark-box #account").attr("disabled",false);jQuery(".manage-water-mark .water-mark-box #account").attr("checked",true);if(accountSetting.waterMarkSetting[0].image_screenshot){const newurl=_this.removeDomainFromPath(_this.api,accountSetting.waterMarkSetting[0].image_screenshot);accountSetting.waterMarkSetting[0].image_screenshot=newurl}_this.accountWaterMarkSettings=accountSetting.waterMarkSetting[0];resolve("account")}else{jQuery(".manage-water-mark .water-mark-box #account").attr("disabled",true);jQuery(".manage-water-mark .water-mark-box #account").addClass("disabled");resolve("custom")}}else{jQuery(".manage-water-mark .water-mark-box #account").attr("disabled",true);jQuery(".manage-water-mark .water-mark-box #account").addClass("disabled");resolve("custom")}})})};applyWatermarkPopup=async type=>{const value=await this.addWatermarkPopup();let customInput=jQuery(".manage-water-mark input#custom");let customWatermark=true;let waterMarkSettings=jQuery(".quix-water-screenshot-content");let imageData;if(value!==customInput.val()){waterMarkSettings.hide();customWatermark=false}function toggleWaterMarkSettings(e){if(customInput.val()==="custom"&&customInput.prop("checked")){waterMarkSettings.show();customWatermark=true}else{waterMarkSettings.hide();customWatermark=false}}jQuery(".manage-water-mark input").on("change",toggleWaterMarkSettings);let watermarkSettings={image_screenshot:"",text_screenshot:{fontSize:"",fontColor:"",text:""},screenshot_transparency:"",position_screenshot:{position:"",x:"",y:""}};chrome.storage.local.get("watermarkSettings",async result=>{if(result.watermarkSettings){document.querySelector(".water-mark-text-wrapper .form-control").value=result.watermarkSettings.text_screenshot.text;document.querySelector(".font-size-wrapper .form-control").value=result.watermarkSettings.text_screenshot.fontSize;document.querySelector(".color-wrapper .form-control").value=result.watermarkSettings.text_screenshot.fontColor;document.querySelector(".transparency-wrapper .form-control").value=result.watermarkSettings.screenshot_transparency;document.querySelector(".position-wrapper .form-control").value=result.watermarkSettings.position_screenshot.position;document.querySelector(".border-x-wrapper .form-control").value=result.watermarkSettings.position_screenshot.x;document.querySelector(".border-y-wrapper .form-control").value=result.watermarkSettings.position_screenshot.y;let marginBorderX=document.querySelector('input[name="marginBorderX"]');let marginBorderY=document.querySelector('input[name="marginBorderY"]');let position=document.querySelector(".position-wrapper .form-control").value;if(position==="C"){marginBorderX.disabled=true;marginBorderY.disabled=true;marginBorderX.parentNode.classList.add("margindisabled");marginBorderY.parentNode.classList.add("margindisabled")}else{marginBorderX.disabled=false;marginBorderY.disabled=false;marginBorderX.parentNode.classList.remove("margindisabled");marginBorderY.parentNode.classList.remove("margindisabled")}if(result.watermarkSettings.image_screenshot){const blob=await this.base64ToBlob(result.watermarkSettings.image_screenshot,"image/png");const url=URL.createObjectURL(blob);const img=new Image;img.src=url;img.onload=()=>{URL.revokeObjectURL(url)};document.body.appendChild(img);const inputFile=document.querySelector("#watermark-overlay #input-file-upload");const dataTransfer=new DataTransfer;dataTransfer.items.add(new File([blob],"uploaded-image.png",{type:"image/png"}));inputFile.files=dataTransfer.files;imageData=result.watermarkSettings.image_screenshot;jQuery(".quix-item-uploader-box .preview-uploaded-image").attr("src",imageData);jQuery(".quix-item-uploader-box .preview-uploaded-image-wrapper").show()}else{jQuery(".quix-item-uploader-box .preview-uploaded-image").attr("src","");jQuery(".quix-item-uploader-box .preview-uploaded-image-wrapper").hide()}}});const saveHandler=(event,type)=>{let _this=this;if(customWatermark){const watermarkTextVal=document.querySelector(".water-mark-text-wrapper .form-control").value;const fontSizeVal=document.querySelector(".font-size-wrapper .form-control").value;const textColorVal=document.querySelector(".color-wrapper .form-control").value;const positionVal=document.querySelector(".position-wrapper .form-control").value;const transparencyVal=document.querySelector(".transparency-wrapper .form-control").value;const borderXVal=document.querySelector(".border-x-wrapper .form-control").value;const borderYVal=document.querySelector(".border-y-wrapper .form-control").value;if(imageData){watermarkSettings.image_screenshot=imageData}if(watermarkTextVal){watermarkSettings.text_screenshot.text=watermarkTextVal}if(fontSizeVal){watermarkSettings.text_screenshot.fontSize=fontSizeVal}if(textColorVal&&(imageData||watermarkTextVal||fontSizeVal||positionVal||transparencyVal||borderXVal||borderYVal)){watermarkSettings.text_screenshot.fontColor=textColorVal}if(transparencyVal){watermarkSettings.screenshot_transparency=transparencyVal}if(positionVal){watermarkSettings.position_screenshot.position=positionVal}if(borderXVal){watermarkSettings.position_screenshot.x=borderXVal}if(borderYVal){watermarkSettings.position_screenshot.y=borderYVal}if(watermarkSettings.image_screenshot||watermarkSettings.text_screenshot.text||watermarkSettings.text_screenshot.fontSize||watermarkSettings.text_screenshot.fontColor||watermarkSettings.position_screenshot.position||watermarkSettings.screenshot_transparency||watermarkSettings.position_screenshot.x||watermarkSettings.position_screenshot.y){this.watermarkSettings.length=0;this.watermarkSettings.push(watermarkSettings)}else{watermarkSettings=""}let data={watermarkSettings:watermarkSettings};chrome.storage.local.set(data,()=>{});let data1={needToAppyWatermarkSettings:{status:true,action:"custom"}};chrome.storage.local.set(data1,()=>{});editScreenshot.applyWatermark("custom")}else{let data={accountWaterMarkSettings:_this.accountWaterMarkSettings};chrome.storage.local.set(data,()=>{});let data1={needToAppyWatermarkSettings:{status:true,action:"account"}};chrome.storage.local.set(data1,()=>{});editScreenshot.applyWatermark("account")}jQuery("#watermark-overlay").remove()};const uploadFile=async file=>{let _this=this;const validTypes=["image/jpeg","image/png","image/gif","image/jpg","image/svg"];if(!validTypes.includes(file.type)){this.failureMessagePopup("Invalid Format","Please make sure you're importing a PNG, JPG, or JPEG file.");return}if(file.type=="image/jpeg"||file.type=="image/png"||file.type=="image/gif"||file.type=="image/jpg"||file.type=="image/svg"){const base64Image=await this.blobToBase64(file);imageData=base64Image;jQuery(".quix-item-uploader-box .preview-uploaded-image").attr("src",imageData);jQuery(".quix-item-uploader-box .preview-uploaded-image-wrapper").show()}};const removeWaterMarkPopup=()=>{jQuery("#watermark-overlay").remove()};jQuery(".water-mark-button-wrapper .form-cancel-button").on("click",removeWaterMarkPopup);jQuery(".quix-dashboard-popup-inner .qiux-close-function-popup").on("click",removeWaterMarkPopup);jQuery(".quix-dashboard-popup-inner .qiux-remove-picture-function-popup").on("click",()=>{const fileInput=jQuery("#watermark-overlay #input-file-upload");if(fileInput.val()){fileInput.val("");imageData="";jQuery(".quix-item-uploader-box .preview-uploaded-image").attr("src","");jQuery(".quix-item-uploader-box .preview-uploaded-image-wrapper").hide()}});jQuery(".water-mark-button-wrapper .form-save-button").on("click",saveHandler);jQuery("#watermark-overlay #input-file-upload").on("change",event=>{const file=event.target.files[0];if(!file)return;uploadFile(file)})};blobToBase64=blob=>{return new Promise((resolve,reject)=>{const reader=new FileReader;reader.onloadend=()=>resolve(reader.result);reader.onerror=reject;reader.readAsDataURL(blob)})};base64ToBlob=async(base64,contentType)=>{const byteCharacters=atob(base64.split(",")[1]);const byteNumbers=new Array(byteCharacters.length);for(let i=0;i<byteCharacters.length;i++){byteNumbers[i]=byteCharacters.charCodeAt(i)}const byteArray=new Uint8Array(byteNumbers);return new Blob([byteArray],{type:contentType})};removeDomainFromPath=(serverURL,fileURL)=>{if(fileURL){let localFileURL=fileURL.replace(/^https?:\/\/[^\/]+/,"");let fullLocalURL=serverURL+localFileURL;return fullLocalURL}};applyUrlSummaryPopup=()=>{let _this=this;const closeCircleBlackIcon=chrome.runtime.getURL("../images/quix-close-icon.png");const html=`
                <div id= "url-summary-overlay">
                    <div class="quix-dashboard-popup-inner">
                        <div class="quix-dashboard-popup-title">
                        <div class="quix-dashboard-popup-title-inner">
                            <span class="">URL Summary</span>
                            <img class="qiux-close-function-popup" id="close-video-editor-popup" src="${closeCircleBlackIcon}" />
                            </div>
                        </div>
                        <div class="quix-dashboard-popup-body">
                            <div class="get-summary-wrapper">
                                <div class="get-summary">
                                    <input type="text" class="get-summary-input" value="" name="url-summary" placeholder="Enter URL" /><button class="get-summary-button">Get Summary</button>
                                </div>
                                <div class="copy-summary-url">
                                    <div class="summary-text"></div>
                                    <button class="copy-summary-button">Copy Summary</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                `;jQuery("body").append(html);jQuery(document).ready(()=>{jQuery("#url-summary-overlay button.copy-summary-button").css("pointer-events","none");jQuery("#url-summary-overlay .qiux-close-function-popup").on("click",()=>{jQuery("#url-summary-overlay").remove()});jQuery("#url-summary-overlay button.get-summary-button").on("click",e=>{try{const url=$("#url-summary-overlay .get-summary-input").val();e.target.style.pointerEvents="none";e.target.innerText="Loading...";let data={url:url};_this.makeServerRequest("POST","json",_this.api+"/integration/urlSummary",data,res=>{if(res.data){const content=res.data.choices[0].message.content;$("#url-summary-overlay .summary-text").text(content);jQuery("#url-summary-overlay button.copy-summary-button").css("pointer-events","all");e.target.style.pointerEvents="all";e.target.innerText="Get Summary"}else{e.target.classList.add("highlight-summary-input");e.target.innerText="Try Again";$("#url-summary-overlay .summary-text").text("");jQuery("#url-summary-overlay button.copy-summary-button").css("pointer-events","none");setTimeout(()=>{e.target.classList.remove("highlight-summary-input");e.target.style.pointerEvents="all";e.target.innerText="Get Summary"},1500)}return})}catch(error){e.target.style.pointerEvents="all";e.target.innerText="Get Summary";$("#url-summary-overlay .summary-text").text("");jQuery("#url-summary-overlay button.copy-summary-button").css("pointer-events","none")}});jQuery("#url-summary-overlay button.copy-summary-button").on("click",e=>{const textElement=document.querySelector("#url-summary-overlay .summary-text");const textToCopy=textElement.innerText;navigator.clipboard.writeText(textToCopy).then(function(){textElement.classList.add("highlight-summary-text");$(".copy-summary-button").text("Copied");setTimeout(function(){textElement.classList.remove("highlight-summary-text");$(".copy-summary-button").text("Copy to clipboard")},1e3)})["catch"](function(error){console.error("Could not copy text: ",error)})})})}}